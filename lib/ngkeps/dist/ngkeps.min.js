angular.module("ngKeps",[]).filter("keys",function(){return function(e){return e?Object.keys(e):[]}}),angular.module("ngKeps").run(["$templateCache",function(e){e.put("../templates/authModal.html",'<div class="model" style="width:400px" ng-class="{\'shake\': shakeForm}"><div class="" ng-show="!user"><div class="" ng-show="show==\'login\'"><h4 class="modal-title">Login</h4><hr><form name="loginForm" data-ng-submit="signin(\'local\')"><div class="form-group"><label>Email</label><input type="email" class="form-control" ng-model="login.username" required placeholder="Your Email"></div><div class="form-group"><label>Password</label><input type="password" class="form-control" ng-model="login.password" required placeholder="Your Password"></div><div class="form-group"><div class="row"><div class="col-xs-6"><p class="help-block"><a ng-click="showForgottenPassword()">Forgot password?</a></p></div></div></div><div class="alert alert-success alert-dismissible fade in" ng-show="msgs.signedIn">{{msgs.signedIn}}</div><div class="alert alert-warning alert-dismissible fade in" ng-show="msgs.error">{{msgs.error}}</div><div class="form-group no-margin" ng-if="config.oauth.google"><button type="button" ng-click="signin(\'google\')" class="btn btn-theme btn-lg btn-t-primary btn-block">Log In With Google</button></div><div class="form-group no-margin" ng-if="config.oauth.facebook"><button type="button" ng-click="signin(\'facebook\')" class="btn btn-theme btn-lg btn-t-primary btn-block">Log In With Facebook</button></div><div class="form-group no-margin" ng-if="config.register"><button type="button" ng-click="showRegister()" class="btn btn-theme btn-lg btn-t-primary btn-block">Register</button></div><div class="form-group no-margin"><button type="submit" class="btn btn-theme btn-lg btn-t-primary btn-block">Log In</button></div></form><!-- form login --></div><div class="" ng-show="show==\'register\'"><h4 class="modal-title">Register</h4><hr><form name="registerForm" data-ng-submit="register()"><div class="form-group"><label>First name</label><input type="text" class="form-control" required ng-model="newUser.firstName" required placeholder="first name"></div><div class="form-group"><label>Last name</label><input type="text" class="form-control" required ng-model="newUser.lastName" required placeholder="last name"></div><div class="form-group"><label>Email</label><input type="email" class="form-control" ng-model="newUser.email" required placeholder="Your Email"></div><div class="form-group"><label>Password</label><input type="password" class="form-control" ng-model="newUser.password" required placeholder="Your Password"></div><div class="form-group"><label>Re-type Password</label><input type="password" class="form-control" ng-model="rePassword" required placeholder="Re-type Your Password"></div><!--Error/success messages --><div class="alert alert-warning alert-dismissible fade in" ng-show="msgs.passwordsDontMatch">Passwords dont match.</div><div class="alert alert-warning alert-dismissible fade in" ng-show="msgs.passwordShort">Password needs to be 7 or more characters.</div><div class="alert alert-warning alert-dismissible fade in" ng-show="msgs.formError">Error in the form.</div><div class="alert alert-success alert-dismissible fade in" ng-show="msgs.created">You are registered!</div><div class="alert alert-warning alert-dismissible fade in" ng-show="msgs.emailUsed">Email has already been used to create an account</div><div class="alert alert-danger alert-dismissible fade in" ng-show="msgs.error">{{msgs.error}}</div><div class="white-space-10"></div><div class="form-group no-margin"><button type="button" class="btn btn-default btn-theme" ng-click="showLogin()">Cancel</button> <button type="submit" class="btn btn-theme btn-lg btn-t-primary btn-block">Register</button></div></form><!-- form login --><hr><div class="text-center color-white">By creating an account, you agree to {{config.name}}<br><a href="#" class="link-white"><strong>Terms of Service</strong></a> and consent to our <a href="#" class="link-white"><strong>Privacy Policy</strong></a>.</div></div><div class="" ng-show="show==\'forgottenPassword\'"><h4 class="modal-title">Forgot Password</h4><hr><div class="form-group"><label>Enter Your Email</label><input type="email" class="form-control" name="text" placeholder="Email"></div><hr><button type="button" class="btn btn-default btn-theme" ng-click="showLogin()">Cancel</button> <button type="submit" class="btn btn-success btn-theme">Send</button></div><div class="" ng-show="show==\'twofactor\'"><h4 class="modal-title">Two Factor Authentication</h4><hr><div class="form-group"><label>Enter Your Email</label><input type="email" class="form-control" name="text" placeholder="Email"></div><hr><button type="button" class="btn btn-default btn-theme" ng-click="showLogin()">Cancel</button> <button type="submit" class="btn btn-success btn-theme">Send</button></div><div class="" ng-show="show==\'resetPassword\'"><h4 class="modal-title">Reset Password</h4><hr><div class="form-group"><label>Password</label><input type="password" class="form-control" ng-model="newUser.password" required placeholder="Your Password"></div><div class="form-group"><label>Re-type Password</label><input type="password" class="form-control" ng-model="rePassword" required placeholder="Re-type Your Password"></div><hr><button type="button" class="btn btn-default btn-theme" data-dismiss="modal">Close</button> <button type="submit" class="btn btn-success btn-theme">Send</button></div></div><div class="col-md-12" ng-show="user"><p>Looks like your already signed in as {{user.username}}.</p><p><br><a ng-click="signout()">sign out?</a></p></div><div style="display:none"></div></div>'),e.put("../templates/form.html",'<section><div ng-repeat="key in kepsData | keys" ng-init="field = kepsData[key]"><input-item keps-name="key" keps-type="field" keps-model="data.value[key]" keps-label="{{ field.label }}" keps-framework="{{kepsFramework}}" keps-errors="kepsErrors[key]"></div></section>'),e.put("../templates/bootstrapv3/address.html",'<div class="row"><div class="col-xs-12"><span ng-show="kepsType.required && !data.subrequired" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label></div></div><div class="row"><div class="col-xs-4"><div class="form-group {{kepsGroupClass}}"><div class="form-group"><span ng-show="data.subrequired && kepsType.required.address1" style="color:red">*</span><label class="{{kepsSubLabelClass}}">Address Line 1</label><input class="form-control {{kepsInputClass}}" type="text" ng-model="data.value.address1" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.address1"></div><div class="form-group"><span ng-show="data.subrequired && kepsType.required.address2" style="color:red">*</span><label class="{{kepsSubLabelClass}}">Address Line 2</label><input class="form-control {{kepsInputClass}}" type="text" ng-model="data.value.address2" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.address2"></div><div class="form-group"><span ng-show="data.subrequired && kepsType.required.city" style="color:red">*</span><label class="{{kepsSubLabelClass}}">City</label><input class="form-control {{kepsInputClass}}" type="text" ng-model="data.value.city" ng-keydown="checkAddress()" ng-required="data.subrequired && kepsType.required.city"></div></div></div><div class="col-xs-4"><div class="form-group {{kepsGroupClass}}"><div class="form-group"><span ng-show="data.subrequired && kepsType.required.region" style="color:red">*</span><label class="{{kepsSubLabelClass}}">State/Province/Region</label><input class="form-control {{kepsInputClass}}" type="text" ng-model="data.value.region" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.region"></div><div class="form-group"><span ng-show="data.subrequired && kepsType.required.postal" style="color:red">*</span><label class="{{kepsSubLabelClass}}">Zip/Postal Code</label><input class="form-control {{kepsInputClass}}" type="text" ng-model="data.value.postal" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.postal"></div><div class="form-group"><span ng-show="data.subrequired && kepsType.required.country" style="color:red">*</span><label class="{{kepsSubLabelClass}}">Country</label><input class="form-control {{kepsInputClass}}" type="text" ng-model="data.value.country" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.country"></div></div></div><div class="col-xs-4"><p>Preview</p><br>{{data.value.address1 + \' \' + data.value.address2}}<br>{{data.value.city + \', \' + data.value.region + \' \' + data.value.postal}}<br>{{data.value.country}}</div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/array.html",'<div class="row"><div class="col-xs-12"><div class="form-group {{kepsGroupClass}}"><div class="{{kepsArrayClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label }}:</label><div class="list-group"><div class="list-group-item" ng-show="data.value.length > 0"><div ng-repeat="item in data.value"><div style="width:5%;margin-left:5%;display:inline-block"><span>{{($index+1) + \'.\'}}</span></div><div style="width:79%;display:inline-block"><input-item ng-repeat="(key,val) in kepsType.subSchema" keps-name="key" keps-label="\'\'" keps-group-class="form-horizontal" keps-type="val" keps-model="item[key]" keps-framework="kepsFramework"></div><div style="width: 3%;display: inline-block;margin-right: 7%;line-height: 0px"><a href="" style="float:right" ng-click="removeArrayItem($index)"><span style="color:red;margin-left:15px" class="glyphicon glyphicon-remove"></span></a></div></div></div><div class="list-group-item"><a href="" style="" title="add item"><span style="color:green" class="glyphicon glyphicon-plus-sign" ng-click="addArrayItem()"></span></a></div></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div></div></div></div>'),e.put("../templates/bootstrapv3/arraymulti.html",'<div class="row"><div class="col-xs-12"><p></p><div class="form-group {{kepsGroupClass}}"><div class="{{kepsArrayClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class=""><div class="list-group"><div class="list-group-item" ng-repeat="item in data.value track by $index">{{$index + 1}} <a href="" style="float:right" ng-click="removeArrayItem($index)"><span style="color:red;margin-left:15px" class="glyphicon glyphicon-remove"></span> </a><a href="" style="float:right" ng-click="showArrayItem[$index] = !showArrayItem[$index]"><span ng-show="showArrayItem[$index]" style="color:blue" class="glyphicon glyphicon-eye-close"></span> <span ng-show="!showArrayItem[$index]" style="color:blue" class="glyphicon glyphicon-eye-open"></span></a><div ng-show="showArrayItem[$index]"><input-item ng-repeat="(name,field) in kepsType.subSchema" keps-name="name" keps-label="{{name}}" keps-label-class="kepsSubLabelClass" keps-type="field" keps-model="item[name]" keps-framework="kepsFramework" keps-errors="data.error[$index]"></div></div><div class="list-group-item"><a href="" style="" title="add item"><span style="color:green" class="glyphicon glyphicon-plus-sign" ng-click="addArrayItem()"></span></a></div></div></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div></div></div></div>'),e.put("../templates/bootstrapv3/arrayobject.html",'<ul class="list-group"><li class="list-group-item" ng-repeat="obj in data.value track by $index"><a href="" style="color:inherit" ng-click="data.showArray[$index] = !data.showArray[$index]">{{$index}} {{data.showArray[$index] ? \'Hide Contents\' : \'Show Contents\'}} </a><a href="" ng-click="removeArrayItem($index)" class="badge"><span class="glyphicon glyphicon-remove"></span> </a><a href="" ng-click="addArrayItem()" class="badge"><span class="glyphicon glyphicon-plus"></span></a><div ng-show="data.showArray[$index]"><form><keps-form keps-name="kepsName+\'.\'" keps-data="kepsType[0]" keps-model="data.value[$index]"></keps-form></form></div></li></ul>'),e.put("../templates/bootstrapv3/boolean.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="radio"><label><input type="radio" ng-model="data.value" ng-value="{{true}}" ng-required="kepsType.required" ng-readonly="kepsReadonly"> {{kepsType.choices.split(\',\')[0] || \'true\'}}</label></div><div class="radio"><label><input type="radio" ng-model="data.value" ng-value="{{false}}"> {{kepsType.choices.split(\',\')[1] || \'false\'}}</label></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/date.html",'<span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="form-group {{kepsGroupClass}}"><div class="form-group" style="width:200px"><input type="date" ng-required="kepsType.required" class="form-control" ng-model="data.date" ng-blur="makeTime()" placeholder="yyyy-MM-dd" ng-readonly="kepsReadonly"></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/datetime.html",'<span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="form-group {{kepsGroupClass}}"><div class="form-group" style="width:200px"><input type="date" ng-required="kepsType.required" class="form-control" ng-model="data.date" ng-blur="makeTime()" placeholder="yyyy-MM-dd" ng-readonly="kepsReadonly"></div><div class="form-group" style="width:200px"><input type="time" ng-required="kepsType.required" class="form-control" ng-model="data.time" ng-blur="makeTime()" ng-readonly="kepsReadonly"></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/email.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><input type="email" ng-model="data.value" class="form-control {{kepsInputClass}}" ng-required="kepsType.required" placeholder="{{kepsType.placeholder}}" ng-keyup="errorChecking()" ng-readonly="kepsReadonly"> <span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/enum.html",'<div class="form-group {{kepsGroupClass}}"><div class="row"><div class="col-xs-12"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><select ng-readonly="kepsReadonly" class="form-control {{kepsInputClass}}" ng-model="data.value"><option ng-repeat="option in kepsType.options track by $index" value="{{kepsType.options[$index]}}">{{kepsType.labels[$index] || kepsType.options[$index] }}</option></select><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div></div></div>'),e.put("../templates/bootstrapv3/file.html",'<div class="form-group"><div class="row"><div class="col-xs-12"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="form-group {{kepsGroupClass}}"><div class="input-group"><span class="input-group-btn"><span class="btn btn-default {{kepsButtonClass}}" style="min-width: 0;padding-left:20px;padding-right:20px;display:inline-block">Load File <input ng-if="kepsAcceptFileTypes" type="file" accept="{{kepsAcceptFileTypes}}" style="position:absolute;opacity:0;top: 0;right: 0;\n		    		min-width: 100%;min-height: 100%" onchange="angular.element(this).scope().fileChanged(event)"> <input ng-if="!kepsAcceptFileTypes" type="file" style="position:absolute;opacity:0;top: 0;right: 0" onchange="angular.element(this).scope().fileChanged(event)"> </span></span><input type="text" class="form-control" ng-readonly="kepsReadonly" value="{{uploadStatus}}"></div></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div></div></div>'),e.put("../templates/bootstrapv3/geopoint.html",'<div class="row"><div class="col-xs-5"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="form-group {{kepsGroupClass}}"><div class="form-group"><label class="control-label">Lat:</label><input ng-readonly="kepsReadonly" type="number" class="form-control" step="any" ng-model="data.lat" ng-keyup="testLatLng();errorChecking();"></div><div class="form-group"><label class="control-label">Lng:</label><input ng-readonly="kepsReadonly" type="number" class="form-control" step="any" ng-model="data.lng" ng-keyup="testLatLng();errorChecking();"></div></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div><div class="col-xs-7"><p>Preview:</p><div id="map" style="width:100%;height:200px;margin-top:-5px"></div></div></div>'),e.put("../templates/bootstrapv3/html.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><text-angular ng-model="data.value" ng-required="kepsType.required" ta-default-wrap="div" ta-disabled="kepsReadonly"></text-angular><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/image.html",'<div class="form-group"><div class="row"><div class="col-xs-6"><span ng-show="kepsType.required" style="color:red">*</span><div class="alert alert-info" ng-show="kepsType.imageUploading"><i class="fa fa-spinner fa-spin" style="font-size:24px"></i> Uploading</div><div class="alert alert-danger" ng-show="kepsType.imageError">{{kepsType.imageError}}</div><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="form-group {{kepsGroupClass}}" ng-init="importImageComputer = true;" ng-show="importImageComputer"><div class="input-group"><span class="input-group-btn"><span class="btn btn-default {{kepsButtonClass}}" style="min-width: 0;padding-left:20px;padding-right:20px;display:inline-block">Load Image <input type="file" ng-required="kepsType.required" style="position:absolute;opacity:0;top: 0;right: 0;\n		    		min-width: 100%;min-height: 100%" onchange="angular.element(this).scope().imageFileChanged(event)" accept="image/*"> </span></span><input type="text" class="form-control" readonly="" value="{{imageStatus}}"></div><a href="" ng-click="removeImage()" style="color:red">Remove Image</a><!--<a href="" ng-click="importImageComputer = false;importImageInternet = true;">Or... Upload an image from a url.</a>--></div><div class="form-group {{kepsGroupClass}}" ng-show="importImageInternet"><div class="input-group"><span class="input-group-btn"><span class="btn btn-default {{kepsButtonClass}}" style="min-width: 0;padding-left:20px;padding-right:20px;display:inline-block">Import from url <a href="" ng-click="getImageUrl()" style="position:absolute;opacity:0;top: 0;right: 0;\n		    		min-width: 100%;min-height: 100%" onchange="angular.element(this).scope().imageFileChanged(event)"></a> </span></span><input type="text" class="form-control" ng-required="kepsType.required" placeholder="{{kepsType.placeholder || \'Enter Image url\'}}" ng-model="kepsType.imageUrl"></div><a href="" ng-click="importImageComputer = true;importImageInternet = false;">Or... Upload a file from your computer</a></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div><div class="col-xs-6"><canvas id="{{kepsType.randomCanvasId}}"></canvas><span ng-show="imageData.height && imageData.width">{{imageData.width + \' X \' + imageData.height}}</span></div></div></div>'),e.put("../templates/bootstrapv3/multienum.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="checkbox" ng-repeat="opt in kepsType.options"><label><input type="checkbox" ng-click="checkMulti(opt);errorChecking();" ng-checked="inArray(opt)" ng-readonly="kepsReadonly"> {{opt}}</label></div><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/number.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><input type="number" ng-model="data.value" min="{{kepsType.min}}" max="{{kepsType.max}}" class="form-control {{kepsInputClass}}" ng-required="kepsType.required" placeholder="{{kepsType.placeholder}}" numbers-only="{{kepsType.round == 0}}" ng-keyup="errorChecking()" ng-readonly="kepsReadonly"> <span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/object.html",'<span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="row"><div class="col-xs-10 col-xs-offset-1"><input-item ng-repeat="(name,field) in kepsType.subSchema" keps-name="name" keps-label="{{name}}" keps-type="field" keps-model="data.value[name]" keps-framework="kepsFramework" keps-errors="data.error[name]"></div></div>'),e.put("../templates/bootstrapv3/phone.html",'<style>.iti-flag {background-image: url("/lib/intl-tel-input/build/img/flags.png");}</style><div class="row"><div class="col-xs-12"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><div class="form-group {{kepsGroupClass}}"><input type="tel" id="mobile-number" class="form-control {{kepsInputClass}}" ng-model="data.value"> <span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div></div></div><script>$("#mobile-number").intlTelInput();</script>'),e.put("../templates/bootstrapv3/referenceObject.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><input ng-readonly="kepsReadonly" type="text" list="{{kepsType.label || kepsName}}" class="form-control {{kepsInputClass}}" ng-model="data.reference" ng-blur="setReferenceData()"><datalist id="{{kepsType.label || kepsName}}">{{referenceOptions}}<option ng-repeat="option in referenceOptions" value="{{option[data.displayReferenceAs]}}">{{option[data.displayReferenceAs]}}</option></datalist><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/richtext.html",'<div class="row"><div class="col-xs-12"><div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><text-angular ng-model="data.value" ng-required="kepsType.required" ta-toolbar="richToolbar" ta-disabled="kepsReadonly"></text-angular><span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div></div></div>'),e.put("../templates/bootstrapv3/string.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><input type="text" ng-model="data.value" class="form-control {{kepsInputClass}}" ng-required="kepsType.required" placeholder="{{kepsType.display.placeholder}}" ng-keyup="errorChecking()" ng-readonly="kepsReadonly"> <span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/bootstrapv3/url.html",'<div class="form-group {{kepsGroupClass}}"><span ng-show="kepsType.required" style="color:red">*</span><label class="{{kepsLabelClass}}">{{kepsType.label}}</label><input type="url" ng-model="data.value" class="form-control {{kepsInputClass}}" ng-required="kepsType.required" placeholder="{{kepsType.display.placeholder}}" ng-readonly="kepsReadonly"> <span class="help-block" ng-if="kepsType.instructions">{{kepsType.instructions}} </span><span style="color:red;margin-left:20px" ng-show="errorMsg">{{errorMsg}}</span></div>'),e.put("../templates/materialize/input.html",'<section><div class="modal-row"><label ng-if="kepsType.display.label">{{kepsType.display.label}}:</label><label ng-if="!kepsType.display.label">{{kepsName}}:</label><span ng-show="typeError" style="color:red">Did not find a useable input type, defaulting to string</span><!-- Start listing input types --><div ng-if="kepsType.type"><div ng-if="kepsType.type.indexOf(\':\') > -1"><input type="text" list="{{kepsType.type + \'options\'}}" class="form-control" ng-model="data.value" ng-blur="setReferenceData()"><datalist id="{{kepsType.type + \'options\'}}"><option ng-repeat="option in data.options" value="{{option.value}}"></option></datalist></div><div ng-if="kepsType.type === \'string\'"><input type="text" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></div><div ng-if="kepsType.type === \'number\'"><input type="number" ng-required="kepsType.required" ng-model="data.value" class="form-control"></div><div ng-if="kepsType.type === \'boolean\'"><div class="radio-inline"><label><input type="radio" ng-required="kepsType.required" ng-model="data.value" ng-value="true">True</label></div><div class="radio-inline"><label><input type="radio" ng-required="kepsType.required" ng-model="data.value" ng-value="false">False</label></div></div><div ng-if="kepsType.type === \'file\'"><div class="row"><div class="form-group col-xs-6"><label>Import file from computer</label><input type="file" ng-required="kepsType.required" style="margin:15px" onchange="angular.element(this).scope().fileChanged(event)"></div><div class="col-xs-6"><ul style="list-style:none"><li><strong>File Info</strong></li><li>FileName: {{kepsModel.fileName}}</li><li>Size: {{kepsModel.fileSize}}</li></ul></div></div></div><div ng-if="kepsType.type === \'html\'"><text-angular ng-model="data.value" ng-required="kepsType.required" placeholder="{{kepsType.display.placeholder}}" ta-default-wrap="div"></text-angular>{{data.value}}</div><div ng-if="kepsType.type === \'datetime\'"><div class="row"><div class="form-group col-xs-6"><input type="date" ng-required="kepsType.required" class="form-control" ng-model="data.date" ng-blur="makeTime()" placeholder="yyyy-MM-dd"></div><div class="form-group col-xs-6"><input type="time" ng-required="kepsType.required" class="form-control" ng-model="data.time" ng-blur="makeTime()"></div></div></div><div ng-if="kepsType.type === \'image\'"><div class="row"><div class="form-group col-xs-5"><div ng-show="!import"><label>Import image from computer:</label><div class="btn"><input type="file" ng-required="kepsType.required" style="margin:15px" onchange="angular.element(this).scope().imageFileChanged(event)" accept="image/*"></div><a href="" ng-click="import = true;image.file = \'\'">Or... Upload an image from a url.</a></div><div ng-show="import"><label>Import image from url:</label><input type="text" ng-required="kepsType.required" class="form-control" ng-model="data.imageUrl" placeholder="Enter image url"><button style="margin-top:5px" class="btn btn-success" ng-click="getImageUrl()">Grab Image</button><br><a href="" ng-click="import = false;">Or... Upload a file from your computer</a></div></div><div class="col-xs-7"><canvas id="{{kepsType.randomCanvasId}}"></canvas><span ng-show="imageData.height && imageData.width">{{imageData.width + \' X \' + imageData.height}}</span></div></div></div><div ng-if="kepsType.type === \'url\'"><input type="url" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></div><div ng-if="kepsType.type === \'geopoint\'"><div class="col-sm-8"><div class="form-group"><label class="col-sm-4 control-label">Lat:</label><div class="col-sm-8"><input type="text" class="form-control"></div></div><div class="form-group"><label class="col-sm-4 control-label">Lng:</label><div class="col-sm-8"><input type="text" class="form-control"></div></div></div><div class="col-sm-4">Preview</div></div><div ng-if="kepsType.type === \'email\'"><input type="email" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></div><div ng-if="kepsType.type === \'enum\'"><select class="form-control" ng-model="data.value" ng-options="opt for opt in kepsType.options"></select></div><div ng-if="kepsType.type === \'multi\'"><select class="form-control" multiple="multiple" ng-multiple="true" ng-model="data.value" ng-options="opt for opt in kepsType.options"></select></div><div ng-if="kepsType.type === \'address\'"><!--http://ipinfo.io/--><div class="col-sm-8"><div class="form-group"><label class="col-sm-4 control-label">Address Line1:</label><div class="col-sm-8"><input type="text" class="form-control" placeholder="Email"></div><span class="help-block">Street address, P.O. box, company name, c/o</span></div><div class="form-group"><label class="col-sm-4 control-label">Address Line2:</label><div class="col-sm-8"><input type="text" class="form-control" placeholder="Email"></div><span class="help-block">Apartment, suite, unit, building, floor, etc.</span></div><div class="form-group"><label class="col-sm-4 control-label">City:</label><div class="col-sm-8"><input type="text" class="form-control" placeholder="Email"></div></div><div class="form-group"><label class="col-sm-4 control-label">State / Province / Region / County:</label><div class="col-sm-8"><input type="text" class="form-control" placeholder="Email"></div></div><div class="form-group"><label class="col-sm-4 control-label">ZIP / Postal Code / Postcode:</label><div class="col-sm-8"><input type="text" class="form-control" placeholder="Email"></div></div><div class="form-group"><label class="col-sm-4 control-label">Country:</label><div class="col-sm-8"><input type="text" class="form-control" placeholder="Email"></div></div></div><div class="col-sm-4">Preview Zoom 17 for address Zoom 9 for city Zoom 5 for state / small country Zoom 4 for country <img class="map" src="https://maps.googleapis.com/maps/api/staticmap?center=37.7367,-122.4572&amp;zoom=17&amp;size=200x200&amp;sensor=false" alt="San Francisco, California, United States Map" title="San Francisco, California, United States Map"></div></div><div ng-if="kepsType.type === \'phone\'"><!---http://jackocnr.com/intl-tel-input.html --> <input type="tel" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></div><span class="help-block" ng-if="kepsType.display.instructions">{{kepsType.display.instructions}}</span></div></div></section>');
}]),angular.module("ngKeps").directive("authorizationmodal",["$nkAuthService","$window","$rootScope",function(e,t,s){return{restrict:"E",templateUrl:"../templates/authModal.html",scope:{},controller:function(a){a.config=s.config,a.user=e.getUser(),a.show="login",a.login={},a.signin=function(s){e.loginWithProvider(s,a.login).then(function(e){a.msgs={},a.msgs.signedIn="Signed In!",setTimeout(function(){t._ngkeps_model_hide()},1500)},function(e){console.log(e),a.msgs={},a.msgs.error=e.errors[0].friendly})},a.signout=function(){e.logout(),location.href="/"},a.register=function(){a.msgs={},a.registerForm.$valid?a.newUser.password===a.rePassword?a.newUser.password.length>7?e.signupWithProvider("local",a.newUser).then(function(e){console.log(e),a.msgs.created=!0,setTimeout(function(){t._ngkeps_model_hide()},1500)},function(e){"DuplicateKey"==e.data.errors[0].message?a.msgs.emailUsed=!0:a.msgs={error:e.data.errors[0].friendly},console.log("ERR",e)}):a.msgs.passwordShort=!0:a.msgs.passwordsDontMatch=!0:a.msgs.formError=!0},a.showLogin=function(){a.show="login"},a.showRegister=function(){a.show="register"},a.showForgottenPassword=function(){a.show="forgottenPassword"},a.showTwoFactor=function(){a.show="twofactor"}}}}]),angular.module("ngKeps").directive("kepsForm",["$nkDataService",function(e){return{restrict:"E",templateUrl:"../templates/form.html",scope:{kepsData:"=",kepsModel:"=",kepsName:"=",kepsErrors:"=",kepsFramework:"@"},link:function(e,t,s){e.data={},console.log("KTYPE",e.kepsData),console.log("KMOD",e.kepsModel),e.kepsErrors={},e.kepsModel&&(e.data.value=e.kepsModel),e.$watch("data.value",function(t){"undefined"!=typeof t&&(e.kepsModel=t)}),e.$watch("kepsModel",function(t){"undefined"!=typeof t&&e.data.value!==t&&(e.data.value=t)})}}}]),angular.module("ngKeps").directive("inputItem",["$nkDataService","$http","$compile","$parse","$templateCache","$window","$timeout","imageInputService","validatorService",function(e,t,s,a,r,n,o,l,i){return{restrict:"E",scope:{kepsType:"&",kepsModel:"=",kepsName:"&",kepsGroupClass:"@",kepsInputClass:"@",kepsLabelClass:"@",kepsSubLabelClass:"@",kepsButtonClass:"@",kepsLabel:"@",kepsInstructions:"@",kepsErrors:"=?",kepsHideErrors:"&",kepsFramework:"@",kepsReadonly:"@"},link:function(a,n,o){function p(e){var t=["_id","_createdAt","_updatedAt","_seed","_v"],s={};for(var a in e)t.indexOf(a)>-1||(s[a]=e[a]);return s}function d(s){var r;r="?"===a.kepsType.type[1]?a.kepsType.type.slice(2):a.kepsType.type.slice(1),t.get(e.apiPrefix+"models").then(function(e){for(var t in e.data)if(t===r)return s(null,e.data[t].schema)},function(e){return console.error(e),s(e)})}a.hasOwnProperty("kepsErrors")&&(a.kepsErrors={}),"function"==typeof a.kepsType&&(a.kepsType=a.kepsType()),"string"==typeof a.kepsType&&(a.kepsType={type:a.kepsType}),"function"==typeof a.kepsName&&(a.kepsName=a.kepsName()),"''"===a.kepsLabel?a.kepsType.label="":"undefined"!=typeof a.kepsLabel&&a.kepsLabel.length>0?a.kepsType.label=a.kepsLabel:a.kepsType?a.kepsType.label&&""!==a.kepsType.label||(a.kepsType.label=a.kepsName):a.kepsType?a.kepsType.label=a.kepsName:(a.kepsType={},a.kepsType.label=a.kepsName),""===a.kepsInstructions?a.kepsType.instructions="":"undefined"!=typeof a.kepsInstructions?a.kepsType.instructions=a.kepsInstructions:a.kepsType.hasOwnProperty("instructions")||(a.kepsType.instructions=""),a.data={},a.data.id=Math.random(),"object"==typeof a.kepsType.required&&(a.data.subrequired=!0),a.kepsModel&&(a.kepsType.type&&"image"===a.kepsType.type?a.data.value=a.kepsModel:a.kepsType.type&&"file"===a.kepsType.type?a.data.value=a.kepsModel:a.kepsType.type&&"datetime"===a.kepsType.type?(a.data.date=new Date(a.kepsModel),a.data.time=new Date(a.kepsModel)):a.kepsType.type&&"date"===a.kepsType.type?a.data.date=new Date(a.kepsModel):a.data.value=a.kepsModel),"array"===a.kepsType.type||"multienum"===a.kepsType.type?a.$watch("data.value",function(e){"undefined"!=typeof e?a.kepsModel=e:"undefined"!=typeof a.kepsType["default"]&&(a.kepsModel=a.kepsType["default"])},!0):a.$watch("data.value",function(e){"undefined"!=typeof e?a.kepsModel=e:"undefined"!=typeof a.kepsType["default"]&&(a.kepsModel=a.kepsType["default"])}),a.$watch("kepsModel",function(e){"undefined"!=typeof e&&a.data.value!==e&&(a.data.value=e,"image"===a.kepsType.type&&l(a))}),"function"==typeof a.kepsFramework&&(a.kepsFramework=a.kepsFramework());var c=a.kepsFramework?a.kepsFramework:"bootstrapv3";"string"!=typeof c&&(c="bootstrapv3"),"materialize"!==c&&"bootstrapv3"!==c&&(c="bootstrapv3");var u=function(e){":"===e.slice(0,1)?t.get("../templates/"+c+"/referenceObject.html",{cache:r}).success(function(e){n.replaceWith(s(e)(a))}):t.get("../templates/"+c+"/"+e+".html",{cache:r}).success(function(e){n.replaceWith(s(e)(a))})};if("undefined"!=typeof a.kepsType.type){a.kepsType.type=a.kepsType.type.toLowerCase(),"undefined"!=typeof a.kepsType["default"]&&"undefined"==typeof a.data.value&&(a.data.value=a.kepsType["default"]);var g=["html","url","geopoint","email","datetime","date","richtext","phone","image","file","string","number","boolean","enum","multienum","address","array","arraymulti","object"];if(":"===a.kepsType.type.slice(0,1))u(a.kepsType.type);else if("_"===a.kepsType.type.slice(0,1))d(function(e,t){a.kepsType.type="object",a.kepsType.subSchema=p(t),u(a.kepsType.type)});else if(-1===g.indexOf(a.kepsType.type))a.typeError=!0,a.kepsType.type="string";else{if("array"===a.kepsType.type)if("string"==typeof a.kepsType.subSchema)a.kepsType.type="array";else{var m=0;for(var y in a.kepsType.subSchema)m++;m>1?a.kepsType.type="arraymulti":a.kepsType.type="array"}u(a.kepsType.type)}}else a.kepsType.type="string",u(a.kepsType.type);if("undefined"!=typeof a.kepsType.type&&0===a.kepsType.type.indexOf(":")){var f=a.kepsType.type.slice(1);t.get(e.apiPrefix+"models").then(function(e){for(var t in e.data)if(t===f)return e.data[t].properties&&e.data[t].properties.displayAs?(a.data.displayReferenceAs=e.data[t].properties.displayAs,v(f,a.data.displayReferenceAs)):e.data[t].schema.name?(a.data.displayReferenceAs="name",v(f,a.data.displayReferenceAs)):e.data[t].schema.title?(a.data.displayReferenceAs="title",v(f,a.data.displayReferenceAs)):e.data[t].schema.displayName?(a.data.displayReferenceAs="displayName",v(f,a.data.displayReferenceAs)):(a.data.displayReferenceAs="_id",v(f,a.data.displayReferenceAs))});var v=function(s,r){t.get(e.apiPrefix+"rest/"+s+"s").then(function(e){a.referenceOptions=[];for(var t=0;t<e.data.length;t++)a.referenceOptions.push({_id:e.data[t]._id,name:e.data[t][r]});if(a.kepsModel){a.data.value=a.kepsModel;for(var t=0;t<a.referenceOptions.length;t++)a.kepsModel===a.referenceOptions[t]._id&&(a.data.reference=a.referenceOptions[r])}})};a.setReferenceData=function(){for(var e=0;e<a.referenceOptions.length;e++)a.referenceOptions[e][a.data.displayReferenceAs]===a.data.reference&&(a.data.value=a.referenceOptions[e]._id)}}a.kepsModel&&("datetime"===a.kepsType.type?(a.data.date=new Date(a.kepsModel),a.data.time=new Date(a.kepsModel)):"date"===a.kepsType.type?(a.data.value=a.kepsModel,a.data.date=new Date(a.kepsModel)):a.data.value=a.kepsModel),a.makeTime=function(){a.data.time&&a.data.date?a.kepsModel=new Date(a.data.date.toString().slice(0,15)+a.data.time.toString().slice(15)).getTime():a.kepsModel=new Date(a.data.date).getTime()};var k,b;if("array"===a.kepsType.type)for(a.data.value=a.kepsModel||[],a.showArrayItem=[],b=a.data.value.length,k=0;b>k;k++)a.showArrayItem.push(!1);else if("arraymulti"===a.kepsType.type)for(a.data.value=a.kepsModel||[],a.showArrayItem=[],b=a.data.value.length,k=0;b>k;k++)a.showArrayItem.push(!1);a.addArrayItem=function(){var e=0;for(var t in a.kepsType.subSchema)e++;if(e>1){var s={};for(var r in a.kepsType.subSchema)a.kepsType.subSchema[r]["default"]&&(s[r]=a.kepsType.subSchema[r]["default"]);a.showArrayItem[a.data.value.length]=!0,a.data.value.push(JSON.parse(JSON.stringify(s)))}},a.removeArrayItem=function(e){a.data.value.splice(e,1)},"image"===a.kepsType.type&&l(a),"file"===a.kepsType.type&&fileInputService(a),"geopoint"===a.kepsType.type&&geopointInputService(a),"multienum"===a.kepsType.type&&(Array.isArray(a.kepsModel)?a.data.value=a.kepsModel:a.data.value=[],a.checkMulti=function(e){var t=a.data.value.indexOf(e);t>-1?a.data.value.splice(t,1):a.data.value.push(e)},a.inArray=function(e){return a.data.value.indexOf(e)>-1?!0:!1}),"richtext"===a.kepsType.type&&(a.richToolbar=[["keps-fontsize","bold","italics","underline","strikeThrough","keps-alignment","wordcount"]]),a.errorChecking=function(){switch(a.kepsErrors={},a.kepsType.type){case"string":return i.stringValidation(a);case"number":return i.numberValidation(a);case"image":return i.fileValidation(a);case"richText":return i.richTextValidation(a);case"geopoint":return i.geopointValidation(a);case"multienum":return i.multiValidation(a);case"email":return i.emailValidation(a)}}}}}]),angular.module("ngKeps").directive("numbersOnly",function(){return{require:"ngModel",link:function(e,t,s,a){function r(e){if(e&&"string"==typeof e){var t=e.replace(/[^0-9]/g,"");return t!==e&&(a.$setViewValue(t),a.$render()),t}return"number"==typeof e?(a.$setViewValue(e),a.$render(),e):void 0}a.$parsers.push(r)}}}),angular.module("ngKeps").service("$nkAnalyticsService",["$timeout","$nkDataService",function(e,t){var s={},a={};return a.queue=[],a.interval=1e4,s.event=function(e,t){var s={action:"track",event:name,properties:data,timestamp:(new Date).toISOString()};userId?s.userId=userId:s.sessionId=sessionId,queue.push(s)},s.identify=function(e,t){var s={action:"identify",traits:data,timestamp:(new Date).toISOString()};e&&""!==e?(userId=e,s.userId=userId):s.userId="anonymousId",queue.push(s)},s.setInterval=function(e){a.interval=e},a.flush=function(){if(queue.length>0){var e={batch:queue},t=JSON.parse(JSON.stringify(e));queue=[],$http.post("/segment_io/import",t).then(function(){},function(){})}a.flushTimeout()},a.flushTimeout=function(){e(function(){a.flush()},a.interval)},a.flushTimeout(),s}]),function(){var e=null,t={},s="/api/v1/";angular.module("ngKeps").provider("$nkAuthService",[function(){this.setApiPrefix=function(e){s=e},this.setLogoutHref=function(t){e=t},this.$get=["$http","$location","$window","$q","$nkDataService","$nkModalService","$rootScope","$compile",function(a,r,n,o,l,i,p,d){var c={},u=!1,g=r.host();return c.showModal=function(e){u?e(u):(newElement=d("<authorizationmodal></authorizationmodal>")(p),i.show({content:newElement,source:"angular-element",close:function(){e(u)}}))},c.start=function(l){t=l,window.$http=a;var i=o.defer();try{u=JSON.parse(n.localStorage[g+"-user"])}catch(d){}u&&(a.get(s+"users/me").then(function(e){u=e.data,u||(n.localStorage.setItem(g+"-user",JSON.stringify(u)),i.resolve(u),l.user=u)},function(t){u?(delete n.localStorage[g+"-user"],e&&(r.href=e)):i.reject(u)}),l.user=u,i.resolve(u));var c=document.createElement("a");return c.href=s,a.get(c.origin+"/api/config").then(function(e){p.config=e.data},function(e){alert("server down")}),i.promise},c.getUser=function(){return u},c.loginWithProvider=function(e,r){var l=o.defer();return"local"===e?a.post(s+"users/signin",r).then(function(e){if(e.data===!1)l.reject();else{var s=e.data;s.expiration=Date.now(),n.localStorage.setItem(g+"-user",JSON.stringify(s)),u=s,t.user=u,l.resolve(s)}},function(e){l.reject(e.data)}):location.href=s+"oauths/"+e,l.promise},c.signupWithProvider=function(e,r){var l=o.defer();return"local"===e?a.post(s+"users/signup",r).then(function(e){var s=e.data;s===!1?l.reject():(s.expiration=Date.now(),n.localStorage.setItem(g+"-user",JSON.stringify(s)),u=s,t.user=u,l.resolve(s))},function(e){l.reject(e)}):location.href="/auth/"+e,l.promise},c.logout=function(){delete n.localStorage[g+"-user"],u=!1},c.getPaymentToken=function(){var e=o.defer();return l.get("customers/token").then(function(t){e.resolve(t.data)},function(t){e.reject(t)}),e.promise},c.checkout=function(){var e=o.defer();return l.post("customers/checkoutWithPaymentMethod").then(function(t){e.resolve(t.data)},function(t){e.reject(t)}),e.promise},c.checkPaymentMethod=function(){var e=o.defer();return l.get("customers/checkPaymentMethod").then(function(t){e.resolve(t.data)},function(t){e.reject(t)}),e.promise},c.firstTimeCheckout=function(e){var t=o.defer();return l.post("customers/firstTimeCheckout",{payment_method_nonce:e}).then(function(e){t.resolve(e.data)},function(e){t.rejeoct(e)}),t.promise},c}]}]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","$window",function(a,r,n){var o=r.host();return{request:function(e){e.headers=e.headers||{};try{user=JSON.parse(n.localStorage[o+"-user"]),user.token&&(e.headers.Authorization="Bearer "+user.token)}catch(t){}return e},response:function(e){var a=document.createElement("a");a.href=e.config.url;var r=document.createElement("a");if(r.href=s,0===a.href.indexOf(r.href)&&(console.log(e.config.url),e.headers("x-user-token-refresh")))try{n.localStorage.setItem(o+"-user",e.headers("x-user-token-refresh")),t.user=JSON.parse(e.headers("x-user-token-refresh"))}catch(l){alert(l)}return e},responseError:function(t){return 401===t.status&&(delete n.localStorage[o+"-user"],e&&(r.href=e)),a.reject(t)}}}])}]).run(["$nkAuthService","$rootScope",function(e,t){e.start(t)}])}(),angular.module("ngKeps").service("$nkCacheService",[function(){var e,t={},s={},a={get:function(e){return JSON.parse(localStorage.getItem(e))},set:function(e,t){localStorage.setItem(e,JSON.stringify(t))},check:function(e){return"undefined"!=typeof localStorage.getItem(e)&&null!==localStorage.getItem(e)}},r=0,n=0;return t.storage=a,s.init=function(){if(a.check("objects")){var e=a.get("objects");variable.constructor===Array&&t.loadCache(e)}},t.clearCache=function(){localStorage.clear(),loc=location.href,loc=loc.substr(0,loc.indexOf("#")),location.href=loc},t.loadCacheObj=function(t,s){if(a.check(t+"-"+s))try{var r=a.get(t+"-"+s);e[t].objects[s]=r,n++}catch(o){console.log("Error on parse",o),console.log(t+"-"+s,a.get(t+"-"+s))}else console.log("Object",t+"-"+s," in index but not cache")},t.loadCacheType=function(s){if(e[s]={objects:{},schema:{},objectCallbacks:[],index:[],collection:[]},a.check(s+"-count")||a.set(s+"-count",0),a.check(s+"-index"))try{e[s].index=a.get(s+"-index"),r++;for(var n=0;n<e[s].index.length;n++)t.loadCacheObj(s,e[s].index[n])}catch(o){console.log("Error on index parse",o),console.log(s+"-index",a.get(s+"-index"))}},t.loadCache=function(e){for(var s=0;s<e.length;s++)t.loadCacheType(e[s]);console.log("finished loading cache",r,"indexes loaded",n,"objects loaded",JSON.stringify(localStorage).length/25e5+"% of cache used")},t.inCache=function(t,s){return s in e[t].objects?!0:!1},t.addObj=function(t,a,r,n){return object._pending=n,object._id in e[objectType].objects?e[objectType].objects[object._id]=angular.extend(e[objectType].objects[object._id],object):e[objectType].objects[object._id]=object,s.runObjectCallbacks(objectType,e[objectType].objects[object._id]),"objects-"+objectType+"-"+object._id in localStorage||(localStorage.objectsCount=parseInt(localStorage.objectsCount)+1,localStorage[objectType+"Count"]=parseInt(localStorage[objectType+"Count"])+1),localStorage["objects-"+objectType+"-"+object._id]=JSON.stringify(e[objectType].objects[object._id]),-1===e[objectType].index.indexOf(object._id)&&(e[objectType].index.push(object._id),localStorage["objects-"+objectType+"-index"]=JSON.stringify(e[objectType].index)),serverdt!==!1&&(localStorage["objects-"+objectType+"-dt"]=serverdt),e[objectType].objects[object._id]},t.addArray=function(s,a,r,n){for(var o=[],l=0;l<array.length;l++)t.addObject(s,a[l],r,n),o.push(e[objectType].objects[array[l]._id]);return o},t.removeObj=function(t,s,a){s in e[t].objects&&delete e[t].objects[s],"objects-"+t+"-"+s in localStorage&&(localStorage.objectsCount=parseInt(localStorage.objectsCount)-1,localStorage[t+"-count"]=parseInt(localStorage[t+"-count"])-1,delete localStorage[t+"-"+s]);var r=e[t].index.indexOf(s);-1!=r&&(e[t].index=e[t].index.splice(r,1),localStorage[t+"-index"]=JSON.stringify(e[t].index)),serverdt!==!1&&(localStorage[t+"-dt"]=a)},t.getObj=function(t,s){return e[t].objects[s]},t.getObjCount=function(t){return t in e?e[t].count:0},t.getObjectIndex=function(t){return t in e?e[t].index:[]},t.getCollection=function(t){return t in e?e[t].collection:[]},t.getSyncObject=function(t,s){var a={};if("undefined"!=typeof s)t in e&&s in e[t].objects&&(a[t]={},a[t][s]=e[t].objects[s]);else if("undefined"!=typeof t&&t in e){a[t]={};for(var r=e[t].collection.length-1;r>=0;r--)a[t][e[t].collection[r]._id]=e[t].collection[r]._v}else for(var n in e){a[n]={};for(var r=e[n].collection.length-1;r>=0;r--)a[n][e[n].collection[r]._id]=e[n].collection[r]._v}return a},t.getTypes=function(){var t=[];for(var s in e)t.push(s);return t},t.addType=function(t,s){type in e},t.loadPostProcessObject=function(t,s){dataServiceReadyDeferred.promise.then(function(){e[t].objectCallbacks.push(s)})},s.runObjectCallbacks=function(t,s){for(var a=$q.defer(),r=[],n=0;n<e[t].objectCallbacks.length;n++)r.push(e[t].objectCallbacks[n](s));return $q.all(r).then(function(){a.resolve()}),a.promise},s.init(),t}]),angular.module("ngKeps").service("$nkDataService",["$nkSocketService","$nkRestService",function(e,t){return e.error?t:e}]),angular.module("ngKeps").service("$nkModalService",["$window","$document",function(e,t){function s(e,t,s){e.addEventListener?e.addEventListener(t,s):e.attachEvent("on"+t,function(){s.call(e)})}function a(){r=t[0].createElement("div"),n=t[0].createElement("div"),o=t[0].createElement("div"),l=t[0].createElement("div"),n.id="ngkeps_content_fixed",n.setAttribute("style","position:fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);opacity:1;z-index:2003;background-color:white; border-radius: 6px;padding: 20px 30px;"),o.id="ngkeps_popbox",l.id="ngkeps_overlay_wrapper",l.setAttribute("style","position:absolute;top:0;bottom:0;left:0;right:0;z-index:2002;"),r.id="ngkeps_overlay",r.setAttribute("style","position:fixed;top:0;bottom:0;left:0;right:0;opacity:0.3;width:100%;height:100%;background-color:black;z-index:2002;"),l.appendChild(r),n.appendChild(o),t[0].body.appendChild(l),t[0].body.appendChild(n),l.style.display="none",r.style.display="none",n.style.display="none",l.addEventListener("click",d),s(e,"keypress",function(e){27==e.keyCode&&d()})}var r,n,o,l,i=null,p=function(e){if(e){var s='<button type="button" class="close" onclick="window._ngkeps_model_hide(\'top_close\')" style="border: 1px solid #fff;border-radius: 15px;width: 32px;height: 32px;right: 0px;position: absolute;outline: none;color: #fff;transition: all 0.6s ease 0s;-webkit-transition: all 0.6s ease 0s;-moz-transition: all 0.6s ease 0s;-o-transition: all 0.6s ease 0s;-ms-transition: all 0.6s ease 0s;-webkit-backface-visibility: hidden;opacity: 0.6;filter: alpha(opacity=60);top: -40px;margin-top: -2px;"><span style="position: relative;top: -2px;">x</span></button>';"string"==typeof e["class"]&&e["class"]&&o.setAttribute("class",e["class"]),e.keepLayout&&!e["class"]&&o.setAttribute("style","position:relative;height:300px;width:300px;background-color:white;opacity:1;"),"string"==typeof e.content&&e.content&&"html"==e.source&&(s+=e.content),"string"==typeof e.content&&e.content&&"div"==e.source&&(s+=t[0].getElementById(e.content)?t[0].getElementById(e.content).innerHTML:e.content);var a="";if(e.buttons)for(var p=0;p<e.buttons.length;p++)"object"==typeof e.buttons[p]?a+="<button onclick=\"window._ngkeps_model_hide('"+e.buttons[p].label+'\')" class="'+e.buttons[p]["class"]+'" style="margin-left: 10px;">'+e.buttons[p].label+"</button>":"string"==typeof e.buttons[p]&&(a+="<button onclick=\"window._ngkeps_model_hide('"+e.buttons[p]+'\')" class="btn" style="margin-left: 10px;">'+e.buttons[p]+"</button>");""!==a&&(s+='<div style="text-align: right;padding-top: 10px;margin-top: 10px;">'+a+"</div>"),o.innerHTML=s,e.content&&"element"===e.source&&o.appendChild(e.content),e.content&&"angular-element"===e.source&&angular.element(o).append(e.content)}l.style.display="",r.style.display="",n.style.display="",i=e.close},d=e._ngkeps_model_hide=function(e){l.style.display="none",r.style.display="none",n.style.display="none",i&&i(e)};return a(),{show:p,hide:d}}]),angular.module("ngKeps").provider("$nkRestService",function(){var e="/api/v1/";this.setApiPrefix=function(t){e=t},this.$get=["$http","$q","$nkCacheService",function(t,s,a){var r={},n={};r.apiPrefix=e;var o=function(e,t,s){if(!t)return n[e]?n[e]:!1;if("id"===s)return n[t]?n[t]:!1;if("query"===s){var a=e+JSON.stringify(t);return n[a]?n[a]:!1}};return r.post=r.create=function(a,r){var n=s.defer();return t.post(e+a,r).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise},r.put=r.update=function(a,r){var n=s.defer();return t.put(e+a+"/"+r._id,r).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}),n.promise},r["delete"]=function(a,r){var n,o=s.defer();return n=r&&"object"==typeof r?e+a+"/"+r._id:"string"==typeof r?e+a+"/"+r:e+a,t["delete"](n).then(function(e){o.resolve(e.data)},function(e){o.reject(e)}),o.promise},r.get=r.read=function(a,r,l){var i=s.defer();if(r){var p=!1;("undefined"===l||l===!0)&&(p=o(a,r,"id")),p?i.resolve(p):t.get(e+a+"/"+r).then(function(e){i.resolve(e),n[r]=e},function(e){i.reject(e)})}else l&&p.hasOwnProperty(a)?i.resolve(p[a]):t.get(e+a).then(function(e){i.resolve(e),n[a]=e},function(e){i.reject(e)});return i.promise},r.query=function(a,r,l){var i=s.defer(),p=!1;if(("undefined"===l||l===!0)&&(p=o(a,r,"query")),p)i.resolve(p);else{var d=e+a;r&&(d+="?query="+JSON.stringify(r)),t.get(d).then(function(e){if(i.resolve(e.data),r){var t=a+JSON.stringify(r);n[t]=e}else n[a]=e},function(e){i.reject(e)})}return i.promise},r.graphql=function(a){var r=s.defer();return t.get(e+"graphqls?q="+a).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},r.call=function(a,r){var n=s.defer(),o=a.substr(0,a.indexOf(".")).toLowerCase();a=a.substr(a.indexOf(".")+1);var l=a.substr(0,a.indexOf("."));a=a.substr(a.indexOf(".")+1),"undefined"==typeof r&&(r={});var i=e+l+"s/"+a;if(l in r){var p;"object"==typeof r[l]&&"_id"in r[l]?p=r[l]._id:(p=r[l],delete r[l]),i=e+l+"s/"+p+"/"+a}if("get"===o||"delete"===o){var d=function(e,t){var s=[];for(var a in e)if(e.hasOwnProperty(a)){var r=t?t+"["+a+"]":a,n=e[a];s.push("object"==typeof n?d(n,r):encodeURIComponent(r)+"="+encodeURIComponent(n))}return s.join("&")};i+="?"+d(r),t[o](i).then(function(e){n.resolve(e.data)},function(e){n.reject(e)})}else"post"===o||"put"===o?t[o](i,r).then(function(e){n.resolve(e.data)},function(e){n.reject(e)}):t.get(i).then(function(e){n.resolve(e.data)},function(e){n.reject(e)});return n.promise},r.sync=function(e,n){var o=s.defer();if("undefined"!=typeof e){var l=a.getSyncObject(e,n);t.post("/"+e+"/sync",l).success(function(e){o.resolve()}).error(function(){o.reject(),console.log("Get - Failed to retrieve data")})}else{for(var i=a.getTypes,p=[],d=i.length-1;d>=0;d--)p.push(r.sync(i[d]));s.all(p).then(function(){o.resolve()})}return o.promise},r.loginWithProvider=function(a,r){var n=s.defer();return"local"===a?t.post(e+"users/signin",r).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}):location.href="/auth/"+a,n.promise},r.signupWithProvider=function(a,r){var n=s.defer();return"local"===a?t.post(e+"users/signup",r).then(function(e){n.resolve(e.data)},function(e){n.reject(e.data)}):location.href="/auth/"+a,n.promise},r.loadPostProcessObject=a.loadPostProcessObject,r}]}),angular.module("ngKeps").service("$nkSchemaService",["$nkDataService",function(e){}]),angular.module("ngKeps").service("$nkSocketService",["$window","$timeout","$q","$nkCacheService",function(e,t,s,a){if(!e.io)return{error:"socket.io not available"};var r,n,o,l,i,p,d={},c={},u=0,g=1,m=[],y={},f="",v=0,k=2e3,b=!0,h=null,T=null,w=null,x={},j=[],q=0,S=0,C=0,M=0,I=0,O=[];e.socket=r;var E=[],$=!1,L=s.defer(),R=function(){},A=!1;return d.getStatus=function(){var e={};return e.lastRequestSent=i,e.lastRequestReceived=p,e.numberOfOutstandingRequests=q,e.numberOfRequests=S,e.cacheHit=C,e.requestsReceived=O,e.duplicateRequest=I,e},d.clearCache=function(e){e?a.clearCache():a.clearCache()},d.start=function(e,t,a){return T=s.defer(),o=e,f=t,o.connected=!1,o.reconnect=!1,o.cacheLoaded=!1,g=a,L.resolve(),c.setupSocket(),T.promise},d.loginWithProvider=function(e,t){return null===w&&(w=s.defer()),T.promise.then(function(){r.emit("login",{provider:e,data:t,device:o.device})}),w.promise},d.logout=function(){T.promise.then(function(){r.emit("logout.me",{device:o.device})})},d.add=function(e,t){var a="post."+e+".create",n=s.defer();return"_id"in t||(t._id=uuid.v4().replace(/-/g,"").substring(0,24)),t._pending=!0,c.addObject(e,t,!1,!0),L.promise.then(function(){if(o.connected)if(-1!==m.indexOf(a)){var s=c.getReqKey(a,n);r.emit(a,{objectType:e,object:t,reqKey:s})}else n.reject("No create command on server");else j.push({method:a,restMethod:"post",payload:{objectType:e,object:t},deferred:n})}),n.promise},d.update=function(e,t){var a="put."+e+".update",n=s.defer();return L.promise.then(function(){if(o.connected)if(-1!==m.indexOf(a)){var s=c.getReqKey(a,n),l={objectType:e,object:t,reqKey:s};l[e]=t._id,r.emit(a,l)}else n.reject("No update command on server");else{var i={objectType:e,object:t};i[e]=t._id,j.push({method:a,restMethod:"put",payload:i,deferred:n})}}),n.promise},d["delete"]=function(e,t){var a="delete."+e+".delete",n=s.defer();return L.promise.then(function(){if(o.connected)if(-1!==m.indexOf(a)){var s=c.getReqKey(a,n);r.emit("delete.object",{objectType:e,object:t,reqKey:s})}else n.reject("No delete command on server");else console.log("TODO can not delete objects while offline"),n.reject("TODO can not delete objects while offline")}),n.promise},d.get=function(e,t){var a="get."+e+".read",n=s.defer();return L.promise.then(function(){if(e in objects)if(t in objects[e].objects)C++,n.resolve(objects[e].objects[t]);else if("objects-"+e+"-"+t in localStorage&&!o.connected)M++,n.resolve(JSON.parse(localStorage["objects-"+e+"-"+t])),console.log("Warning: Object requested before cache loaded",e+"-"+t);else{if(x[a+"-"+e+"-"+t])return I++,x[a+"-"+e+"-"+t];if($)E.push({objectType:e,objectId:t,deferred:n});else{x[a+"-"+e+"-"+t]=n.promise;var s={objectType:e};s[e]=t,o.connected?m.indexOf(a)?(s.reqKey=c.getReqKey(a,n),r.emit(a,s)):n.reject("No read command on server"):j.push({method:a,restMethod:"get",payload:s,deferred:n})}}else n.reject("Not registered for object type "+e)}),n.promise},d.getArray=function(e,t){var a="get."+e+".read",n=s.defer();return L.promise.then(function(){var s={objectType:e};s[e]=t,o.connected?-1!==m.indexOf(a)?(s.reqKey=c.getReqKey(a,n),r.emit(a,s)):n.reject("No read command on server"):j.push({method:a,restMethod:"read",payload:s,deferred:n})}),y[reqKey].promise},d.getQuery=function(e,t){var a="get."+e+".query",n=s.defer();return L.promise.then(function(){if(o.connected)if(-1!==m.indexOf(a)){var s=c.getReqKey(a,n);r.emit(a,{objectType:e,query:t,reqKey:s})}else n.reject("No query command on server");else j.push({method:a,restMethod:"get",payload:{objectType:e,query:t},deferred:n})}),n.promise},d.localQuery=function(e,t){var a=s.defer();return L.promise.then(function(){var t=[];for(var s in objects[e].objects)t.push(objects[e].objects[s]);a.resolve(t)}),a.promise},d.runCommand=function(e,t){var a=s.defer();return L.promise.then(function(){o.connected?-1!==m.indexOf(e)?(t.reqKey=c.getReqKey("callback",a),console.log("*** emit",e,t),r.emit(e,t)):a.reject('No command "'+e+'"on server'):j.push({method:e,restMethod:"callback",payload:t,deferred:a})}),a.promise},d.loadPostProcessObject=a.loadPostProcessObject,d.sync=function(e){var t={};t.objects=a.getSyncObject(),e&&(t.user=e),r.emit("sync",t)},c.findValues=function(e,t,s,a){return _.isArray(a)||(a=[]),_.isString(s)||(s=""),_.forOwn(e,function(r,n){s+n===t?a.push(r):findValues(r,t,_.isArray(e)?s:s+n+".",a)}),a},c.initalConnect=function(){console.log("trying to connect"),r?r.io.connect():e.socket=r=io.connect("http://"+f+"/",{"sync disconnect on unload":!1,reconnect:!1,transports:["websocket","polling"]}),l=t(function(){o.connected||(b=!1,n&&clearInterval(n),c.initalConnect())},15e3)},c.addObjects=function(e,t){var a,r,n=s.defer(),o=[];E=[],$=!0;for(a in e)for(r=0;r<e[a].length;r++)o.push(c.addObject(a,e[a][r],t,!1));return E.length>0&&c.runNestedLoadingRequests(),s.all(o).then(function(){$=!1,n.resolve()}),n.promise},c.runNestedLoadingRequests=function(){for(var e=0;e<E.length;e++){var t=E[e];t.objectId in objects[t.objectType].objects?t.deferred.resolve(objects[t.objectType].objects[t.objectId]):d.get(t.objectType,t.objectId).then(function(e){t.deferred.resolve(e)})}},c.getReqKey=function(e,t){var s=e+"-"+r.io.engine.id+"-"+v;return y[s]=t,i=s,v++,S++,q++,s},c.processReqKey=function(e,t,s){e in y&&(p=e,y[e].resolve(t),q--,delete y[e],"objects"===s?O.push(e.substr(0,e.indexOf("-"))+" objects"):"callback"===s?O.push(e.substr(0,e.indexOf("-"))+" callback"):"object"==typeof t?"[object Array]"===Object.prototype.toString.call(t)?O.push(e.substr(0,e.indexOf("-"))+" "+s+" array"):"_id"in t?O.push(e.substr(0,e.indexOf("-"))+" "+s+" "+t._id):O.push(e.substr(0,e.indexOf("-"))+" "+s+" unknown"):O.push(e.substr(0,e.indexOf("-"))+" "+s+" unknown"))},c.rejectReqKey=function(e,t){e in y&&(p=e,y[e].reject(payload),q--,delete y[e])},c.flushOfflineRequests=function(){if(j.length>0){var e;for(e=0;e<j.length;e++){var t=j[e];if(t.objectType in objects&&t.objectId in objects[t.objectType].objects&&"get"===t.restMethod)null!==t.deferred&&t.deferred.resolve(objects[t.objectType].objects[t.objectId]);else if(m.indexOf(t.method)){var s=c.getReqKey(t.method,t.deferred);t.payload.reqKey=s,r.emit(t.method,t.payload)}else t.deferred.reject("Command not on server")}}j=[]},c.setupSocket=function(){c.initalConnect(),r.on("error",function(e){console.error("Socket Error",JSON.stringify(e))}),r.on("disconnect",function(e){o.connected=!1,A=!0,b&&(n=setInterval(function(){r.io.connect()},k))}),r.on("reconnect",function(e){}),r.on("reconnecting",function(e){b&&(o.reconnect=!0)}),r.on("connect",function(e){console.log("connected"),n&&clearInterval(n),t.cancel(l),r.emit("client.register",{device:o.device}),o.$safeApply(function(){o.connected=!0,A&&o.user&&d.loadUser(),o.reconnect=!1})}),r.on("client.objects",function(e){if(u=e.backendVersion,u>g)T.reject("backendVersion");else{for(var t in e.objects)a.addType(t,e.objects[t].schema);a.storage.set("commands",e.commands),m=e.commands,T.resolve(),d.sync()}}),r.on("err",function(e){-1!==e.func.indexOf("get.me")&&(h.reject(),A&&(A=!1,R())),e.reqKey&&c.rejectReqKey(e.reqKey,e.message),console.error("Socket Server Error",JSON.stringify(e))}),r.on("get.me",function(e){A=!1,o.user=e.user,objects.user.objects[e.user._id]=e.user,c.addObject("user",e.user,e.dt,!1),e.objects?c.addObjects(e.objects,e.dt).then(function(){c.flushOfflineRequests(),h.resolve()}):(c.flushOfflineRequests(),h.resolve())}),r.on("login.successful",function(e){w.resolve(e),d.sync()}),r.on("login.unsuccessful",function(e){w.resolve(!1)}),r.on("remove",function(e){e.objectType in objects&&(c.removeObject(e.objectType,e.object,e.dt),e.reqKey&&c.processReqKey(e.reqKey,objects[e.objectType].objects[e.object._id],e.objectType))}),r.on("update",function(e){if(e.objectType in objects&&"object"in e)if("[object Array]"===Object.prototype.toString.call(e.object)){var t=c.addArray(e.objectType,e.object);e.reqKey&&c.processReqKey(e.reqKey,t,e.objectType)}else if(c.addObject(e.objectType,e.object,e.dt,!1),e.reqKey){c.processReqKey(e.reqKey,objects[e.objectType].objects[e.object._id],e.objectType);var s=e.reqKey.substring(0,e.reqKey.indexOf("-"));s+"-"+e.objectType+"-"+e.objectId in x&&delete x[s+"-"+e.objectType+"-"+e.objectId]}"objects"in e&&c.addObjects(e.objects,e.dt).then(function(){e.reqKey&&c.processReqKey(e.reqKey,t,"objects")})}),r.on("callback",function(e){e.reqKey&&c.processReqKey(e.reqKey,e.payload,"callback");
})},d}]),angular.module("ngKeps").service("fileInputService",["validatorService",function(e){return function(t){if(t.fileChanged=function(s){t.uploadStatus="Checking...";var a=e.fileValidation(t,s.target.files[0]);if(a){t.uploadStatus="Uploading...";var r=new FormData;r.append("file",s.target.files[0]);var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(t.kepsModel=JSON.parse(n.responseText),t.uploadStatus="Filename: "+t.kepsModel.fileName+", File size: "+t.kepsModel.fileSize,t.$apply())},n.open("POST","/admin/upload/file",!0),n.send(r)}},t.kepsType.fileTypes&&Array.isArray(t.kepsType.fileTypes)){t.kepsAcceptFileTypes=t.kepsType.fileTypes[0];for(var s=1;s<t.kepsType.fileTypes.length;s++)t.kepsAcceptFileTypes+=","+t.kepsType.fileTypes[s]}}}]),angular.module("ngKeps").service("geopointInputService",[function(){return function(e){e.kepsModel&&(e.data.value=e.kepsModel,e.data.lat=e.kepsModel[0],e.data.lng=e.kepsModel[1]);var t,s,a=!0;e.testLatLng=function(){if(e.data.lat<=85&&e.data.lat>=-85&&e.data.lng<=180&&e.data.lng>=-180)if(e.data.lat&&e.data.lng&&a){var r=function(){var r=new google.maps.LatLng(e.data.lat,e.data.lng);t=new google.maps.Map(document.getElementById("map"),{center:r,zoom:6}),s=new google.maps.Marker({position:r,map:t}),a=!1};if("undefined"==typeof google){var n=document.createElement("script");n.src=window.location.protocol+"//maps.googleapis.com/maps/api/js?callback=initMap",document.body.appendChild(n)}else r()}else if(e.data.lat&&e.data.lng){var o=new google.maps.LatLng(e.data.lat,e.data.lng);s.setMap(null),s=new google.maps.Marker({position:o,map:t}),t.setCenter(s.getPosition()),e.data.value=[e.data.lat,e.data.lng]}}}}]),angular.module("ngKeps").service("imageInputService",["validatorService",function(e){return function(t){if(t.kepsType.randomCanvasId=Math.ceil(9999*Math.random()),"object"==typeof t.kepsModel&&"undefined"!==t.kepsModel.absoluteFilePath){var s=new Image;s.src=t.kepsModel.filePath,s.onload=function(){t.drawToCanvas(s)}}t.imageFileChanged=function(s){if(e.fileValidation(t,s.target.files[0])){var a=new FormData;t.kepsType.imageError=!1;var r;if(s.target.files[0].name.includes(".jpg")?r="image/jpg":s.target.files[0].name.includes(".png")?r="image/png":window.alert("image filetype not recognized"),t.kepsType.size&&t.kepsType.size<s.target.files[0].size)return void t.$apply(function(){t.kepsType.imageUploading=!1,t.kepsType.imageError="File size exceeds maximum allowed: "+t.kepsType.size+"B"});var n=new Image;n.src=URL.createObjectURL(s.target.files[0]),n.onload=function(){t.drawToCanvas(n),t.imageStatus="Uploading...",a.append("file",s.target.files[0]),a.append("data",s.target.files[0]);var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(200!==e.status&&304!==e.status?413===e.status?t.$apply(function(){t.kepsType.imageError="Error uploading image: Image rejected due too image size:   "+e.responseText}):t.$apply(function(){t.kepsType.imageError="Error uploading image: "+e.status+": "+e.responseText}):t.$apply(function(){t.kepsType.imageUploading=!1,t.kepsModel=JSON.parse(e.responseText),t.imageStatus="Filename: "+t.kepsModel.fileName+", File size: "+t.kepsModel.fileSize}))},e.open("POST","/admin/upload/image",!0),e.send(a)}}},t.getImageUrl=function(){if(t.kepsType.imageUrl&&t.kepsType.imageUrl.match(/(\S+\.[^\/\s]+(\/\S+|\/|))/g)){var e=(document.getElementById(t.kepsType.randomCanvasId),new Image);e.src=t.kepsType.imageUrl,e.onload=function(){t.imageStatus="Uploading...";var s=new FormData;s.append("url",t.kepsType.imageUrl);var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&t.$apply(function(){t.kepsModel=JSON.parse(a.responseText),t.imageStatus="Filename: "+t.kepsModel.fileName+", File size: "+t.kepsModel.fileSize})},a.open("POST","/admin/upload/image",!0),a.send(s),t.drawToCanvas(e)}}},t.drawToCanvas=function(e,s){var a,r=document.createAttribute("width"),n=document.createAttribute("height"),o=document.getElementById(t.kepsType.randomCanvasId);e.width>e.height?(r.value=e.width>300?300:e.width,n.value=e.width>300?e.height/e.width*300:e.height):e.height>e.width&&(n.value=e.height>300?300:e.height,r.value=e.height>300?e.width/e.height*300:e.width),o.setAttributeNode(r),o.setAttributeNode(n),a=o.getContext("2d"),a.drawImage(e,0,0,r.value,n.value),a.fillStyle="black",a.font="bold 16px serif",a.fillText(e.height+" X "+e.width,.05*r.value,n.value-5)},t.removeImage=function(){for(var e=document.getElementById(t.kepsType.randomCanvasId),s=e.getContext("2d"),a=e.width,r=e.height,n=s.createImageData(a,r),o=n.data.length;--o>=0;)n.data[o]=0;s.putImageData(n,0,0),delete t.kepsModel}}}]),angular.module("ngKeps").service("validatorService",[function(){var e=function(e){if(e.errorMsg=!1,e.kepsType.match){var t;if("string"!=typeof e.kepsType.match)return;if(t=new RegExp(e.kepsType.match),console.log(t.test(e.data.value)),!t.test(e.data.value))return e.kepsErrors&&(e.kepsErrors.pattern="Input does not match pattern"),e.errorMsg="Input does not match pattern"}return e.kepsType.maxlength&&e.data.value.length>e.kepsType.maxlength?(e.kepsErrors&&(e.kepsErrors.maxlength="Input must be shorter than "+e.kepsType.maxlength),e.errorMsg="Input must be shorter than "+e.kepsType.maxlength):e.kepsType.minlength&&e.data.value.length<e.kepsType.minlength?(e.kepsErrors&&(e.kepsErrors.minlength="Input must be longer than "+e.kepsType.minlength),e.errorMsg="Input must be longer than "+e.kepsType.minlength):void 0},t=function(e){return e.errorMsg=!1,void 0===e.data.value?(e.errorMsg="Invalid value","number"==typeof e.kepsType.max&&(e.errorMsg+=", value must be less than or equal to "+e.kepsType.max),"number"==typeof e.kepsType.min&&(e.errorMsg+=", value must be greater than or equal to "+e.kepsType.min),e.errorMsg):"number"==typeof e.kepsType.max&&e.data.value>e.kepsType.max?(e.kepsErrors&&(e.kepsErrors.max="Number must be smaller than "+e.kepsType.max),e.errorMsg="Number must be smaller than "+e.kepsType.max):"number"==typeof e.kepsType.min&&e.data.value<e.kepsType.min?(e.kepsErrors&&(e.kepsErrors.min="Number must be bigger than "+e.kepsType.min),e.errorMsg="Number must be bigger than "+e.kepsType.min):void 0},s=function(e,t){return e.kepsType.hasOwnProperty("filetype")&&t.type!==e.kepsType.filetype?(e.kepsErrors&&(e.kepsErrors.filetype=" Incorrect filetype:"+t.type+" , must be of type "+e.kepsType.filetype),e.errorMsg=" Incorrect filetype:"+t.type+" , must be of type "+e.kepsType.filetype,e.$apply(),!1):e.kepsType.hasOwnProperty("maxsize")&&t.size>e.kepsType.maxsize?(e.kepsErrors&&(e.kepsErrors.maxsize="File size too large, max size "+e.kepsType.maxsize),e.errorMsg="File size too large, max size "+e.kepsType.maxsize,e.$apply(),!1):!0},a=function(e){return e.errorMsg=!1,e.kepsType.hasOwnProperty("minlat")&&e.data.value.lat<e.kepsType.minlat?(e.kepsErrors&&(e.kepsErrors.minlat="Latitude must be greater than ",e.kepsType.minlat),e.errorMsg="Latitude must be greater than "+e.kepsType.minlat):e.kepsType.hasOwnProperty("maxlat")&&e.data.value.lat>e.kepsType.maxlat?(e.kepsErrors&&(e.kepsErrors.maxlat="Latitude must be less than ",e.kepsType.maxlat),e.errorMsg="Latitude must be less than "+e.kepsType.maxlat):e.kepsType.hasOwnProperty("minlng")&&e.data.value.lng<e.kepsType.minlng?(e.kepsErrors&&(e.kepsErrors.minlng="Longitude must be greater than ",e.kepsType.minlng),e.errorMsg="Longitude must be greater than "+e.kepsType.minlng):e.kepsType.hasOwnProperty("maxlng")&&e.data.value.lng>e.kepsType.maxlng?(e.kepsErrors&&(e.kepsErrors.maxlng="Latitude must be less than ",e.kepsType.maxlng),e.errorMsg="Longitude must be less than "+e.kepsType.maxlng):void 0},r=function(e){e.errorMsg="";var t=/@/;return t.test(e.data.value)?void 0:(e.kepsErrors&&(e.kepsErrors.emailInvalid="Invalid email format"),e.errorMsg="Invalid email format")},n=function(e){if(e.errorMsg="",e.kepsType.maxpicked||e.kepsType.minpicked){var t=e.data.value.length>0?e.data.value.split(",").length:0;if(t>e.kepsType.maxpicked)return e.kepsErrors&&(e.kepsErrors.maxpicked="Too many selected maximum selections allowed "+e.kepsType.maxpicked),e.errorMsg="Too many selected maximum selections allowed "+e.kepsType.maxpicked;if(t<e.kepsType.minpicked)return e.kepsErrors&&(e.kepsErrors.maxpicked="Too few selected minimum selections allowed "+e.kepsType.minpicked),e.errorMsg="Too few selected minimum selections allowed "+e.kepsType.minpicked}};return{stringValidation:e,numberValidation:t,fileValidation:s,geopointValidation:a,emailValidation:r,multiValidation:n}}]);for(var kepsAsyncDependencies=["/lib/intl-tel-input/lib/libphonenumber/build/utils.js","/lib/intl-tel-input/build/js/intlTelInput.min.js"],findScripts=document.scripts,ngKepsLocation,i=0;i<findScripts.length;i++)findScripts[i].src.indexOf("ngkeps")>-1&&(ngKepsLocation=findScripts[i].src.slice(0,findScripts[i].src.indexOf("ngkeps")+6));var addKepsDependency=function(e){var t=document.createElement("script");t.setAttribute("src",e),document.body.appendChild(t)};document.addEventListener("DOMContentLoaded",function(e){for(var t=0;t<kepsAsyncDependencies.length;t++)addKepsDependency(ngKepsLocation+kepsAsyncDependencies[t])});