angular.module("ngKeps",["textAngular"]).filter("keys",function(){return function(e){return e?Object.keys(e):[]}}),angular.module("ngKeps").run(["$templateCache",function(e){e.put("../templates/form.html",'<section>\n		<div ng-repeat="key in kepsData | keys" ng-init="field = kepsData[key]">\n			<input-item\n				keps-name="key"\n				keps-type="field"\n				keps-model="data.value[key]"\n				keps-label="{{ field.label }}"\n				keps-framework="{{kepsFramework}}"\n				keps-errors="kepsErrors[key]"/>\n		</div>\n	</form>\n</section>'),e.put("../templates/bootstrapv3/address.html",'<div class="row">		\n	<div class="col-xs-12">\n		<span ng-show="kepsType.required && !data.subrequired" style="color:red;">*</span>\n		<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	</div>\n</div>\n<div class="row">\n	<div class="col-xs-4">\n		<div class="form-group {{kepsGroupClass}}">\n			<div class="form-group">\n				<span ng-show="data.subrequired && kepsType.required.address1" style="color:red;">*</span>\n				<label class="{{kepsSubLabelClass}}">Address Line 1</label>\n				<input class="form-control {{kepsInputClass}}"type="text" ng-model="data.value.address1" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.address1">\n			</div>\n			<div class="form-group">\n				<span ng-show="data.subrequired && kepsType.required.address2" style="color:red;">*</span>\n				<label class="{{kepsSubLabelClass}}">Address Line 2</label>\n				<input class="form-control {{kepsInputClass}}"type="text" ng-model="data.value.address2" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.address2">\n			</div>	\n			<div class="form-group">\n				<span ng-show="data.subrequired && kepsType.required.city" style="color:red;">*</span>\n				<label class="{{kepsSubLabelClass}}">City</label>\n				<input class="form-control {{kepsInputClass}}"type="text" ng-model="data.value.city" ng-keydown="checkAddress()" ng-required="data.subrequired && kepsType.required.city">\n			</div>\n		</div>\n	</div>\n	<div class="col-xs-4">\n		<div class="form-group {{kepsGroupClass}}">\n			<div class="form-group">\n				<span ng-show="data.subrequired && kepsType.required.region" style="color:red;">*</span>\n				<label class="{{kepsSubLabelClass}}">State/Province/Region</label>\n				<input class="form-control {{kepsInputClass}}"type="text" ng-model="data.value.region" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.region">\n			</div>	\n			<div class="form-group">\n				<span ng-show="data.subrequired && kepsType.required.postal" style="color:red;">*</span>\n				<label class="{{kepsSubLabelClass}}">Zip/Postal Code</label>\n				<input class="form-control {{kepsInputClass}}"type="text" ng-model="data.value.postal" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.postal">\n			</div>\n			<div class="form-group">\n				<span ng-show="data.subrequired && kepsType.required.country" style="color:red;">*</span>\n				<label class="{{kepsSubLabelClass}}">Country</label>\n				<input class="form-control {{kepsInputClass}}"type="text" ng-model="data.value.country" ng-readonly="kepsReadonly" ng-required="data.subrequired && kepsType.required.country">\n			</div>			\n		</div>\n	</div>\n	<div class="col-xs-4">\n		<p>Preview</p>\n		<br>\n		{{data.value.address1 + \' \' + data.value.address2}}\n		<br>\n		{{data.value.city + \', \' + data.value.region + \' \' + data.value.postal}}\n		<br>\n		{{data.value.country}}\n	</div>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>\n'),e.put("../templates/bootstrapv3/array.html",'<div class="row">\n	<div class="col-xs-12">\n		<div class="form-group {{kepsGroupClass}}">\n			<div class="{{kepsArrayClass}}">\n				<span ng-show="kepsType.required" style="color:red;">*</span>\n				<label class="{{kepsLabelClass}}">{{kepsType.label }}:</label>\n				<div class="list-group">\n					<div class="list-group-item" ng-show="data.value.length > 0">\n						<div ng-repeat="item in data.value">\n							<div style="width:5%;margin-left:5%;display:inline-block;">\n								<span>{{($index+1) + \'.\'}}</span>\n							</div>\n							<div style="width:79%;display:inline-block;">\n								<input-item ng-repeat ="(key,val) in kepsType.subSchema"\n								keps-name="key"\n								keps-label="\'\'"\n								keps-group-class="form-horizontal"\n								keps-type="val"\n								keps-model="item[key]"\n								keps-framework="kepsFramework"/>\n							</div>\n							<div style="width: 3%;display: inline-block;margin-right: 7%;line-height: 0px;">\n								<a href="" style="float:right;" ng-click="removeArrayItem($index)">\n									<span style="color:red;margin-left:15px;" class="glyphicon glyphicon-remove"></span>\n								</a>\n							</div>\n						</div>\n					</div>	\n					<div class="list-group-item">\n						<a href="" style="" title="add item">\n							<span style="color:green;" class="glyphicon glyphicon-plus-sign" ng-click="addArrayItem()"></span> \n					</div>\n				</div>\n				<span class="help-block"  ng-if="kepsType.instructions">\n					{{kepsType.instructions}}\n				</span>\n				<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n					{{errorMsg}}\n				</span>\n			</div>\n		</div>\n	</div>\n</div>\n'),e.put("../templates/bootstrapv3/arraymulti.html",'<div class="row">\n	<div class="col-xs-12">\n		<p> </p>\n		<div class="form-group {{kepsGroupClass}}">\n			<div class="{{kepsArrayClass}}">\n			<span ng-show="kepsType.required" style="color:red;">*</span>\n			<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n				<div class="">\n					<div class="list-group">\n						<div class="list-group-item" ng-repeat="item in data.value track by $index">\n							{{$index + 1}}\n							<a href="" style="float:right" ng-click="removeArrayItem($index)">\n								<span style="color:red;margin-left:15px;" class="glyphicon glyphicon-remove"></span>\n							</a>\n							<a href="" style="float:right;" ng-click="showArrayItem[$index] = !showArrayItem[$index]">\n								<span ng-show="showArrayItem[$index]" style="color:blue" class="glyphicon glyphicon-eye-close"></span>\n								<span ng-show="!showArrayItem[$index]" style="color:blue" class="glyphicon glyphicon-eye-open"></span>\n							</a>\n\n								<div ng-show="showArrayItem[$index]">\n									<input-item\n									ng-repeat="(name,field) in kepsType.subSchema"\n									keps-name="name"\n									keps-label="{{name}}"\n									keps-label-class="kepsSubLabelClass"\n									keps-type="field"\n									keps-model="item[name]"\n									keps-framework="kepsFramework"\n									keps-errors="data.error[$index]"/>\n								</div>\n						</div>	\n						<div class="list-group-item">\n							<a href="" style="" title="add item">\n								<span style="color:green;" class="glyphicon glyphicon-plus-sign" ng-click="addArrayItem()"></span> \n						</div>\n				</div>\n			</div>\n			<span class="help-block"  ng-if="kepsType.instructions">\n				{{kepsType.instructions}}\n			</span>\n			<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n				{{errorMsg}}\n			</span>\n		</div>\n	</div>\n</div>\n'),e.put("../templates/bootstrapv3/arrayobject.html","<ul class='list-group'>\n  <li class='list-group-item' ng-repeat='obj in data.value track by $index'>\n    <a href='' style='color:inherit;' ng-click='data.showArray[$index] = !data.showArray[$index]'>\n      {{$index}} {{data.showArray[$index] ? 'Hide Contents' : 'Show Contents'}}\n    </a>\n    <a href='' ng-click='removeArrayItem($index)' class='badge'>\n      <span class='glyphicon glyphicon-remove'></span>\n    </a>\n    <a href='' ng-click='addArrayItem()' class='badge'>\n      <span class='glyphicon glyphicon-plus'></span>\n    </a>\n    <div ng-show='data.showArray[$index]'>\n      <form>\n        <keps-form keps-name=\"kepsName+'.'\" keps-data=\"kepsType[0]\" keps-model=\"data.value[$index]\">\n        </keps-form>\n      </form>\n    </div>\n  </li>\n</ul>\n"),e.put("../templates/bootstrapv3/boolean.html",'<div class="form-group {{kepsGroupClass}}">\n	<span ng-show="kepsType.required" style="color:red;">*</span>	\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<div class="radio">\n		<label><input \n				type="radio" \n				ng-model="data.value" \n				ng-value="{{true}}"\n				ng-required="kepsType.required"\n				ng-readonly="kepsReadonly">\n			{{kepsType.choices.split(\',\')[0] || \'true\'}}\n		</label> \n	</div>\n	<div class="radio">\n		<label><input type="radio" ng-model="data.value" ng-value="{{false}}">\n			{{kepsType.choices.split(\',\')[1] || \'false\'}}\n		</label>\n	</div>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>'),e.put("../templates/bootstrapv3/date.html",'<span ng-show="kepsType.required" style="color:red;">*</span>\n<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n<div class="form-group {{kepsGroupClass}}">\n  <div class="form-group" style="width:200px;">\n    <input type="date" ng-required="kepsType.required" class="form-control"  ng-model="data.date" ng-blur="makeTime()" placeholder="yyyy-MM-dd" ng-readonly="kepsReadonly"></input>\n  </div>\n  <span class="help-block"  ng-if="kepsType.instructions">\n    {{kepsType.instructions}}\n  </span>\n  <span style="color:red;margin-left:20px;" ng-show="errorMsg">\n    {{errorMsg}}\n  </span>\n</div>\n'),e.put("../templates/bootstrapv3/datetime.html",'<span ng-show="kepsType.required" style="color:red;">*</span>\n<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n<div class="form-group {{kepsGroupClass}}">\n	<div class="form-group" style="width:200px;">\n		<input type="date" ng-required="kepsType.required" class="form-control"  ng-model="data.date" ng-blur="makeTime()" placeholder="yyyy-MM-dd" ng-readonly="kepsReadonly"></input>\n	</div>\n	<div class="form-group"  style="width:200px;">\n		<input type="time" ng-required="kepsType.required" class="form-control"  ng-model="data.time" ng-blur="makeTime()" ng-readonly="kepsReadonly"></input>\n	</div>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>\n'),e.put("../templates/bootstrapv3/email.html",'<div class="form-group {{kepsGroupClass}}">\n	<span ng-show="kepsType.required" style="color:red;">*</span>\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<input type="email" \n			ng-model="data.value"\n			class="form-control {{kepsInputClass}}" \n			ng-required="kepsType.required" \n			placeholder="{{kepsType.placeholder}}"\n			ng-keyup="errorChecking()"\n			ng-readonly="kepsReadonly"/>\n\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>\n'),e.put("../templates/bootstrapv3/enum.html",'<div class="form-group {{kepsGroupClass}}">\n	<div class="row">\n		<div class="col-xs-12">\n			<span ng-show="kepsType.required" style="color:red;">*</span>\n			<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n			<select ng-readonly="kepsReadonly" class="form-control {{kepsInputClass}}" ng-model="data.value">\n				<option ng-repeat="option in kepsType.options track by $index" value="{{kepsType.options[$index]}}">{{kepsType.labels[$index] || kepsType.options[$index] }}</option>\n			</select>\n			<span class="help-block"  ng-if="kepsType.instructions">\n				{{kepsType.instructions}}\n			</span>\n			<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n				{{errorMsg}}\n			</span>\n		</div>\n	</div>\n</div>\n'),e.put("../templates/bootstrapv3/file.html",'\n<div class="form-group">\n	<div class="row">\n		<div class="col-xs-12">\n			<span ng-show="kepsType.required" style="color:red;">*</span>\n			<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n			<div class="form-group {{kepsGroupClass}}">\n			  <div class="input-group">\n			    <span class="input-group-btn">\n			      <span class="btn btn-default {{kepsButtonClass}}" style="min-width: 0;padding-left:20px;padding-right:20px;display:inline-block;">\n			        Load File  \n			        \n			        <input ng-if="kepsAcceptFileTypes" type="file" \n			        accept="{{kepsAcceptFileTypes}}" style="position:absolute;opacity:0;top: 0;right: 0;\n		    		min-width: 100%;min-height: 100%;" onchange="angular.element(this).scope().fileChanged(event)">\n		    		\n		    		<input ng-if="!kepsAcceptFileTypes" type="file"\n		    		 style="position:absolute;opacity:0;top: 0;right: 0;" onchange="angular.element(this).scope().fileChanged(event)">\n			      </span>\n			    </span>\n			    <input type="text" class="form-control" ng-readonly="kepsReadonly"  value="{{uploadStatus}}">\n\n			  </div>\n			</div>\n			<span class="help-block"  ng-if="kepsType.instructions">\n				{{kepsType.instructions}}\n			</span>\n			<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n				{{errorMsg}}\n			</span>\n		</div>\n	</div>\n</div>'),e.put("../templates/bootstrapv3/geopoint.html",'<div class="row">\n	<div class="col-xs-5">\n		<span ng-show="kepsType.required" style="color:red;">*</span>	\n		<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n		<div class="form-group {{kepsGroupClass}}">\n			<div class="form-group">\n			  <label class="control-label">Lat:</label>\n			   <input ng-readonly="kepsReadonly" type="number" class="form-control" step="any" ng-model="data.lat" ng-keyup="testLatLng();errorChecking();">\n			</div>\n			<div class="form-group">\n			  <label class="control-label">Lng:</label>\n			  <input ng-readonly="kepsReadonly" type="number" class="form-control" step="any"  ng-model="data.lng" ng-keyup="testLatLng();errorChecking();">\n			</div>\n		</div>\n		<span class="help-block"  ng-if="kepsType.instructions">\n			{{kepsType.instructions}}\n		</span>\n		<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n			{{errorMsg}}\n		</span>\n	</div>\n	<div class="col-xs-7">\n		<p>Preview:</p>\n		<div id="map" style="width:100%;height:200px;margin-top:-5px;"></div>\n	</div>\n</div>'),e.put("../templates/bootstrapv3/html.html",'<div class="form-group {{kepsGroupClass}}">\n	<span ng-show="kepsType.required" style="color:red;">*</span>	\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<text-angular ng-model="data.value" ng-required="kepsType.required" ta-default-wrap="div" ta-disabled="kepsReadonly"></text-angular>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>'),e.put("../templates/bootstrapv3/image.html",'<div class="form-group">\n	<div class="row">\n		<div class="col-xs-6">\n			<span ng-show="kepsType.required" style="color:red;">*</span>\n			<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n\n			<div class="form-group {{kepsGroupClass}}" ng-init="importImageComputer = true;" ng-show="importImageComputer">\n			  <div class="input-group">\n			    <span class="input-group-btn">\n			      <span class="btn btn-default {{kepsButtonClass}}" style="min-width: 0;padding-left:20px;padding-right:20px;display:inline-block;">\n			        Load Image <input type="file" ng-required ="kepsType.required" style="position:absolute;opacity:0;top: 0;right: 0;\n		    		min-width: 100%;min-height: 100%;" onchange="angular.element(this).scope().imageFileChanged(event)" accept="image/*">\n			      </span>\n			    </span>\n			    <input type="text" class="form-control" readonly="" value="{{imageStatus}}">\n			  </div>\n			  <a href="" ng-click="importImageComputer = false;importImageInternet = true;">Or... Upload an image from a url.</a>\n			</div>	\n\n			<div class="form-group {{kepsGroupClass}}" ng-show="importImageInternet">\n			  <div class="input-group">\n			    <span class="input-group-btn">\n			      <span class="btn btn-default {{kepsButtonClass}}" style="min-width: 0;padding-left:20px;padding-right:20px;display:inline-block;">\n			        Import from url <a href="" ng-click="getImageUrl()" style="position:absolute;opacity:0;top: 0;right: 0;\n		    		min-width: 100%;min-height: 100%;" onchange="angular.element(this).scope().imageFileChanged(event)"></a>\n			      </span>\n			    </span>\n			    <input type="text" class="form-control" ng-required="kepsType.required" placeholder="{{kepsType.placeholder || \'Enter Image url\'}}" ng-model="kepsType.imageUrl">\n			  </div>\n			  <a href="" ng-click="importImageComputer = true;importImageInternet = false;">Or... Upload a file from your computer</a>\n			</div>\n			<span class="help-block"  ng-if="kepsType.instructions">\n				{{kepsType.instructions}}\n			</span>\n			<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n				{{errorMsg}}\n			</span>\n		</div>\n		<div class="col-xs-6">\n			<canvas id="{{kepsType.randomCanvasId}}"></canvas>\n			<span ng-show="imageData.height && imageData.width">{{imageData.width + \' X \' + imageData.height}}</span>\n		</div>\n	</div>\n</div>'),e.put("../templates/bootstrapv3/multienum.html",'<div class="form-group {{kepsGroupClass}}">\n  <span ng-show="kepsType.required" style="color:red;">*</span>\n  <label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n  <div class="checkbox" ng-repeat="opt in kepsType.options">\n    <label><input \n        type="checkbox" \n        ng-click="checkMulti(opt);errorChecking();"\n        ng-checked="data.value.indexOf(opt) > -1"\n        ng-readonly="kepsReadonly">\n      {{opt}}\n    </label> \n  </div>\n  <span class="help-block"  ng-if="kepsType.instructions">\n    {{kepsType.instructions}}\n  </span>\n  <span style="color:red;margin-left:20px;" ng-show="errorMsg">\n    {{errorMsg}}\n  </span>\n</div>\n'),e.put("../templates/bootstrapv3/number.html",'<div class="form-group {{kepsGroupClass}}">\n	<span ng-show="kepsType.required" style="color:red;">*</span>	\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<input 	type="number" \n			ng-model="data.value" \n			class="form-control {{kepsInputClass}}" \n			ng-required="kepsType.required" \n			placeholder="{{kepsType.placeholder}}"\n			ng-keyup="errorChecking()"\n			ng-readonly="kepsReadonly"/>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>'),e.put("../templates/bootstrapv3/object.html",'<span ng-show="kepsType.required" style="color:red;">*</span>\n<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n<div class="row">\n	<div class="col-xs-10 col-xs-offset-1">\n		<input-item\n		ng-repeat="(name,field) in kepsType.subSchema"\n		keps-name="name"\n		keps-label="{{name}}"\n		keps-type="field"\n		keps-model="data.value[name]"\n		keps-framework="kepsFramework"\n		keps-errors="data.error[name]"/>\n	</div>\n</div>\n'),e.put("../templates/bootstrapv3/phone.html",'<style> .iti-flag {background-image: url("/lib/intl-tel-input/build/img/flags.png");} </style>\n<div class="row">\n	<div class="col-xs-12">\n		<span ng-show="kepsType.required" style="color:red;">*</span>\n		<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n		<div class="form-group {{kepsGroupClass}}">\n			<input type="tel" id="mobile-number" class="form-control {{kepsInputClass}}" ng-model="data.value">\n			<span class="help-block"  ng-if="kepsType.instructions">\n				{{kepsType.instructions}}\n			</span>\n			<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n				{{errorMsg}}\n			</span>\n		</div>\n	</div>\n</div>\n\n<script>$("#mobile-number").intlTelInput();</script>'),e.put("../templates/bootstrapv3/referenceObject.html",'<div class="form-group {{kepsGroupClass}}">\n	<span ng-show="kepsType.required" style="color:red;">*</span>\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<input ng-readonly="kepsReadonly" type="text" list="{{kepsType.label || kepsName}}" class="form-control {{kepsInputClass}}" ng-model="data.reference"\n	ng-blur="setReferenceData()"></input>\n    <datalist id="{{kepsType.label || kepsName}}">\n    	{{referenceOptions}}\n    	<option ng-repeat="option in referenceOptions" value="{{option[data.displayReferenceAs]}}" \n    	>{{option[data.displayReferenceAs]}}</option>\n    </datalist>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>'),e.put("../templates/bootstrapv3/richtext.html",'<div class="row">\n	<div class="col-xs-12">\n		<div class="form-group {{kepsGroupClass}}">\n			<span ng-show="kepsType.required" style="color:red;">*</span>\n			<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n			<text-angular ng-model="data.value" ng-required="kepsType.required" ta-toolbar="richToolbar" ta-disabled="kepsReadonly"></text-angular>\n			<span class="help-block"  ng-if="kepsType.instructions">\n				{{kepsType.instructions}}\n			</span>\n			<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n				{{errorMsg}}\n			</span>\n		</div>\n	</div>\n</div>'),e.put("../templates/bootstrapv3/string.html",'<div class="form-group {{kepsGroupClass}}">\n	<span ng-show="kepsType.required" style="color:red;">*</span>\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<input 	type="text" \n			ng-model="data.value" \n			class="form-control {{kepsInputClass}}" \n			ng-required="kepsType.required" \n			placeholder="{{kepsType.display.placeholder}}"\n			ng-keyup="errorChecking()"\n			ng-readonly="kepsReadonly"/>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>\n'),e.put("../templates/bootstrapv3/url.html",'<div class="form-group {{kepsGroupClass}}">			\n	<span ng-show="kepsType.required" style="color:red;">*</span>\n	<label class="{{kepsLabelClass}}">{{kepsType.label}}</label>\n	<input 	type="url"\n			ng-model="data.value" \n			class="form-control {{kepsInputClass}}" \n			ng-required="kepsType.required" \n			placeholder="{{kepsType.display.placeholder}}"\n			ng-readonly="kepsReadonly"/>\n	<span class="help-block"  ng-if="kepsType.instructions">\n		{{kepsType.instructions}}\n	</span>\n	<span style="color:red;margin-left:20px;" ng-show="errorMsg">\n		{{errorMsg}}\n	</span>\n</div>\n'),e.put("../templates/materialize/input.html",'<section>\n	<div class="modal-row">\n		<label ng-if="kepsType.display.label">{{kepsType.display.label}}:</label>\n		<label ng-if="!kepsType.display.label">{{kepsName}}:</label>\n		<span ng-show="typeError" style="color:red">Did not find a useable input type, defaulting to string</span>\n		<!-- Start listing input types -->\n		<div ng-if="kepsType.type">\n			<div ng-if="kepsType.type.indexOf(\':\') > -1">\n			    <input type="text" list="{{kepsType.type + \'options\'}}" class="form-control" ng-model="data.value" ng-blur="setReferenceData()"></input>\n			    <datalist id="{{kepsType.type + \'options\'}}">\n			    	<option ng-repeat="option in data.options" value="{{option.value}}" \n			    	></option>\n			    </datalist>\n			</div>\n			<div ng-if="kepsType.type === \'string\'">\n				<input type="text" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></input>\n			</div>\n			<div ng-if="kepsType.type === \'number\'">\n				<input type="number" ng-required="kepsType.required" ng-model="data.value" class="form-control"></input>\n			</div>\n			<div ng-if="kepsType.type === \'boolean\'">\n				<div class="radio-inline">\n				  <label><input type="radio" ng-required="kepsType.required" ng-model="data.value" ng-value="true">True</label>\n				</div>\n				<div class="radio-inline">\n				  <label><input type="radio" ng-required="kepsType.required" ng-model="data.value" ng-value="false">False</label>\n				</div>		\n			</div>\n			<div ng-if="kepsType.type === \'file\'">\n				<div class="row">\n					<div class="form-group col-xs-6">\n						<label>Import file from computer</label>\n						<input type="file" ng-required="kepsType.required" style="margin:15px;" onchange="angular.element(this).scope().fileChanged(event)"></input>\n					</div>\n					<div class="col-xs-6">\n						<ul style="list-style:none;">\n							<li><strong>File Info</strong></li>\n							<li>FileName: {{kepsModel.fileName}}</li>\n							<li>Size: {{kepsModel.fileSize}}</li>\n						</ul>\n					</div>\n				</div>\n			</div>\n			<div ng-if="kepsType.type === \'html\'">\n				<text-angular ng-model="data.value" ng-required="kepsType.required" placeholder="{{kepsType.display.placeholder}}" ta-default-wrap="div"></text-angular>\n				{{data.value}}\n			</div>\n			<div ng-if="kepsType.type === \'datetime\'">\n				<div class="row">\n					<div class="form-group col-xs-6">\n						<input type="date" ng-required="kepsType.required" class="form-control"  ng-model="data.date" ng-blur="makeTime()" placeholder="yyyy-MM-dd"></input>\n					</div>\n					<div class="form-group col-xs-6">\n						<input type="time" ng-required="kepsType.required" class="form-control"  ng-model="data.time" ng-blur="makeTime()"></input>\n					</div>\n				</div>\n			</div>\n			<div ng-if="kepsType.type === \'image\'">\n				<div class="row">\n					<div class="form-group col-xs-5">\n						<div ng-show="!import">\n							<label>Import image from computer:</label>\n							<div class="btn">\n							<input type="file" ng-required="kepsType.required" style="margin:15px;" onchange="angular.element(this).scope().imageFileChanged(event)" accept="image/*"></input>\n							</div>\n							<a href="" ng-click="import = true;image.file = \'\'">Or... Upload an image from a url.</a>\n						</div>\n						<div ng-show="import">\n							<label>Import image from url:</label>\n							<input type="text" ng-required="kepsType.required" class="form-control" ng-model="data.imageUrl" placeholder="Enter image url"></input>\n							<button style="margin-top:5px;" class="btn btn-success" ng-click="getImageUrl()">Grab Image</button><br>\n							<a href="" ng-click="import = false;">Or... Upload a file from your computer</a>\n						</div>\n					</div>\n					<div class="col-xs-7" >\n						<canvas id="{{kepsType.randomCanvasId}}"></canvas>\n						<span ng-show="imageData.height && imageData.width">{{imageData.width + \' X \' + imageData.height}}</span>\n\n					</div>\n				</div>\n			</div>\n			<div ng-if="kepsType.type === \'url\'">\n				<input type="url" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></input>\n			</div>\n			<div ng-if="kepsType.type === \'geopoint\'">\n				<div class="col-sm-8">\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">Lat:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control">\n					  </div>\n					</div>\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">Lng:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control">\n					  </div>\n					</div>\n				</div>\n				<div class="col-sm-4">\n					Preview\n				</div>\n			</div>\n			<div ng-if="kepsType.type === \'email\'">\n				<input type="email" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></input>\n			</div>\n			<div ng-if="kepsType.type === \'enum\'">\n				<select class="form-control" ng-model="data.value" ng-options="opt for opt in kepsType.options">\n				</select>\n			</div>\n			<div ng-if="kepsType.type === \'multi\'">\n				<select class="form-control" multiple ng-multiple="true" ng-model="data.value" ng-options="opt for opt in kepsType.options">\n				</select>\n			</div>\n			<div ng-if="kepsType.type === \'address\'">\n				<!--http://ipinfo.io/-->\n				<div class="col-sm-8">\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">Address Line1:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control" placeholder="Email">\n					  </div>\n					  <span class="help-block">Street address, P.O. box, company name, c/o</span>\n					</div>\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">Address Line2:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control" placeholder="Email">\n					  </div>\n					  <span class="help-block">Apartment, suite, unit, building, floor, etc.</span>\n					</div>\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">City:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control" placeholder="Email">\n					  </div>\n					</div>\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">State / Province / Region / County:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control" placeholder="Email">\n					  </div>\n					</div>\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">ZIP / Postal Code / Postcode:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control" placeholder="Email">\n					  </div>\n					</div>\n					<div class="form-group">\n					  <label class="col-sm-4 control-label">Country:</label>\n					  <div class="col-sm-8">\n					    <input type="text" class="form-control" placeholder="Email">\n					  </div>\n					</div>\n				</div>\n				<div class="col-sm-4">\n					Preview\n					Zoom 17 for address\n					Zoom 9 for city\n					Zoom 5 for state / small country\n					Zoom 4 for country\n					<img class="map" src="https://maps.googleapis.com/maps/api/staticmap?center=37.7367,-122.4572&amp;zoom=17&amp;size=200x200&amp;sensor=false" alt="San Francisco, California, United States Map" title="San Francisco, California, United States Map">\n				</div>\n			</div>\n			<div ng-if="kepsType.type === \'phone\'">\n				<!---http://jackocnr.com/intl-tel-input.html -->\n				<input type="tel" ng-required="kepsType.required" ng-model="data.value" class="form-control" placeholder="{{kepsType.display.placeholder}}"></input>\n			</div>\n			<span class="help-block" ng-if="kepsType.display.instructions">{{kepsType.display.instructions}}</span>\n		</div>\n	</div>\n</section>\n')}]),angular.module("ngKeps").config(["$provide",function(e){e.decorator("taOptions",["taRegisterTool","taToolFunctions","taTranslations","$delegate","$window","$nkModalService",function(e,t,n,a,o,r){document.styleSheets[0].insertRule("#toolbarWC{font-size:10px;}",1),e("keps-pre",{display:'<button class="btn btn-default" style="font-size:1em;">pre</button>',tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("keps-youtube",{iconclass:"fa fa-youtube-play",action:function(){var e=this,t=document.activeElement,n=function(n){var a=document.getElementById("_youtube-input").value;if(a&&""!==a&&"https://"!==a){var o=a.match(/(\?|&)v=[^&]*/);if(o&&o.length>0){var r="https://www.youtube.com/embed/"+o[0].substring(3),i='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+o[0].substring(3)+'/hqdefault.jpg" ta-insert-video="'+r+'"contenteditable="false" allowfullscreen="true" frameborder="0"/>';return t.focus(),void e.$editor().wrapSelection("insertHTML",i,!0)}}};r.show({content:"<div style='padding:10px;'><label>Youtube Video URL:</label><input type='text' id='_youtube-input'></input></div>",source:"div",close:n,buttons:[{label:"Close","class":"btn btn-default btn-theme"},{label:"submit",
"class":"btn btn-success btn-theme"}]})},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:t.imgOnSelectAction}}),e("keps-image",{iconclass:"fa fa-picture-o",action:function(){var e=this,t=document.activeElement,n=(angular.element(document.activeElement),function(){var n=document.getElementById("_image-input").files[0],a=new FileReader;a.onloadend=function(){'<img class="ta-insert-image" src="'+a.result+'"></img>';t.focus(),e.$editor().wrapSelection("insertImage",a.result,!0)},n&&a.readAsDataURL(n)});r.show({content:"<div style='padding:10px;'><label>Upload Image:</label><input type='file' id='_image-input'></input></div>",source:"div",close:n,buttons:[{label:"Close","class":"btn btn-default btn-theme"},{label:"submit","class":"btn btn-success btn-theme"}]})},onElementSelect:{element:"img",action:t.imgOnSelectAction}}),e("keps-link",{iconclass:"fa fa-link",action:function(){var e=this,t=(document.activeElement,function(){var t=document.getElementById("_link-input").value;return e.$editor().wrapSelection("createLink",t,!0)});r.show({content:"<div style='padding:10px;'><label>Add Link:</label><input type='text' id='_link-input'></input></div>",source:"div",close:t,buttons:[{label:"Close","class":"btn btn-default btn-theme"},{label:"submit","class":"btn btn-success btn-theme"}]})},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:t.aOnSelectAction}});var i={},s=function(e){return this.$editor().wrapSelection("formatBlock",e)};i.h1=function(){return s.call(this,"<h1>")},i.h2=function(){return s.call(this,"<h2>")},i.h3=function(){return s.call(this,"<h3>")},i.h4=function(){return s.call(this,"<h4>")},i.h5=function(){return s.call(this,"<h5>")},i.h6=function(){return s.call(this,"<h6>")},i.p=function(){return s.call(this,"<p>")};var l="";l+='<div class="btn-group" style="padding:0px;border:0px;"><button class="btn btn-default dropdown-toggle" data-toggle="dropdown" ng-mouseup="focusHack()"ng-disabled="isDisabled()"  style="font-size:11px;">',l+='Font Size<span class="caret"></span>',l+="</button>",l+='<ul class="dropdown-menu" style="position:absolute;background:white;">',l+='<li><a ng-click="h1()">36pt</a></li>',l+='<li><a ng-click="h2()">30pt</a></li>',l+='<li><a ng-click="h3()">24pt</a></li>',l+='<li><a ng-click="h4()">18pt</a></li>',l+='<li><a ng-click="h5()">14pt</a></li>',l+='<li><a hg-click="p()">13pt</a></li>',l+='<li><a ng-click="h6()">12pt</a></li>',l+="</ul></div>",l+="",e("keps-fontsize",{display:l,disabled:function(e){this.focusHack=function(){$(".ta-scroll-window [contenteditable]")[0].focus()};var t=this;Object.keys(i).forEach(function(e){t[e]=i[e]}),this.isDisabled=function(){return e}},action:function(){}});var c={},d=function(e){return this.$editor().wrapSelection(e,null)};c.center=function(){return d.call(this,"justifyCenter")},c.left=function(){return d.call(this,"justifyLeft")},c.right=function(){return d.call(this,"justifyRight")},c.indent=function(){return d.call(this,"indent")},c.outdent=function(){return d.call(this,"outdent")};var u='<div class="btn-group" style="padding:0px;border:0px;"><button class="btn btn-default dropdown-toggle" data-toggle="dropdown" ng-mouseup="focusHack()" ng-disabled="isDisabled()" style="font-size:11px;">';return u+='Text Alignment<span class="caret"></span>',u+="</button>",u+='<ul class="dropdown-menu" style="position:absolute;background:white;">',u+='<li><a ng-click="left()">Align Left</a></li>',u+='<li><a ng-click="center()">Align Center</a></li>',u+='<li><a ng-click="right()">Align Right</a></li>',u+='<li><a ng-click="indent()">Indent</a></li>',u+='<li><a ng-click="outdent()">Outdent</a></li>',u+="</ul></div>",e("keps-alignment",{display:u,disabled:function(e){this.focusHack=function(){$(".ta-scroll-window [contenteditable]")[0].focus()};var t=this;Object.keys(c).forEach(function(e){t[e]=c[e]}),this.isDisabled=function(){return e}},action:function(){}}),a.toolbar=[["keps-pre"],["keps-fontsize"],["quote","bold","italics","underline","strikeThrough"],["keps-alignment"],["ul","ol","redo","undo","clear"],["html","keps-youtube","keps-link","keps-image"]],a}])}]),angular.module("ngKeps").directive("kepsForm",["$nkDataService",function(e){return{restrict:"E",templateUrl:"../templates/form.html",scope:{kepsData:"=",kepsModel:"=",kepsName:"=",kepsErrors:"=",kepsFramework:"@"},link:function(e,t,n){e.data={},console.log("KTYPE",e.kepsData),console.log("KMOD",e.kepsModel),e.kepsErrors={},e.kepsModel&&(e.data.value=e.kepsModel),e.$watch("data.value",function(t){"undefined"!=typeof t&&(e.kepsModel=t)}),e.$watch("kepsModel",function(t){"undefined"!=typeof t&&e.data.value!==t&&(e.data.value=t)})}}}]),angular.module("ngKeps").directive("inputItem",["$nkDataService","$http","$compile","$parse","$templateCache","$window","$timeout",function(e,t,n,a,o,r,i){return{restrict:"E",scope:{kepsType:"&",kepsModel:"=",kepsName:"&",kepsGroupClass:"@",kepsInputClass:"@",kepsLabelClass:"@",kepsSubLabelClass:"@",kepsButtonClass:"@",kepsLabel:"@",kepsInstructions:"@",kepsErrors:"=",kepsHideErrors:"&",kepsFramework:"@",kepsReadonly:"@"},link:function(e,a,i){e.hasOwnProperty("kepsErrors")&&(e.kepsErrors={}),"function"==typeof e.kepsType&&(e.kepsType=e.kepsType()),"string"==typeof e.kepsType&&(e.kepsType={type:e.kepsType}),"function"==typeof e.kepsName&&(e.kepsName=e.kepsName()),"''"===e.kepsLabel?e.kepsType.label="":"undefined"!=typeof e.kepsLabel&&e.kepsLabel.length>0?e.kepsType.label=e.kepsLabel:e.kepsType?e.kepsType.label&&""!==e.kepsType.label||(e.kepsType.label=e.kepsName):e.kepsType?e.kepsType.label=e.kepsName:(e.kepsType={},e.kepsType.label=e.kepsName),""===e.kepsInstructions?e.kepsType.instructions="":"undefined"!=typeof e.kepsInstructions?e.kepsType.instructions=e.kepsInstructions:e.kepsType.hasOwnProperty("instructions")||(e.kepsType.instructions=""),e.data={},e.data.id=Math.random(),"object"==typeof e.kepsType.required&&(e.data.subrequired=!0),e.kepsModel&&(e.kepsType.type&&"image"===e.kepsType.type?e.data.value=e.kepsModel:e.kepsType.type&&"file"===e.kepsType.type?e.data.value=e.kepsModel:e.kepsType.type&&"datetime"===e.kepsType.type?(e.data.date=new Date(e.kepsModel),e.data.time=new Date(e.kepsModel)):e.kepsType.type&&"date"===e.kepsType.type?e.data.date=new Date(e.kepsModel):e.data.value=e.kepsModel),e.$watch("data.value",function(t){"undefined"!=typeof t?e.kepsModel=t:"undefined"!=typeof e.kepsType["default"]&&(e.kepsModel=e.kepsType["default"])}),e.$watch("kepsModel",function(t){"undefined"!=typeof t&&e.data.value!==t&&(e.data.value=t)}),"function"==typeof e.kepsFramework&&(e.kepsFramework=e.kepsFramework());var s=e.kepsFramework?e.kepsFramework:"bootstrapv3";"string"!=typeof s&&(s="bootstrapv3"),"materialize"!==s&&"bootstrapv3"!==s&&(s="bootstrapv3");var l=function(r){":"===r.slice(0,1)?t.get("../templates/"+s+"/referenceObject.html",{cache:o}).success(function(t){a.replaceWith(n(t)(e))}):t.get("../templates/"+s+"/"+r+".html",{cache:o}).success(function(t){a.replaceWith(n(t)(e))})};if("undefined"!=typeof e.kepsType.type){e.kepsType.type=e.kepsType.type.toLowerCase(),"undefined"!=typeof e.kepsType["default"]&&"undefined"==typeof e.data.value&&(e.data.value=e.kepsType["default"]);var c=["html","url","geopoint","email","datetime","date","richtext","phone","image","file","string","number","boolean","enum","multienum","address","array","arraymulti","object"];if(":"===e.kepsType.type.slice(0,1))l(e.kepsType.type);else if(-1===c.indexOf(e.kepsType.type))e.typeError=!0,e.kepsType.type="string";else{if("array"===e.kepsType.type){var d=0;for(var u in e.kepsType.subSchema)d++;d>1?e.kepsType.type="arraymulti":e.kepsType.type="array"}l(e.kepsType.type)}}else e.kepsType.type="string",l(e.kepsType.type);if("undefined"!=typeof e.kepsType.type&&e.kepsType.type.indexOf(":")>-1){var p=e.kepsType.type.slice(1);t.get("/admin/models").then(function(t){for(var n in t.data)if(n===p)return t.data[n].properties&&t.data[n].properties.displayAs?(e.data.displayReferenceAs=t.data[n].properties.displayAs,f(p,e.data.displayReferenceAs)):t.data[n].schema.name?(e.data.displayReferenceAs="name",f(p,e.data.displayReferenceAs)):t.data[n].schema.title?(e.data.displayReferenceAs="title",f(p,e.data.displayReferenceAs)):t.data[n].schema.displayName?(e.data.displayReferenceAs="displayName",f(p,e.data.displayReferenceAs)):(e.data.displayReferenceAs="_id",f(p,e.data.displayReferenceAs))});var f=function(n,a){t.get("/admin/rest/"+n+"s?returns["+a+"]=1").then(function(t){if(e.referenceOptions=t.data,e.kepsModel){e.data.value=e.kepsModel;for(var n=0;n<e.referenceOptions.length;n++)e.kepsModel===e.referenceOptions[n]._id&&(e.data.reference=e.referenceOptions[a])}})};e.setReferenceData=function(){for(var t=0;t<e.referenceOptions.length;t++)e.referenceOptions[t][e.data.displayReferenceAs]===e.data.reference&&(e.data.value=e.referenceOptions[t]._id)}}e.kepsModel&&("datetime"===e.kepsType.type?(e.data.date=new Date(e.kepsModel),e.data.time=new Date(e.kepsModel)):"date"===e.kepsType.type?(e.data.value=e.kepsModel,e.data.date=new Date(e.kepsModel)):e.data.value=e.kepsModel),e.makeTime=function(){e.data.time&&e.data.date?e.kepsModel=new Date(e.data.date.toString().slice(0,15)+e.data.time.toString().slice(15)).getTime():e.kepsModel=new Date(e.data.date).getTime()};var g,h;if("array"===e.kepsType.type)for(e.data.value=e.kepsModel||[],e.showArrayItem=[],h=e.data.value.length,g=0;h>g;g++)e.showArrayItem.push(!1);else if("arraymulti"===e.kepsType.type)for(e.data.value=e.kepsModel||[],e.showArrayItem=[],h=e.data.value.length,g=0;h>g;g++)e.showArrayItem.push(!1);if(e.addArrayItem=function(){var t={};for(var n in e.kepsType.subSchema)e.kepsType.subSchema[n]["default"]&&(t[n]=e.kepsType.subSchema[n]["default"]);e.showArrayItem[e.data.value.length]=!0,e.data.value.push(JSON.parse(JSON.stringify(t)))},e.removeArrayItem=function(t){e.data.value.splice(t,1)},"image"===e.kepsType.type&&(e.kepsType.randomCanvasId=Math.ceil(9999*Math.random()),"object"==typeof e.kepsModel&&"undefined"!==e.kepsModel.absoluteFilePath)){var m=new Image;m.src=e.kepsModel.filePath,m.onload=function(){e.drawToCanvas(m)}}if(e.imageFileChanged=function(t){if(w(t.target.files[0])){var n,a=new FormData;t.target.files[0].name.includes(".jpg")?n="image/jpg":t.target.files[0].name.includes(".png")?n="image/png":alert("image filetype not recognized");var o=new Image;o.src=URL.createObjectURL(t.target.files[0]),o.onload=function(){e.drawToCanvas(o),e.imageStatus="Uploading...",a.append("file",t.target.files[0]),a.append("data",t.target.files[0]);var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&e.$apply(function(){e.kepsModel=JSON.parse(n.responseText),e.imageStatus="Filename: "+e.kepsModel.fileName+", File size: "+e.kepsModel.fileSize})},n.open("POST","/admin/upload/image",!0),n.send(a)}}},e.getImageUrl=function(){if(e.kepsType.imageUrl&&e.kepsType.imageUrl.match(/(\S+\.[^/\s]+(\/\S+|\/|))/g)){var t=(document.getElementById(e.kepsType.randomCanvasId),new Image);t.src=e.kepsType.imageUrl,t.onload=function(){e.imageStatus="Uploading...";var n=new FormData;n.append("url",e.kepsType.imageUrl);var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&e.$apply(function(){e.kepsModel=JSON.parse(a.responseText),e.imageStatus="Filename: "+e.kepsModel.fileName+", File size: "+e.kepsModel.fileSize})},a.open("POST","/admin/upload/image",!0),a.send(n),e.drawToCanvas(t)}}},e.drawToCanvas=function(t,n){var a,o=document.createAttribute("width"),r=document.createAttribute("height"),i=document.getElementById(e.kepsType.randomCanvasId);t.width>t.height?(o.value=t.width>300?300:t.width,r.value=t.width>300?t.height/t.width*300:t.height):t.height>t.width&&(r.value=t.height>300?300:t.height,o.value=t.height>300?t.width/t.height*300:t.width),i.setAttributeNode(o),i.setAttributeNode(r),a=i.getContext("2d"),a.drawImage(t,0,0,o.value,r.value),a.fillStyle="black",a.font="bold 16px serif",a.fillText(t.height+" X "+t.width,.05*o.value,r.value-5)},"file"===e.kepsType.type&&(e.fileChanged=function(t){e.uploadStatus="Checking...";var n=w(t.target.files[0]);if(n){e.uploadStatus="Uploading...";var a=new FormData;a.append("file",t.target.files[0]);var o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(e.kepsModel=JSON.parse(o.responseText),e.uploadStatus="Filename: "+e.kepsModel.fileName+", File size: "+e.kepsModel.fileSize,e.$apply())},o.open("POST","/admin/upload/file",!0),o.send(a)}},e.kepsType.fileTypes&&Array.isArray(e.kepsType.fileTypes))){e.kepsAcceptFileTypes=e.kepsType.fileTypes[0];for(var g=1;g<e.kepsType.fileTypes.length;g++)e.kepsAcceptFileTypes+=","+e.kepsType.fileTypes[g]}var v,y,b=!0;"geopoint"===e.kepsType.type&&(e.kepsModel&&(e.data.value=e.kepsModel,e.data.lat=e.kepsModel[0],e.data.lng=e.kepsModel[1]),e.testLatLng=function(){if(e.data.lat<=85&&e.data.lat>=-85&&e.data.lng<=180&&e.data.lng>=-180)if(e.data.lat&&e.data.lng&&b)if(r.initMap=function(){var t=new google.maps.LatLng(e.data.lat,e.data.lng);v=new google.maps.Map(document.getElementById("map"),{center:t,zoom:6}),y=new google.maps.Marker({position:t,map:v}),b=!1},"undefined"==typeof google){var t=document.createElement("script");t.src=window.location.protocol+"//maps.googleapis.com/maps/api/js?callback=initMap",document.body.appendChild(t)}else initMap();else if(e.data.lat&&e.data.lng){var n=new google.maps.LatLng(e.data.lat,e.data.lng);y.setMap(null),y=new google.maps.Marker({position:n,map:v}),v.setCenter(y.getPosition()),e.data.value=[e.data.lat,e.data.lng]}}),"multienum"===e.kepsType.type&&(e.data.value=e.kepsModel||[],e.checkMulti=function(t){var n=e.data.value.indexOf(t);-1===n?e.data.value.push(t):e.data.value.splice(n,1)}),"richtext"===e.kepsType.type&&(e.richToolbar=[["keps-fontsize","bold","italics","underline","strikeThrough","keps-alignment","wordcount"]]),e.errorChecking=function(){switch(e.kepsErrors={},e.kepsType.type){case"string":return k();case"number":return T();case"image":return w();case"richText":return richTextValidation();case"geopoint":return x();case"multienum":return S();case"email":return C()}};var k=function(){if(e.errorMsg=!1,e.kepsType.match){var t;if("string"!=typeof e.kepsType.match)return;if(t=new RegExp(e.kepsType.match),console.log(t.test(e.data.value)),!t.test(e.data.value))return e.kepsErrors&&(e.kepsErrors.pattern="Input does not match pattern"),e.errorMsg="Input does not match pattern"}return e.kepsType.maxlength&&e.data.value.length>e.kepsType.maxlength?(e.kepsErrors&&(e.kepsErrors.maxlength="Input must be shorter than "+e.kepsType.maxlength),e.errorMsg="Input must be shorter than "+e.kepsType.maxlength):e.kepsType.minlength&&e.data.value.length<e.kepsType.minlength?(e.kepsErrors&&(e.kepsErrors.minlength="Input must be longer than "+e.kepsType.minlength),e.errorMsg="Input must be longer than "+e.kepsType.minlength):void 0},T=function(){return e.errorMsg=!1,e.kepsType.max&&e.data.value>e.kepsType.max?(e.kepsErrors&&(e.kepsErrors.max="Number must be smaller than "+e.kepsType.max),e.errorMsg="Number must be smaller than "+e.kepsType.max):e.kepsType.min&&e.data.value<e.kepsType.min?(e.kepsErrors&&(e.kepsErrors.min="Number must be bigger than "+e.kepsType.min),e.errorMsg="Number must be bigger than "+e.kepsType.min):void 0},w=function(t){return e.kepsType.hasOwnProperty("filetype")&&t.type!==e.kepsType.filetype?(e.kepsErrors&&(e.kepsErrors.filetype=" Incorrect filetype:"+t.type+" , must be of type "+e.kepsType.filetype),e.errorMsg=" Incorrect filetype:"+t.type+" , must be of type "+e.kepsType.filetype,e.$apply(),!1):e.kepsType.hasOwnProperty("maxsize")&&t.size>e.kepsType.maxsize?(e.kepsErrors&&(e.kepsErrors.maxsize="File size too large, max size "+e.kepsType.maxsize),e.errorMsg="File size too large, max size "+e.kepsType.maxsize,e.$apply(),!1):!0},x=function(){return e.errorMsg=!1,e.kepsType.hasOwnProperty("minlat")&&e.data.value.lat<e.kepsType.minlat?(e.kepsErrors&&(e.kepsErrors.minlat="Latitude must be greater than ",e.kepsType.minlat),e.errorMsg="Latitude must be greater than "+e.kepsType.minlat):e.kepsType.hasOwnProperty("maxlat")&&e.data.value.lat>e.kepsType.maxlat?(e.kepsErrors&&(e.kepsErrors.maxlat="Latitude must be less than ",e.kepsType.maxlat),e.errorMsg="Latitude must be less than "+e.kepsType.maxlat):e.kepsType.hasOwnProperty("minlng")&&e.data.value.lng<e.kepsType.minlng?(e.kepsErrors&&(e.kepsErrors.minlng="Longitude must be greater than ",e.kepsType.minlng),e.errorMsg="Longitude must be greater than "+e.kepsType.minlng):e.kepsType.hasOwnProperty("maxlng")&&e.data.value.lng>e.kepsType.maxlng?(e.kepsErrors&&(e.kepsErrors.maxlng="Latitude must be less than ",e.kepsType.maxlng),e.errorMsg="Longitude must be less than "+e.kepsType.maxlng):void 0},C=function(){e.errorMsg="";var t=/@/;return t.test(e.data.value)?void 0:(e.kepsErrors&&(e.kepsErrors.emailInvalid="Invalid email format"),e.errorMsg="Invalid email format")},S=function(){if(e.errorMsg="",e.kepsType.maxpicked||e.kepsType.minpicked){var t=e.data.value.length>0?e.data.value.split(",").length:0;if(t>e.kepsType.maxpicked)return e.kepsErrors&&(e.kepsErrors.maxpicked="Too many selected maximum selections allowed "+e.kepsType.maxpicked),e.errorMsg="Too many selected maximum selections allowed "+e.kepsType.maxpicked;if(t<e.kepsType.minpicked)return e.kepsErrors&&(e.kepsErrors.maxpicked="Too few selected minimum selections allowed "+e.kepsType.minpicked),e.errorMsg="Too few selected minimum selections allowed "+e.kepsType.minpicked}}}}}]),angular.module("ngKeps").service("$nkAnalyticsService",["$timeout","$nkDataService",function(e,t){var n={},a={};return a.queue=[],a.interval=1e4,n.event=function(e,t){var n={action:"track",event:name,properties:data,timestamp:(new Date).toISOString()};userId?n.userId=userId:n.sessionId=sessionId,queue.push(n)},n.identify=function(e,t){var n={action:"identify",traits:data,timestamp:(new Date).toISOString()};e&&""!==e?(userId=e,n.userId=userId):n.userId="anonymousId",queue.push(n)},n.setInterval=function(e){a.interval=e},a.flush=function(){if(queue.length>0){var e={batch:queue},t=JSON.parse(JSON.stringify(e));queue=[],$http.post("/segment_io/import",t).then(function(){},function(){})}a.flushTimeout()},a.flushTimeout=function(){e(function(){a.flush()},a.interval)},a.flushTimeout(),n}]),function(){var e=null,t={},n="/api/v1/";angular.module("ngKeps").provider("$nkAuthService",[function(){this.setLogoutHref=function(t){e=t},this.$get=["$http","$location","$window","$q","$nkDataService",function(a,o,r,i,s){var l={},c=!1,d=o.host();return n=s.apiPrefix,l.showModal=function(){$nkModalService.show({content:'<div ng-app="ngkeps"><authorizationModal></authorizationModal></div>'})},l.start=function(s){t=s,window.$http=a;var l=i.defer();try{c=JSON.parse(r.localStorage[d+"-user"])}catch(u){}return c&&(a.get(n+"users/me").then(function(e){c=e.data,c||(r.localStorage.setItem(d+"-user",JSON.stringify(c)),l.resolve(c),s.user=c)},function(t){c?(delete r.localStorage[d+"-user"],e&&(o.href=e)):l.reject(c)}),s.user=c,l.resolve(c)),l.promise},l.getUser=function(){return c},l.loginWithProvider=function(e,n){var a=i.defer();return s.loginWithProvider(e,n).then(function(e){e===!1?a.reject():(e.expiration=Date.now(),r.localStorage.setItem(d+"-user",JSON.stringify(e)),c=e,t.user=c,a.resolve(e))},function(e){a.reject(e)}),a.promise},l.signupWithProvider=function(e,n){var a=i.defer();return s.signupWithProvider(e,n).then(function(e){e===!1?a.reject():(e.expiration=Date.now(),r.localStorage.setItem(d+"-user",JSON.stringify(e)),c=e,t.user=c,a.resolve(e))},function(e){a.reject(e)}),a.promise},l.logout=function(){delete r.localStorage[d+"-user"],c=!1},l.getPaymentToken=function(){var e=i.defer();return s.get("customers/token").then(function(t){e.resolve(t.data)},function(t){e.reject(t)}),e.promise},l.checkout=function(){var e=i.defer();return s.post("customers/checkoutWithPaymentMethod").then(function(t){e.resolve(t.data)},function(t){e.reject(t)}),e.promise},l.checkPaymentMethod=function(){var e=i.defer();return s.get("customers/checkPaymentMethod").then(function(t){e.resolve(t.data)},function(t){e.reject(t)}),e.promise},l.firstTimeCheckout=function(e){var t=i.defer();return s.post("customers/firstTimeCheckout",{payment_method_nonce:e}).then(function(e){t.resolve(e.data)},function(e){t.rejeoct(e)}),t.promise},l}]}]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","$window",function(a,o,r){var i=o.host();return{request:function(e){e.headers=e.headers||{};try{user=JSON.parse(r.localStorage[i+"-user"]),user.token&&(e.headers.Authorization="Bearer "+user.token)}catch(t){}return e},response:function(e){return console.log(e.config.url),(0===e.config.url.indexOf(n)||0===e.config.url.indexOf("/api/v1/"))&&(console.log(e.headers("x-user-token-refresh")),e.headers("x-user-token-refresh")&&(r.localStorage.setItem(i+"-user",e.headers("x-user-token-refresh")),t.user=JSON.parse(e.headers("x-user-token-refresh")))),e},responseError:function(t){return(401===t.status||403===t.status)&&(delete r.localStorage[i+"-user"],e&&(o.href=e)),a.reject(t)}}}])}]).run(["$nkAuthService","$rootScope",function(e,t){e.start(t)}])}(),angular.module("ngKeps").service("$nkCacheService",[function(){var e,t={},n={},a={get:function(e){return JSON.parse(localStorage.getItem(e))},set:function(e,t){localStorage.setItem(e,JSON.stringify(t))},check:function(e){return"undefined"!=typeof localStorage.getItem(e)&&null!==localStorage.getItem(e)}},o=0,r=0;return t.storage=a,n.init=function(){if(a.check("objects")){var e=a.get("objects");variable.constructor===Array&&t.loadCache(e)}},t.clearCache=function(){localStorage.clear(),loc=location.href,loc=loc.substr(0,loc.indexOf("#")),location.href=loc},t.loadCacheObj=function(t,n){if(a.check(t+"-"+n))try{var o=a.get(t+"-"+n);e[t].objects[n]=o,r++}catch(i){console.log("Error on parse",i),console.log(t+"-"+n,a.get(t+"-"+n))}else console.log("Object",t+"-"+n," in index but not cache")},t.loadCacheType=function(n){if(e[n]={objects:{},schema:{},objectCallbacks:[],index:[],collection:[]},a.check(n+"-count")||a.set(n+"-count",0),a.check(n+"-index"))try{e[n].index=a.get(n+"-index"),o++;for(var r=0;r<e[n].index.length;r++)t.loadCacheObj(n,e[n].index[r])}catch(i){console.log("Error on index parse",i),console.log(n+"-index",a.get(n+"-index"))}},t.loadCache=function(e){for(var n=0;n<e.length;n++)t.loadCacheType(e[n]);console.log("finished loading cache",o,"indexes loaded",r,"objects loaded",JSON.stringify(localStorage).length/25e5+"% of cache used")},t.inCache=function(t,n){return n in e[t].objects?!0:!1},t.addObj=function(t,a,o,r){return object._pending=r,object._id in e[objectType].objects?e[objectType].objects[object._id]=angular.extend(e[objectType].objects[object._id],object):e[objectType].objects[object._id]=object,n.runObjectCallbacks(objectType,e[objectType].objects[object._id]),"objects-"+objectType+"-"+object._id in localStorage||(localStorage.objectsCount=parseInt(localStorage.objectsCount)+1,localStorage[objectType+"Count"]=parseInt(localStorage[objectType+"Count"])+1),localStorage["objects-"+objectType+"-"+object._id]=JSON.stringify(e[objectType].objects[object._id]),-1===e[objectType].index.indexOf(object._id)&&(e[objectType].index.push(object._id),localStorage["objects-"+objectType+"-index"]=JSON.stringify(e[objectType].index)),serverdt!==!1&&(localStorage["objects-"+objectType+"-dt"]=serverdt),e[objectType].objects[object._id]},t.addArray=function(n,a,o,r){for(var i=[],s=0;s<array.length;s++)t.addObject(n,a[s],o,r),i.push(e[objectType].objects[array[s]._id]);return i},t.removeObj=function(t,n,a){n in e[t].objects&&delete e[t].objects[n],"objects-"+t+"-"+n in localStorage&&(localStorage.objectsCount=parseInt(localStorage.objectsCount)-1,localStorage[t+"-count"]=parseInt(localStorage[t+"-count"])-1,delete localStorage[t+"-"+n]);var o=e[t].index.indexOf(n);-1!=o&&(e[t].index=e[t].index.splice(o,1),localStorage[t+"-index"]=JSON.stringify(e[t].index)),serverdt!==!1&&(localStorage[t+"-dt"]=a)},t.getObj=function(t,n){return e[t].objects[n]},t.getObjCount=function(t){return t in e?e[t].count:0},t.getObjectIndex=function(t){return t in e?e[t].index:[]},t.getCollection=function(t){return t in e?e[t].collection:[]},t.getSyncObject=function(t,n){var a={};if("undefined"!=typeof n)t in e&&n in e[t].objects&&(a[t]={},a[t][n]=e[t].objects[n]);else if("undefined"!=typeof t&&t in e){a[t]={};for(var o=e[t].collection.length-1;o>=0;o--)a[t][e[t].collection[o]._id]=e[t].collection[o]._v}else for(var r in e){a[r]={};for(var o=e[r].collection.length-1;o>=0;o--)a[r][e[r].collection[o]._id]=e[r].collection[o]._v}return a},t.getTypes=function(){var t=[];for(var n in e)t.push(n);return t},t.addType=function(t,n){type in e},t.loadPostProcessObject=function(t,n){dataServiceReadyDeferred.promise.then(function(){e[t].objectCallbacks.push(n)})},n.runObjectCallbacks=function(t,n){for(var a=$q.defer(),o=[],r=0;r<e[t].objectCallbacks.length;r++)o.push(e[t].objectCallbacks[r](n));return $q.all(o).then(function(){a.resolve()}),a.promise},n.init(),t}]),angular.module("ngKeps").service("$nkDataService",["$nkSocketService","$nkRestService",function(e,t){return e.error?t:e}]),angular.module("ngKeps").service("$nkModalService",["$window","$document",function(e,t){function n(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent("on"+t,function(){n.call(e)})}function a(){o=t[0].createElement("div"),r=t[0].createElement("div"),i=t[0].createElement("div"),s=t[0].createElement("div"),r.id="ngkeps_content_fixed",r.setAttribute("style","position:fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);-webkit-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);opacity:1;z-index:2003;background-color:white; border-radius: 6px;padding: 20px 30px;"),i.id="ngkeps_popbox",s.id="ngkeps_overlay_wrapper",s.setAttribute("style","position:absolute;top:0;bottom:0;left:0;right:0;z-index:2002;"),o.id="ngkeps_overlay",o.setAttribute("style","position:fixed;top:0;bottom:0;left:0;right:0;opacity:0.3;width:100%;height:100%;background-color:black;z-index:2002;"),s.appendChild(o),r.appendChild(i),t[0].body.appendChild(s),t[0].body.appendChild(r),s.style.display="none",o.style.display="none",r.style.display="none",s.addEventListener("click",d),n(e,"keypress",function(e){27==e.keyCode&&d()})}var o,r,i,s,l=null,c=function(e){if(e){var n='<button type="button" class="close" onclick="window._ngkeps_model_hide(\'top_close\')" style="border: 1px solid #fff;border-radius: 15px;width: 32px;height: 32px;right: 0px;position: absolute;outline: none;color: #fff;transition: all 0.6s ease 0s;-webkit-transition: all 0.6s ease 0s;-moz-transition: all 0.6s ease 0s;-o-transition: all 0.6s ease 0s;-ms-transition: all 0.6s ease 0s;-webkit-backface-visibility: hidden;opacity: 0.6;filter: alpha(opacity=60);top: -40px;margin-top: -2px;"><span style="position: relative;top: -2px;">x</span></button>';"string"==typeof e["class"]&&e["class"]&&i.setAttribute("class",e["class"]),e.keepLayout&&!e["class"]&&i.setAttribute("style","position:relative;height:300px;width:300px;background-color:white;opacity:1;"),"string"==typeof e.content&&e.content&&"html"==e.source&&(n+=e.content),"string"==typeof e.content&&e.content&&"div"==e.source&&(n+=t[0].getElementById(e.content)?t[0].getElementById(e.content).innerHTML:e.content);var a="";if(e.buttons)for(var c=0;c<e.buttons.length;c++)"object"==typeof e.buttons[c]?a+="<button onclick=\"window._ngkeps_model_hide('"+e.buttons[c].label+'\')" class="'+e.buttons[c]["class"]+'" style="margin-left: 10px;">'+e.buttons[c].label+"</button>":"string"==typeof e.buttons[c]&&(a+="<button onclick=\"window._ngkeps_model_hide('"+e.buttons[c]+'\')" class="btn" style="margin-left: 10px;">'+e.buttons[c]+"</button>");""!==a&&(n+='<div style="text-align: right;padding-top: 10px;margin-top: 10px;">'+a+"</div>"),i.innerHTML=n}s.style.display="",o.style.display="",r.style.display="",l=e.close},d=e._ngkeps_model_hide=function(e){s.style.display="none",o.style.display="none",r.style.display="none",l&&l(e)};return a(),{show:c,hide:d}}]),angular.module("ngKeps").provider("$nkRestService",function(){var e="/api/v1/";this.setApiPrefix=function(t){e=t},this.$get=["$http","$q","$nkCacheService",function(t,n,a){var o={},r={};o.apiPrefix=e;var i=function(e,t,n){if(!t)return r[e]?r[e]:!1;if("id"===n)return r[t]?r[t]:!1;if("query"===n){var a=e+JSON.stringify(t);return r[a]?r[a]:!1}};return o.post=o.create=function(a,o){var r=n.defer();return t.post(e+a,o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},o.put=o.update=function(a,o){var r=n.defer();return t.put(e+a+"/"+o._id,o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},o["delete"]=function(a,o){var r=n.defer();return t["delete"](e+a+"/"+o._id).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise},o.get=o.read=function(a,o,s){var l=n.defer();if(o){var c=!1;("undefined"===s||s===!0)&&(c=i(a,o,"id")),c?l.resolve(c):t.get(e+a+"/"+o).then(function(e){l.resolve(e),r[o]=e},function(e){l.reject(e)})}else s&&c.hasOwnProperty(a)?l.resolve(c[a]):t.get(e+a).then(function(e){l.resolve(e),r[a]=e},function(e){l.reject(e)});return l.promise},o.query=function(a,o,s){var l=n.defer(),c=!1;if(("undefined"===s||s===!0)&&(c=i(a,o,"query")),c)l.resolve(c);else{var d=e+a;o&&(d+="?query="+JSON.stringify(o)),t.get(d).then(function(e){if(l.resolve(e.data),o){var t=a+JSON.stringify(o);r[t]=e}else r[a]=e},function(e){l.reject(e)})}return l.promise},o.call=function(a,o){var r=n.defer(),i=a.substr(0,a.indexOf(".")).toLowerCase();a=a.substr(a.indexOf(".")+1);var s=a.substr(0,a.indexOf("."));a=a.substr(a.indexOf(".")+1);var l=e+s+"s/"+a;if(s in o){var c;c="object"==typeof o[s]&&_id in o[s]?o[s]._id:o[s],l=e+s+"s/"+c+"/"+a}if("get"===i||"delete"===i){var d=function(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)){var o=t?t+"["+a+"]":a,r=e[a];n.push("object"==typeof r?d(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r))}return n.join("&")};l+="?"+d(o),t[i](l).then(function(e){r.resolve(e.data)},function(e){r.reject(e)})}else"post"===i||"put"===i?t[i](l,o).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}):t.get(l).then(function(e){r.resolve(e.data)},function(e){r.reject(e)});return r.promise},o.sync=function(e,r){var i=n.defer();if("undefined"!=typeof e){var s=a.getSyncObject(e,r);t.post("/"+e+"/sync",s).success(function(e){i.resolve()}).error(function(){i.reject(),console.log("Get - Failed to retrieve data")})}else{for(var l=a.getTypes,c=[],d=l.length-1;d>=0;d--)c.push(o.sync(l[d]));n.all(c).then(function(){i.resolve()})}return i.promise},o.loginWithProvider=function(a,o){var r=n.defer();return"local"===a?t.post(e+"users/signin",o).then(function(e){r.resolve(e.data)},function(e){r.reject(e.data)}):location.href="/auth/"+a,r.promise},o.signupWithProvider=function(a,o){var r=n.defer();return"local"===a?t.post(e+"users/signup",o).then(function(e){r.resolve(e.data)},function(e){r.reject(e.data)}):location.href="/auth/"+a,r.promise},o.loadPostProcessObject=a.loadPostProcessObject,o}]}),angular.module("ngKeps").service("$nkSocketService",["$window","$timeout","$q","$nkCacheService",function(e,t,n,a){if(!e.io)return{error:"socket.io not available"};var o,r,i,s,l,c,d={},u={},p=0,f=1,g=[],h={},m="",v=0,y=2e3,b=!0,k=null,T=null,w=null,x={},C=[],S=0,E=0,R=0,N=0,A=0,O=[];e.socket=o;var $=[],L=!1,M=n.defer(),D=function(){},j=!1;return d.getStatus=function(){var e={};return e.lastRequestSent=l,e.lastRequestReceived=c,e.numberOfOutstandingRequests=S,e.numberOfRequests=E,e.cacheHit=R,e.requestsReceived=O,e.duplicateRequest=A,e},d.clearCache=function(e){e?a.clearCache():a.clearCache()},d.start=function(e,t,a){return T=n.defer(),i=e,m=t,i.connected=!1,i.reconnect=!1,i.cacheLoaded=!1,f=a,M.resolve(),u.setupSocket(),T.promise},d.loginWithProvider=function(e,t){return null===w&&(w=n.defer()),T.promise.then(function(){o.emit("login",{provider:e,data:t,device:i.device})}),w.promise},d.logout=function(){T.promise.then(function(){o.emit("logout.me",{
device:i.device})})},d.add=function(e,t){var a="post."+e+".create",r=n.defer();return"_id"in t||(t._id=uuid.v4().replace(/-/g,"").substring(0,24)),t._pending=!0,u.addObject(e,t,!1,!0),M.promise.then(function(){if(i.connected)if(-1!==g.indexOf(a)){var n=u.getReqKey(a,r);o.emit(a,{objectType:e,object:t,reqKey:n})}else r.reject("No create command on server");else C.push({method:a,restMethod:"post",payload:{objectType:e,object:t},deferred:r})}),r.promise},d.update=function(e,t){var a="put."+e+".update",r=n.defer();return M.promise.then(function(){if(i.connected)if(-1!==g.indexOf(a)){var n=u.getReqKey(a,r),s={objectType:e,object:t,reqKey:n};s[e]=t._id,o.emit(a,s)}else r.reject("No update command on server");else{var l={objectType:e,object:t};l[e]=t._id,C.push({method:a,restMethod:"put",payload:l,deferred:r})}}),r.promise},d["delete"]=function(e,t){var a="delete."+e+".delete",r=n.defer();return M.promise.then(function(){if(i.connected)if(-1!==g.indexOf(a)){var n=u.getReqKey(a,r);o.emit("delete.object",{objectType:e,object:t,reqKey:n})}else r.reject("No delete command on server");else console.log("TODO can not delete objects while offline"),r.reject("TODO can not delete objects while offline")}),r.promise},d.get=function(e,t){var a="get."+e+".read",r=n.defer();return M.promise.then(function(){if(e in objects)if(t in objects[e].objects)R++,r.resolve(objects[e].objects[t]);else if("objects-"+e+"-"+t in localStorage&&!i.connected)N++,r.resolve(JSON.parse(localStorage["objects-"+e+"-"+t])),console.log("Warning: Object requested before cache loaded",e+"-"+t);else{if(x[a+"-"+e+"-"+t])return A++,x[a+"-"+e+"-"+t];if(L)$.push({objectType:e,objectId:t,deferred:r});else{x[a+"-"+e+"-"+t]=r.promise;var n={objectType:e};n[e]=t,i.connected?g.indexOf(a)?(n.reqKey=u.getReqKey(a,r),o.emit(a,n)):r.reject("No read command on server"):C.push({method:a,restMethod:"get",payload:n,deferred:r})}}else r.reject("Not registered for object type "+e)}),r.promise},d.getArray=function(e,t){var a="get."+e+".read",r=n.defer();return M.promise.then(function(){var n={objectType:e};n[e]=t,i.connected?-1!==g.indexOf(a)?(n.reqKey=u.getReqKey(a,r),o.emit(a,n)):r.reject("No read command on server"):C.push({method:a,restMethod:"read",payload:n,deferred:r})}),h[reqKey].promise},d.getQuery=function(e,t){var a="get."+e+".query",r=n.defer();return M.promise.then(function(){if(i.connected)if(-1!==g.indexOf(a)){var n=u.getReqKey(a,r);o.emit(a,{objectType:e,query:t,reqKey:n})}else r.reject("No query command on server");else C.push({method:a,restMethod:"get",payload:{objectType:e,query:t},deferred:r})}),r.promise},d.localQuery=function(e,t){var a=n.defer();return M.promise.then(function(){var t=[];for(var n in objects[e].objects)t.push(objects[e].objects[n]);a.resolve(t)}),a.promise},d.runCommand=function(e,t){var a=n.defer();return M.promise.then(function(){i.connected?-1!==g.indexOf(e)?(t.reqKey=u.getReqKey("callback",a),console.log("*** emit",e,t),o.emit(e,t)):a.reject('No command "'+e+'"on server'):C.push({method:e,restMethod:"callback",payload:t,deferred:a})}),a.promise},d.loadPostProcessObject=a.loadPostProcessObject,d.sync=function(e){var t={};t.objects=a.getSyncObject(),e&&(t.user=e),o.emit("sync",t)},u.findValues=function(e,t,n,a){return _.isArray(a)||(a=[]),_.isString(n)||(n=""),_.forOwn(e,function(o,r){n+r===t?a.push(o):findValues(o,t,_.isArray(e)?n:n+r+".",a)}),a},u.initalConnect=function(){console.log("trying to connect"),o?o.io.connect():e.socket=o=io.connect("http://"+m+"/",{"sync disconnect on unload":!1,reconnect:!1,transports:["websocket","polling"]}),s=t(function(){i.connected||(b=!1,r&&clearInterval(r),u.initalConnect())},15e3)},u.addObjects=function(e,t){var a,o,r=n.defer(),i=[];$=[],L=!0;for(a in e)for(o=0;o<e[a].length;o++)i.push(u.addObject(a,e[a][o],t,!1));return $.length>0&&u.runNestedLoadingRequests(),n.all(i).then(function(){L=!1,r.resolve()}),r.promise},u.runNestedLoadingRequests=function(){for(var e=0;e<$.length;e++){var t=$[e];t.objectId in objects[t.objectType].objects?t.deferred.resolve(objects[t.objectType].objects[t.objectId]):d.get(t.objectType,t.objectId).then(function(e){t.deferred.resolve(e)})}},u.getReqKey=function(e,t){var n=e+"-"+o.io.engine.id+"-"+v;return h[n]=t,l=n,v++,E++,S++,n},u.processReqKey=function(e,t,n){e in h&&(c=e,h[e].resolve(t),S--,delete h[e],"objects"===n?O.push(e.substr(0,e.indexOf("-"))+" objects"):"callback"===n?O.push(e.substr(0,e.indexOf("-"))+" callback"):"object"==typeof t?"[object Array]"===Object.prototype.toString.call(t)?O.push(e.substr(0,e.indexOf("-"))+" "+n+" array"):"_id"in t?O.push(e.substr(0,e.indexOf("-"))+" "+n+" "+t._id):O.push(e.substr(0,e.indexOf("-"))+" "+n+" unknown"):O.push(e.substr(0,e.indexOf("-"))+" "+n+" unknown"))},u.rejectReqKey=function(e,t){e in h&&(c=e,h[e].reject(payload),S--,delete h[e])},u.flushOfflineRequests=function(){if(C.length>0){var e;for(e=0;e<C.length;e++){var t=C[e];if(t.objectType in objects&&t.objectId in objects[t.objectType].objects&&"get"===t.restMethod)null!==t.deferred&&t.deferred.resolve(objects[t.objectType].objects[t.objectId]);else if(g.indexOf(t.method)){var n=u.getReqKey(t.method,t.deferred);t.payload.reqKey=n,o.emit(t.method,t.payload)}else t.deferred.reject("Command not on server")}}C=[]},u.setupSocket=function(){u.initalConnect(),o.on("error",function(e){console.error("Socket Error",JSON.stringify(e))}),o.on("disconnect",function(e){i.connected=!1,j=!0,b&&(r=setInterval(function(){o.io.connect()},y))}),o.on("reconnect",function(e){}),o.on("reconnecting",function(e){b&&(i.reconnect=!0)}),o.on("connect",function(e){console.log("connected"),r&&clearInterval(r),t.cancel(s),o.emit("client.register",{device:i.device}),i.$safeApply(function(){i.connected=!0,j&&i.user&&d.loadUser(),i.reconnect=!1})}),o.on("client.objects",function(e){if(p=e.backendVersion,p>f)T.reject("backendVersion");else{for(var t in e.objects)a.addType(t,e.objects[t].schema);a.storage.set("commands",e.commands),g=e.commands,T.resolve(),d.sync()}}),o.on("err",function(e){-1!==e.func.indexOf("get.me")&&(k.reject(),j&&(j=!1,D())),e.reqKey&&u.rejectReqKey(e.reqKey,e.message),console.error("Socket Server Error",JSON.stringify(e))}),o.on("get.me",function(e){j=!1,i.user=e.user,objects.user.objects[e.user._id]=e.user,u.addObject("user",e.user,e.dt,!1),e.objects?u.addObjects(e.objects,e.dt).then(function(){u.flushOfflineRequests(),k.resolve()}):(u.flushOfflineRequests(),k.resolve())}),o.on("login.successful",function(e){w.resolve(e),d.sync()}),o.on("login.unsuccessful",function(e){w.resolve(!1)}),o.on("remove",function(e){e.objectType in objects&&(u.removeObject(e.objectType,e.object,e.dt),e.reqKey&&u.processReqKey(e.reqKey,objects[e.objectType].objects[e.object._id],e.objectType))}),o.on("update",function(e){if(e.objectType in objects&&"object"in e)if("[object Array]"===Object.prototype.toString.call(e.object)){var t=u.addArray(e.objectType,e.object);e.reqKey&&u.processReqKey(e.reqKey,t,e.objectType)}else if(u.addObject(e.objectType,e.object,e.dt,!1),e.reqKey){u.processReqKey(e.reqKey,objects[e.objectType].objects[e.object._id],e.objectType);var n=e.reqKey.substring(0,e.reqKey.indexOf("-"));n+"-"+e.objectType+"-"+e.objectId in x&&delete x[n+"-"+e.objectType+"-"+e.objectId]}"objects"in e&&u.addObjects(e.objects,e.dt).then(function(){e.reqKey&&u.processReqKey(e.reqKey,t,"objects")})}),o.on("callback",function(e){e.reqKey&&u.processReqKey(e.reqKey,e.payload,"callback")})},d}]),!function(e,t){t["true"]=e,function(t,n){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&"object"==typeof e?module.exports=t():n.rangy=t()}(function(){function e(e,t){var n=typeof e[t];return n==k||!(n!=b||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=b||!e[t])}function n(e,t){return typeof e[t]!=T}function a(e){return function(t,n){for(var a=n.length;a--;)if(!e(t,n[a]))return!1;return!0}}function o(e){return e&&E(e,S)&&N(e,C)}function r(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function i(t){typeof console!=T&&e(console,"log")&&console.log(t)}function s(e,t){$&&t?alert(e):i(e)}function l(e){M.initialized=!0,M.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,M.config.alertOnFail)}function c(e){s("Rangy warning: "+e,M.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function u(){if($&&!M.initialized){var t,n=!1,a=!1;e(document,"createRange")&&(t=document.createRange(),E(t,x)&&N(t,w)&&(n=!0));var s=r(document);if(!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(a=!0)),!n&&!a)return void l("Neither Range nor TextRange are available");M.initialized=!0,M.features={implementsDomRange:n,implementsTextRange:a};var c,u;for(var p in O)(c=O[p])instanceof h&&c.init(c,M);for(var f=0,g=q.length;g>f;++f)try{q[f](M)}catch(m){u="Rangy init listener threw an exception. Continuing. Detail: "+d(m),i(u)}}}function p(e,t,n){n&&(e+=" in module "+n.name),M.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function f(e,t,n,a){e[t]=function(){return p(t,n,a),e[n].apply(e,L.toArray(arguments))}}function g(e){e=e||window,u();for(var t=0,n=_.length;n>t;++t)_[t](e)}function h(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n){var a=new h(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(M,t),t.supported=!0}catch(a){var o="Module '"+e+"' failed to load: "+d(a);i(o),a.stack&&i(a.stack)}}});return O[e]=a,a}function v(){}function y(){}var b="object",k="function",T="undefined",w=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],x=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],C=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],S=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],E=a(e),R=a(t),N=a(n),A=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,a=e.length;a>n;++n)t(e[n],n)},O={},$=typeof window!=T&&typeof document!=T,L={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:E,areHostObjects:R,areHostProperties:N,isTextRange:o,getBody:r,forEach:A},M={version:"1.3.0",initialized:!1,isBrowser:$,supported:!0,util:L,features:{},modules:O,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==T?!0:rangyAutoInitialize}};M.fail=l,M.warn=c;var D;({}).hasOwnProperty?(L.extend=D=function(e,t,n){var a,o;for(var r in t)t.hasOwnProperty(r)&&(a=e[r],o=t[r],n&&null!==a&&"object"==typeof a&&null!==o&&"object"==typeof o&&D(a,o,!0),e[r]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},L.createOptions=function(e,t){var n={};return D(n,t),e&&D(n,e),n}):l("hasOwnProperty not supported"),$||l("Rangy can only run in a browser"),function(){var e;if($){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(a){}}e||(e=function(e){for(var t=[],n=0,a=e.length;a>n;++n)t[n]=e[n];return t}),L.toArray=e}();var j;$&&(e(document,"addEventListener")?j=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?j=function(e,t,n){e.attachEvent("on"+t,n)}:l("Document does not have required addEventListener or attachEvent method"),L.addListener=j);var q=[];L.deprecationNotice=p,L.createAliasForDeprecatedMethod=f,M.init=u,M.addInitListener=function(e){M.initialized?e(M):q.push(e)};var _=[];M.addShimListener=function(e){_.push(e)},$&&(M.shim=M.createMissingNativeApi=g,f(M,"createMissingNativeApi","shim")),h.prototype={init:function(){for(var e,t,n=this.dependencies||[],a=0,o=n.length;o>a;++a){if(t=n[a],e=O[t],!(e&&e instanceof h))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){M.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){M.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},M.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var a=m(e,n,t);M.initialized&&M.supported&&a.init()},M.createCoreModule=function(e,t,n){m(e,t,n)},M.RangePrototype=v,M.rangePrototype=new v,M.selectionPrototype=new y,M.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==$||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function a(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function r(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function i(e,t){var n,a=[];for(n=e;n;n=n.parentNode)a.push(n);for(n=t;n;n=n.parentNode)if(q(a,n))return n;return null}function s(e,t,n){for(var a=n?t:t.parentNode;a;){if(a===e)return!0;a=a.parentNode}return!1}function l(e,t){return s(e,t,!0)}function c(e,t,n){for(var a,o=n?e:e.parentNode;o;){if(a=o.parentNode,a===t)return o;o=a}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function p(e,t){var n=t.nextSibling,a=t.parentNode;return n?a.insertBefore(e,n):a.appendChild(e),e}function f(e,t,n){var a=e.cloneNode(!1);if(a.deleteData(0,t),e.deleteData(t,e.length-t),p(a,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=a,r.offset-=t):r.node==e.parentNode&&r.offset>o(e)&&++r.offset;return a}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=$)return e.ownerDocument;if(typeof e.document!=$)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function h(e){var n=g(e);if(typeof n.defaultView!=$)return n.defaultView;if(typeof n.parentWindow!=$)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=$)return e.contentDocument;if(typeof e.contentWindow!=$)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=$)return e.contentWindow;if(typeof e.contentDocument!=$)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&L.isHostMethod(e,"setTimeout")&&L.isHostObject(e,"document")}function b(e,t,n){var a;if(e?L.isHostProperty(e,"nodeType")?a=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):y(e)&&(a=e.document):a=document,!a)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return a}function k(e){for(var t;t=e.parentNode;)e=t;return e}function T(e,n,a,r){var s,l,d,u,p;if(e==a)return n===r?0:r>n?-1:1;if(s=c(a,e,!0))return n<=o(s)?-1:1;if(s=c(e,a,!0))return o(s)<r?-1:1;if(l=i(e,a),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(d=e===l?l:c(e,l,!0),u=a===l?l:c(a,l,!0),d===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(p=l.firstChild;p;){if(p===d)return-1;if(p===u)return 1;p=p.nextSibling}}function w(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function x(e){if(!e)return"[No node]";if(_&&w(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function C(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function S(e,t,n){var a=M(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var r=a.firstChild;return r?a.insertBefore(o,r):a.appendChild(o),o}function E(e){return e.parentNode.removeChild(e)}function R(e){this.root=e,this._next=e}function N(e){return new R(e)}function A(e,t){this.node=e,this.offset=t}function O(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var $="undefined",L=e.util,M=L.getBody;L.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),L.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var D=document.createElement("div");L.areHostMethods(D,["insertBefore","appendChild","cloneNode"]||!L.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),L.isHostProperty(D,"innerHTML")||t.fail("Element is missing innerHTML property");var j=document.createTextNode("test");L.areHostMethods(j,["splitText","deleteData","insertData","appendData","cloneNode"]||!L.areHostObjects(D,["previousSibling","nextSibling","childNodes","parentNode"])||!L.areHostProperties(j,["data"]))||t.fail("Incomplete Text Node implementation");var q=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},_=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",_=w(n),e.features.crashyTextNodes=_}();var I;typeof window.getComputedStyle!=$?I=function(e,t){return h(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=$?I=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),R.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},O.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},O.prototype.toString=function(){return this.message},e.dom={arrayContains:q,isHtmlNamespace:n,parentElement:a,getNodeIndex:o,getNodeLength:r,getCommonAncestor:i,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:d,isTextOrCommentNode:u,insertAfter:p,splitDataNode:f,getDocument:g,getWindow:h,getIframeWindow:v,getIframeDocument:m,getBody:M,isWindow:y,getContentDocument:b,getRootContainer:k,comparePoints:T,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:I,createTestElement:S,removeNode:E,fragmentFromNodeChildren:C,createIterator:N,DomPosition:A},e.DOMException=O}),M.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&(H(e,t.startContainer)||H(e,t.endContainer))}function a(e){return e.document||F(e.startContainer)}function o(e){return G(e.startContainer)}function r(e){return new _(e.parentNode,B(e))}function i(e){return new _(e.parentNode,B(e)+1)}function s(e,t,n){var a=11==e.nodeType?e.firstChild:e;return P(t)?n==t.length?j.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:W(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),a}function l(e,t,n){if(S(e),S(t),a(t)!=a(e))throw new I("WRONG_DOCUMENT_ERR");var o=z(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=z(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=o&&r>=0:0>o&&r>0}function c(e){for(var t,n,o,r=a(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(o=e.getSubtreeIterator(),n.appendChild(c(o)),o.detach()),10==n.nodeType)throw new I("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function d(e,t,n){var a,o;n=n||{stop:!1};for(var r,i;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(n.stop=!0);if(i=e.getSubtreeIterator(),d(i,t,n),i.detach(),n.stop)return}else for(a=j.createIterator(r);o=a.next();)if(t(o)===!1)return void(n.stop=!0)}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach()):e.remove()}function p(e){for(var t,n,o=a(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(p(n)),n.detach()):e.remove(),10==t.nodeType)throw new I("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function f(e,t,n){var a,o=!(!t||!t.length),r=!!n;o&&(a=new RegExp("^("+t.join("|")+")$"));var i=[];return d(new h(e,!1),function(t){if(!(o&&!a.test(t.nodeType)||r&&!n(t))){var s=e.startContainer;if(t!=s||!P(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&P(l)&&0==e.endOffset||i.push(t)}}}),i}function g(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+j.inspectNode(e.startContainer)+":"+e.startOffset+", "+j.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&P(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||P(this.sc)?K(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||P(this.ec)?K(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var a,o=n?t:t.parentNode;o;){if(a=o.nodeType,V(e,a))return o;o=o.parentNode}return null}}function v(e,t){if(oe(e,t))throw new I("INVALID_NODE_TYPE_ERR")}function y(e,t){if(!V(t,e.nodeType))throw new I("INVALID_NODE_TYPE_ERR")}function b(e,t){if(0>t||t>(P(e)?e.length:e.childNodes.length))throw new I("INDEX_SIZE_ERR")}function k(e,t){if(ne(e,!0)!==ne(t,!0))throw new I("WRONG_DOCUMENT_ERR")}function T(e){if(ae(e,!0))throw new I("NO_MODIFICATION_ALLOWED_ERR")}function w(e,t){if(!e)throw new I(t)}function x(e,t){return t<=(P(e)?e.length:e.childNodes.length)}function C(e){return!!e.startContainer&&!!e.endContainer&&!(J&&(j.isBrokenNode(e.startContainer)||j.isBrokenNode(e.endContainer)))&&G(e.startContainer)==G(e.endContainer)&&x(e.startContainer,e.startOffset)&&x(e.endContainer,e.endOffset)}function S(e){if(!C(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function E(e,t){S(e);var n=e.startContainer,a=e.startOffset,o=e.endContainer,r=e.endOffset,i=n===o;P(o)&&r>0&&r<o.length&&W(o,r,t),P(n)&&a>0&&a<n.length&&(n=W(n,a,t),i?(r-=a,o=n):o==n.parentNode&&r>=B(n)&&r++,a=0),e.setStartAndEnd(n,a,o,r)}function R(e){S(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function N(e){e.START_TO_START=de,e.START_TO_END=ue,e.END_TO_END=pe,e.END_TO_START=fe,e.NODE_BEFORE=ge,e.NODE_AFTER=he,e.NODE_BEFORE_AND_AFTER=me,e.NODE_INSIDE=ve}function A(e){N(e),N(e.prototype)}function O(e,t){return function(){S(this);var n,a,o=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,l=new h(this,!0);o!==s&&(n=K(o,s,!0),a=i(n),o=a.node,r=a.offset),d(l,T),l.reset();var c=e(l);return l.detach(),t(this,o,r,o,r),c}}function $(t,a){function o(e,t){return function(n){y(n,Q),y(G(n),X);var a=(e?r:i)(n);(t?s:l)(this,a.node,a.offset)}}function s(e,t,n){var o=e.endContainer,r=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((G(t)!=G(o)||1==z(t,n,o,r))&&(o=t,r=n),a(e,t,n,o,r))}function l(e,t,n){var o=e.startContainer,r=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((G(t)!=G(o)||-1==z(t,n,o,r))&&(o=t,r=n),a(e,o,r,t,n))}var c=function(){};c.prototype=e.rangePrototype,t.prototype=new c,q.extend(t.prototype,{setStart:function(e,t){v(e,!0),b(e,t),s(this,e,t)},setEnd:function(e,t){v(e,!0),b(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:o=e[2],r=e[3]}a(this,t,n,o,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){S(this),e?a(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):a(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(e,!0),a(this,e,0,e,U(e))},selectNode:function(e){v(e,!1),y(e,Q);var t=r(e),n=i(e);a(this,t.node,t.offset,n.node,n.offset)},extractContents:O(p,a),deleteContents:O(u,a),canSurroundContents:function(){S(this),T(this.startContainer),T(this.endContainer);var e=new h(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},splitBoundaries:function(){E(this)},splitBoundariesPreservingPositions:function(e){E(this,e)},normalizeBoundaries:function(){S(this);var e,t=this.startContainer,n=this.startOffset,o=this.endContainer,r=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,r=e.length,e.appendData(t.data),Y(t))},s=function(e){var a=e.previousSibling;if(a&&a.nodeType==e.nodeType){t=e;var i=e.length;if(n=a.length,e.insertData(0,a.data),Y(a),t==o)r+=n,o=t;else if(o==e.parentNode){var s=B(e);r==s?(o=e,r=i):r>s&&r--}}},l=!0;if(P(o))r==o.length?i(o):0==r&&(e=o.previousSibling,e&&e.nodeType==o.nodeType&&(r=e.length,t==o&&(l=!1),e.appendData(o.data),Y(o),o=e));else{if(r>0){var c=o.childNodes[r-1];c&&P(c)&&i(c)}l=!this.collapsed}if(l){if(P(t))0==n?s(t):n==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(o==e&&(o=t,r+=t.length),t.appendData(e.data),Y(e)));else if(n<t.childNodes.length){var d=t.childNodes[n];d&&P(d)&&s(d)}}else t=o,n=r;a(this,t,n,o,r)},collapseToPoint:function(e,t){v(e,!0),b(e,t),this.setStartAndEnd(e,t)}}),A(t)}function L(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:j.getCommonAncestor(e.startContainer,e.endContainer)}function M(e,t,n,a,o){e.startContainer=t,e.startOffset=n,e.endContainer=a,e.endOffset=o,e.document=j.getDocument(t),L(e)}function D(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,L(this)}var j=e.dom,q=e.util,_=j.DomPosition,I=e.DOMException,P=j.isCharacterDataNode,B=j.getNodeIndex,H=j.isOrIsAncestorOf,F=j.getDocument,z=j.comparePoints,W=j.splitDataNode,K=j.getClosestAncestorIn,U=j.getNodeLength,V=j.arrayContains,G=j.getRootContainer,J=e.features.crashyTextNodes,Y=j.removeNode;h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,P(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!P(n)||n!==this.sc&&n!==this.ec?n.parentNode&&Y(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new D(a(this.range));var t=this._current,n=t,o=0,r=t,i=U(t);H(t,this.sc)&&(n=this.sc,o=this.so),H(t,this.ec)&&(r=this.ec,i=this.eo),M(e,n,o,r,i)}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Q=[1,3,4,5,7,8,10],X=[2,9,11],Z=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],ne=m([9,11]),ae=m(Z),oe=m([6,10,12]),re=document.createElement("style"),ie=!1;try{re.innerHTML="<b>x</b>",ie=3==re.firstChild.nodeType}catch(se){}e.features.htmlParsingConforms=ie;var le=ie?function(e){var t=this.startContainer,n=F(t);if(!t)throw new I("INVALID_STATE_ERR");var a=null;return 1==t.nodeType?a=t:P(t)&&(a=j.parentElement(t)),a=null===a||"HTML"==a.nodeName&&j.isHtmlNamespace(F(a).documentElement)&&j.isHtmlNamespace(a)?n.createElement("body"):a.cloneNode(!1),a.innerHTML=e,j.fragmentFromNodeChildren(a)}:function(e){var t=a(this),n=t.createElement("body");return n.innerHTML=e,j.fragmentFromNodeChildren(n)},ce=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],de=0,ue=1,pe=2,fe=3,ge=0,he=1,me=2,ve=3;q.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){S(this),k(this.startContainer,t.startContainer);var n,a,o,r,i=e==fe||e==de?"start":"end",s=e==ue||e==de?"start":"end";return n=this[i+"Container"],a=this[i+"Offset"],o=t[s+"Container"],r=t[s+"Offset"],z(n,a,o,r)},insertNode:function(e){if(S(this),y(e,ee),T(this.startContainer),H(e,this.startContainer))throw new I("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){S(this);var e,t;if(this.collapsed)return a(this).createDocumentFragment();if(this.startContainer===this.endContainer&&P(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=a(this).createDocumentFragment(),t.appendChild(e),t;var n=new h(this,!0);return e=c(n),n.detach(),e},canSurroundContents:function(){S(this),T(this.startContainer),T(this.endContainer);var e=new h(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(y(e,te),!this.canSurroundContents())throw new I("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){S(this);for(var e,t=new D(a(this)),n=ce.length;n--;)e=ce[n],t[e]=this[e];return t},toString:function(){S(this);var e=this.startContainer;if(e===this.endContainer&&P(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new h(this,!0);return d(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){S(this);var t=e.parentNode,n=B(e);if(!t)throw new I("NOT_FOUND_ERR");var a=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>a?o>0?me:ge:o>0?he:ve},comparePoint:function(e,t){return S(this),w(e,"HIERARCHY_REQUEST_ERR"),k(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)<0?-1:z(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:le,toHtml:function(){return R(this)},intersectsNode:function(e,t){if(S(this),G(e)!=o(this))return!1;var n=e.parentNode,a=B(e);if(!n)return!0;var r=z(n,a,this.endContainer,this.endOffset),i=z(n,a+1,this.startContainer,this.startOffset);return t?0>=r&&i>=0:0>r&&i>0},isPointInRange:function(e,t){return S(this),w(e,"HIERARCHY_REQUEST_ERR"),k(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)>=0&&z(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return l(this,e,!1)},intersectsOrTouchesRange:function(e){return l(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=z(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=z(this.endContainer,this.endOffset,e.endContainer,e.endOffset),a=this.cloneRange();return-1==t&&a.setStart(e.startContainer,e.startOffset),1==n&&a.setEnd(e.endContainer,e.endOffset),a}return null},union:function(e){
if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==z(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==z(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new I("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ve},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,U(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var a=n.pop();return t.setEnd(a,a.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return S(this),f(this,e,t)},getDocument:function(){return a(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=a(this),o=e.createRange(n);t=t||j.getBody(n),o.selectNodeContents(t);var r=this.intersection(o),i=0,s=0;return r&&(o.setEnd(r.startContainer,r.startOffset),i=o.toString().length,s=i+r.toString().length),{start:i,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var a,o,r,i,s=[t],l=!1,c=!1;!c&&(a=s.pop());)if(3==a.nodeType)o=n+a.length,!l&&e.start>=n&&e.start<=o&&(this.setStart(a,e.start-n),l=!0),l&&e.end>=n&&e.end<=o&&(this.setEnd(a,e.end-n),c=!0),n=o;else for(i=a.childNodes,r=i.length;r--;)s.push(i[r])},getName:function(){return"DomRange"},equals:function(e){return D.rangesEqual(this,e)},isValid:function(){return C(this)},inspect:function(){return g(this)},detach:function(){}}),$(D,M),q.extend(D,{rangeProperties:ce,RangeIterator:h,copyComparisonConstants:A,createPrototypeRange:$,inspect:g,toHtml:R,getRangeDocument:a,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=D}),M.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,a,o=e.dom,r=e.util,i=o.DomPosition,s=e.DomRange,l=o.getBody,c=o.getContentDocument,d=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function a(e){for(var t,n=p.length;n--;)t=p[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function i(e,t,n,a,o){var r=e.startContainer!==t||e.startOffset!=n,i=e.endContainer!==a||e.endOffset!=o,s=!e.equals(e.nativeRange);(r||i||s)&&(e.setEnd(a,o),e.setStart(t,n))}var d,u,p=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,a(this)},s.createPrototypeRange(n,i),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),a(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),a(this)},d.collapse=function(e){this.nativeRange.collapse(e),a(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){a(this)},d.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var g=document.createRange();g.setStart(f,0),g.setEnd(f,0);try{g.setStart(f,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),a(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),a(this)},u=function(e){return function(t){this.nativeRange[e](t),a(this)}}}catch(h){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}a(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}a(this)},u=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}a(this)}}}d.setStartBefore=u("setStartBefore","setEndBefore"),d.setStartAfter=u("setStartAfter","setEndAfter"),d.setEndBefore=u("setEndBefore","setStartBefore"),d.setEndAfter=u("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(f),g.setEnd(f,3);var m=document.createRange();m.selectNodeContents(f),m.setEnd(f,4),m.setStart(f,2),-1==g.compareBoundaryPoints(g.START_TO_END,m)&&1==g.compareBoundaryPoints(g.END_TO_START,m)?d.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:d.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var y=v.firstChild,b=l(document);b.appendChild(v),g.setStart(y,1),g.setEnd(y,2),g.deleteContents(),"13"==y.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),a(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return a(this),e}),b.removeChild(v),b=null,r.isHostMethod(g,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(f),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var a=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),i=a==r?a:o.getCommonAncestor(a,r);return i==t?i:o.getCommonAncestor(t,i)},p=function(e){return 0==e.compareEndPoints("StartToEnd",e)},f=function(e,t,n,a,r){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new i(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var u=o.getDocument(l).createElement("span");u.parentNode&&o.removeNode(u);for(var p,f,g,h,m,v=n?"StartToStart":"StartToEnd",y=r&&r.containerElement==l?r.nodeIndex:0,b=l.childNodes.length,k=b,T=k;T==b?l.appendChild(u):l.insertBefore(u,l.childNodes[T]),s.moveToElementText(u),p=s.compareEndPoints(v,e),0!=p&&y!=k;){if(-1==p){if(k==y+1)break;y=T}else k=k==y+1?y:T;T=Math.floor((y+k)/2),l.removeChild(u)}if(m=u.nextSibling,-1==p&&m&&d(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var w;if(/[\r\n]/.test(m.data)){var x=s.duplicate(),C=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",C);-1==(p=x.compareEndPoints("StartToEnd",x));)w++,x.moveStart("character",1)}else w=s.text.length;h=new i(m,w)}else f=(a||!n)&&u.previousSibling,g=(a||n)&&u.nextSibling,h=g&&d(g)?new i(g,0):f&&d(f)?new i(f,f.data.length):new i(l,o.getNodeIndex(u));return o.removeNode(u),{boundaryPosition:h,nodeInfo:{nodeIndex:T,containerElement:l}}},g=function(e,t){var n,a,r,i,s=e.offset,c=o.getDocument(e.node),u=l(c).createTextRange(),p=d(e.node);return p?(n=e.node,a=n.parentNode):(i=e.node.childNodes,n=s<i.length?i[s]:null,a=e.node),r=c.createElement("span"),r.innerHTML="&#feff;",n?a.insertBefore(r,n):a.appendChild(r),u.moveToElementText(r),u.collapse(!t),a.removeChild(r),p&&u[t?"moveStart":"moveEnd"]("character",s),u};a=function(e){this.textRange=e,this.refresh()},a.prototype=new s(document),a.prototype.refresh=function(){var e,t,n,a=u(this.textRange);p(this.textRange)?t=e=f(this.textRange,a,!0,!0).boundaryPosition:(n=f(this.textRange,a,!0,!1),e=n.boundaryPosition,t=f(this.textRange,a,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},a.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(a);var h=function(e){if(e.collapsed)return g(new i(e.startContainer,e.startOffset),!0);var t=g(new i(e.startContainer,e.startOffset),!0),n=g(new i(e.endContainer,e.endOffset),!1),a=l(s.getRangeDocument(e)).createTextRange();return a.setEndPoint("StartToStart",t),a.setEndPoint("EndToEnd",n),a};if(a.rangeToTextRange=h,a.prototype.toTextRange=function(){return h(this)},e.WrappedTextRange=a,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);"undefined"==typeof m.Range&&(m.Range=a),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=a}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new s(e)},r.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),r.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),M.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function a(e,n){if(e){if(N.isWindow(e))return e;if(e instanceof v)return e.win;var a=N.getContentDocument(e,t,n);return N.getWindow(a)}return window}function o(e){return a(e,"getWinSelection").getSelection()}function r(e){return a(e,"getDocSelection").document.selection}function i(e){var t=!1;return e.anchorNode&&(t=1==N.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var a=n?"end":"start",o=n?"start":"end";e.anchorNode=t[a+"Container"],e.anchorOffset=t[a+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof $?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof L?n=t.nativeRange:j.implementsDomRange&&t instanceof N.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!N.isAncestorOf(e[0],e[t]))return!1;return!0}function p(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function f(e){return!!e&&"undefined"!=typeof e.text}function g(e,t){var n=new L(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function h(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(f(n))g(t,n);else{t.rangeCount=n.length;for(var a,o=_(n.item(0)),r=0;r<t.rangeCount;++r)a=e.createRange(o),a.selectNode(n.item(r)),t._ranges.push(a);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var a=e.docSelection.createRange(),o=p(n),r=_(a.item(0)),i=I(r).createControlRange(),s=0,l=a.length;l>s;++s)i.add(a.item(s));try{i.add(o)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),h(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function b(e,t){for(var n,a,o=te.length;o--;)if(n=te[o],a=n.selection,"deleteAll"==t)y(a);else if(n.win==e)return"delete"==t?(te.splice(o,1),!0):a;return"deleteAll"==t&&(te.length=0),null}function k(e,n){for(var a,o=_(n[0].startContainer),r=I(o).createControlRange(),i=0,s=n.length;s>i;++i){a=p(n[i]);try{r.add(a)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),h(e)}function T(e,t){if(e.win.document!=_(t))throw new M("WRONG_DOCUMENT_ERR")}function w(t){return function(n,a){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,a)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,a)),this.setSingleRange(o,this.isBackward())}}function x(e){var t=[],n=new D(e.anchorNode,e.anchorOffset),a=new D(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,i=e.rangeCount;i>r;++r)t[r]=$.inspect(e.getRangeAt(r));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+a.inspect()+"]"}e.config.checkSelectionRanges=!0;var C,S,E="boolean",R="number",N=e.dom,A=e.util,O=A.isHostMethod,$=e.DomRange,L=e.WrappedRange,M=e.DOMException,D=N.DomPosition,j=e.features,q="Control",_=N.getDocument,I=N.getBody,P=$.rangesEqual,B=O(window,"getSelection"),H=A.isHostObject(document,"selection");j.implementsWinGetSelection=B,j.implementsDocSelection=H;var F=H&&(!B||e.config.preferTextRange);if(F)C=r,e.isSelectionValid=function(e){var t=a(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||_(n.createRange().parentElement())==t};else{if(!B)return t.fail("Neither document.selection or window.getSelection() detected."),!1;C=o,e.isSelectionValid=function(){return!0}}e.getNativeSelection=C;var z=C();if(!z)return t.fail("Native selection was null (possibly issue 138?)"),!1;var W=e.createNativeRange(document),K=I(document),U=A.areHostProperties(z,["anchorNode","focusNode","anchorOffset","focusOffset"]);j.selectionHasAnchorAndFocus=U;var V=O(z,"extend");j.selectionHasExtend=V;var G=typeof z.rangeCount==R;j.selectionHasRangeCount=G;var J=!1,Y=!0,Q=V?function(t,n){var a=$.getRangeDocument(n),o=e.createRange(a);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(o)),t.extend(n.startContainer,n.startOffset)}:null;A.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&typeof z.rangeCount==R&&j.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,a=n>1,o=[],r=i(t),s=0;n>s;++s)o[s]=t.getRangeAt(s);var l=N.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("")),d=document.createRange();if(d.setStart(c,1),d.collapse(!0),t.removeAllRanges(),t.addRange(d),Y=1==t.rangeCount,t.removeAllRanges(),!a){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)J=!1;else{var p=d.cloneRange();d.setStart(c,0),p.setEnd(c,3),p.setStart(c,2),t.addRange(d),t.addRange(p),J=2==t.rangeCount}}for(N.removeNode(l),t.removeAllRanges(),s=0;n>s;++s)0==s&&r?Q?Q(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),j.selectionSupportsMultipleRanges=J,j.collapsedNonEditableSelectionsSupported=Y;var X,Z=!1;K&&O(K,"createControlRange")&&(X=K.createControlRange(),A.areHostProperties(X,["item","add"])&&(Z=!0)),j.implementsControlRange=Z,S=U?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;O(z,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:U&&(ee=function(t){var n=_(t.anchorNode),a=e.createRange(n);return a.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),a.collapsed!==this.isCollapsed&&a.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),a}),v.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof v)return e.refresh(),e;e=a(e,"getNativeSelection");var t=b(e),n=C(e),o=H?r(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new v(n,o,e),te.push({win:e,selection:t})),t};e.getSelection=ne,A.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ae=v.prototype;if(!F&&U&&A.areHostMethods(z,["removeAllRanges","addRange"])){ae.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var oe=function(e,t){Q(e.nativeSelection,t),e.refresh()};G?ae.addRange=function(t,a){if(Z&&H&&this.docSelection.type==q)m(this,t);else if(n(a)&&V)oe(this,t);else{var o;J?o=this.rangeCount:(this.removeAllRanges(),o=0);var r=d(t).cloneRange();try{this.nativeSelection.addRange(r)}catch(i){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var l=ee(this.nativeSelection,this.rangeCount-1);l&&!P(l,t)&&(t=new L(l))}this._ranges[this.rangeCount-1]=t,s(this,t,se(this.nativeSelection)),this.isCollapsed=S(this)}else this.refresh()}}:ae.addRange=function(e,t){n(t)&&V?oe(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},ae.setRanges=function(e){if(Z&&H&&e.length>1)k(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(O(z,"empty")&&O(W,"select")&&Z&&F))return t.fail("No means of selecting a Range or TextRange was found"),!1;ae.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=_(this.anchorNode);else if(this.docSelection.type==q){var t=this.docSelection.createRange();t.length&&(e=_(t.item(0)))}if(e){var n=I(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(a){}c(this)},ae.addRange=function(t){this.docSelection.type==q?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ae.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?k(this,e):t&&this.addRange(e[0])}}ae.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new M("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var re;if(F)re=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=I(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==q?h(t):f(n)?g(t,n):c(t)};else if(O(z,"getRangeAt")&&typeof z.rangeCount==R)re=function(t){if(Z&&H&&t.docSelection.type==q)h(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,a=t.rangeCount;a>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],se(t.nativeSelection)),t.isCollapsed=S(t)}else c(t)};else{if(!U||typeof z.isCollapsed!=E||typeof W.collapsed!=E||!j.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;re=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=S(e)):c(e)}}ae.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,a=this.anchorOffset;if(re(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=a)return!0;for(;o--;)if(!P(t[o],this._ranges[o]))return!0;return!1}};var ie=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var a=0,o=n.length;o>a;++a)P(t,n[a])||e.addRange(n[a]);e.rangeCount||c(e)};Z&&H?ae.removeRange=function(e){if(this.docSelection.type==q){for(var t,n=this.docSelection.createRange(),a=p(e),o=_(n.item(0)),r=I(o).createControlRange(),i=!1,s=0,l=n.length;l>s;++s)t=n.item(s),t!==a||i?r.add(n.item(s)):i=!0;r.select(),h(this)}else ie(this,e)}:ae.removeRange=function(e){ie(this,e)};var se;!F&&U&&j.implementsDomRange?(se=i,ae.isBackward=function(){return se(this)}):se=ae.isBackward=function(){return!1},ae.isBackwards=ae.isBackward,ae.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},ae.collapse=function(t,n){T(this,t);var a=e.createRange(t);a.collapseToPoint(t,n),this.setSingleRange(a),this.isCollapsed=!0},ae.collapseToStart=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ae.collapseToEnd=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ae.selectAllChildren=function(t){T(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ae.deleteFromDocument=function(){if(Z&&H&&this.docSelection.type==q){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),N.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var a=0,o=n.length;o>a;++a)n[a].deleteContents();this.addRange(n[o-1])}}},ae.eachRange=function(e,t){for(var n=0,a=this._ranges.length;a>n;++n)if(e(this.getRangeAt(n)))return t},ae.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ae.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ae.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(a){n.push(a[e].apply(a,t||[]))}),n},ae.setStart=w(!0),ae.setEnd=w(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},ae.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ae.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},ae.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ae.moveToBookmark=function(t){for(var n,a,o=[],r=0;n=t.rangeBookmarks[r++];)a=e.createRange(this.win),a.moveToBookmark(n),o.push(a);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},ae.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ae.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},ae.toHtml=function(){var e=[];return this.eachRange(function(t){e.push($.toHtml(t))}),e.join("")},j.implementsTextRange&&(ae.getNativeTextRange=function(){var n;if(n=this.docSelection){var a=n.createRange();if(f(a))return a;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ae.getName=function(){return"WrappedSelection"},ae.inspect=function(){return x(this)},ae.detach=function(){b(this.win,"delete"),y(this)},v.detachAll=function(){b(null,"deleteAll")},v.inspect=x,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=ae,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})});var I=!1,P=function(e){I||(I=!0,!M.initialized&&M.config.autoInitialize&&u())};return $&&("complete"==document.readyState?P():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",P,!1),j(window,"load",P))),M},this),function(t,n){"function"==typeof define&&define.amd?define(["./rangy-core"],t):"undefined"!=typeof module&&"object"==typeof e?module.exports=t(require("rangy")):t(n.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function a(e,t){var n,a="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=g.getDocument(e.startContainer),r=e.cloneRange();return r.collapse(t),n=o.createElement("span"),n.id=a,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(o.createTextNode(v)),r.insertNode(n),n}function o(e,a,o,r){var i=n(o,e);i?(a[r?"setStartBefore":"setEndBefore"](i),h(i)):t.warn("Marker element has been removed. Cannot restore selection.")}function r(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function i(t,n){var o,r,i=e.DomRange.getRangeDocument(t),s=t.toString(),l=m(n);return t.collapsed?(r=a(t,!1),{document:i,markerId:r.id,collapsed:!0}):(r=a(t,!1),o=a(t,!0),{document:i,startMarkerId:o.id,endMarkerId:r.id,collapsed:!1,backward:l,toString:function(){return"original text: '"+s+"', new text: '"+t.toString()+"'"}})}function s(a,r){var i=a.document;"undefined"==typeof r&&(r=!0);var s=e.createRange(i);if(a.collapsed){var l=n(a.markerId,i);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(h(l),s.collapseToPoint(c,c.length)):(s.collapseBefore(l),h(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(i,s,a.startMarkerId,!0),o(i,s,a.endMarkerId,!1);return r&&s.normalizeBoundaries(),s}function l(t,a){var o,s,l=[],c=m(a);t=t.slice(0),t.sort(r);for(var d=0,u=t.length;u>d;++d)l[d]=i(t[d],c);for(d=u-1;d>=0;--d)o=t[d],s=e.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(n(l[d].markerId,s)):(o.setEndBefore(n(l[d].endMarkerId,s)),o.setStartAfter(n(l[d].startMarkerId,s)));return l}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var a=e.getSelection(n),o=a.getAllRanges(),r=1==o.length&&a.isBackward(),i=l(o,r);return r?a.setSingleRange(o[0],r):a.setRanges(o),{win:n,rangeInfos:i,restored:!1}}function d(e){for(var t=[],n=e.length,a=n-1;a>=0;a--)t[a]=s(e[a],!0);return t}function u(t,n){if(!t.restored){var a=t.rangeInfos,o=e.getSelection(t.win),r=d(a),i=a.length;1==i&&n&&e.features.selectionHasExtend&&a[0].backward?(o.removeAllRanges(),o.addRange(r[0],!0)):o.setRanges(r),t.restored=!0}}function p(e,t){var a=n(t,e);a&&h(a)}function f(e){for(var t,n=e.rangeInfos,a=0,o=n.length;o>a;++a)t=n[a],t.collapsed?p(e.doc,t.markerId):(p(e.doc,t.startMarkerId),p(e.doc,t.endMarkerId))}var g=e.dom,h=g.removeNode,m=e.Selection.isDirectionBackward,v="\ufeff";e.util.extend(e,{saveRange:i,restoreRange:s,saveRanges:l,restoreRanges:d,saveSelection:c,restoreSelection:u,removeMarkerElement:p,removeMarkers:f})}),e},this)}({},function(){return this}()),!function(e,t){t["true"]=e,function(e,t,n){"use strict";function a(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return i(t,u(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function o(e){var n=[],a=u(n,t.noop);return a.chars(e),n.join("")}function r(e){var t,n={},a=e.split(",");for(t=0;t<a.length;t++)n[a[t]]=!0;return n}function i(e,n){function a(e,a,r,i){if(a=t.lowercase(a),R[a])for(;d.last()&&N[d.last()];)o("",d.last());E[a]&&d.last()==a&&o("",a),i=x[a]||!!i,i||d.push(a);var l={};r.replace(h,function(e,t,n,a,o){var r=n||a||o||"";l[t]=s(r)}),n.start&&n.start(a,l,i)}function o(e,a){var o,r=0;if(a=t.lowercase(a))for(r=d.length-1;r>=0&&d[r]!=a;r--);if(r>=0){for(o=d.length-1;o>=r;o--)n.end&&n.end(d[o]);d.length=r}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var r,i,l,c,d=[],u=e;for(d.last=function(){return d[d.length-1]};e;){if(c="",i=!0,d.last()&&O[d.last()]?(e=e.replace(new RegExp("([^]*)<\\s*\\/\\s*"+d.last()+"[^>]*>","i"),function(e,t){return t=t.replace(y,"$1").replace(k,"$1"),n.chars&&n.chars(s(t)),""}),o("",d.last())):(0===e.indexOf("<!--")?(r=e.indexOf("--",4),r>=0&&e.lastIndexOf("-->",r)===r&&(n.comment&&n.comment(e.substring(4,r)),e=e.substring(r+3),i=!1)):b.test(e)?(l=e.match(b),l&&(e=e.replace(l[0],""),i=!1)):v.test(e)?(l=e.match(g),l&&(e=e.substring(l[0].length),l[0].replace(g,o),i=!1)):m.test(e)&&(l=e.match(f),l?(l[4]&&(e=e.substring(l[0].length),l[0].replace(f,a)),i=!1):(c+="<",e=e.substring(1))),i&&(r=e.indexOf("<"),c+=0>r?e:e.substring(0,r),e=0>r?"":e.substring(r),n.chars&&n.chars(s(c)))),e==u)throw p("badparse","The sanitizer was unable to parse the following block of html: {0}",e);u=e}o()}function s(e){if(!e)return"";var t=_.exec(e),n=t[1],a=t[3],o=t[2];return o&&(q.innerHTML=o.replace(/</g,"&lt;"),o="textContent"in q?q.textContent:q.innerText),n+o+a}function l(e){return e.replace(/&/g,"&amp;").replace(T,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(w,function(e){var t=e.charCodeAt(0);return 159>=t||173==t||t>=1536&&1540>=t||1807==t||6068==t||6069==t||t>=8204&&8207>=t||t>=8232&&8239>=t||t>=8288&&8303>=t||65279==t||t>=65520&&65535>=t?"&#"+t+";":e}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(e){var n="",a=e.split(";");return t.forEach(a,function(e){var a=e.split(":");if(2==a.length){var o=I(t.lowercase(a[0])),e=I(t.lowercase(a[1]));(("color"===o||"background-color"===o)&&(e.match(/^rgb\([0-9%,\. ]*\)$/i)||e.match(/^rgba\([0-9%,\. ]*\)$/i)||e.match(/^hsl\([0-9%,\. ]*\)$/i)||e.match(/^hsla\([0-9%,\. ]*\)$/i)||e.match(/^#[0-9a-f]{3,6}$/i)||e.match(/^[a-z]*$/i))||"text-align"===o&&("left"===e||"right"===e||"center"===e||"justify"===e)||"float"===o&&("left"===e||"right"===e||"none"===e)||("width"===o||"height"===o)&&e.match(/[0-9\.]*(px|em|rem|%)/)||"direction"===o&&e.match(/^ltr|rtl|initial|inherit$/))&&(n+=o+": "+e+";")}}),n}function d(e,t,n,a){return"img"===e&&t["ta-insert-video"]&&("ta-insert-video"===n||"allowfullscreen"===n||"frameborder"===n||"contenteditable"===n&&"false"===a)?!0:!1}function u(e,n){var a=!1,o=t.bind(e,e.push);return{start:function(e,r,i){e=t.lowercase(e),!a&&O[e]&&(a=e),a||$[e]!==!0||(o("<"),o(e),t.forEach(r,function(a,i){var s=t.lowercase(i),u="img"===e&&"src"===s||"background"===s;("style"===s&&""!==(a=c(a))||d(e,r,s,a)||j[s]===!0&&(L[s]!==!0||n(a,u)))&&(o(" "),o(i),o('="'),o(l(a)),o('"'))}),o(i?"/>":">"))},end:function(e){e=t.lowercase(e),a||$[e]!==!0||(o("</"),o(e),o(">")),e==a&&(a=!1)},chars:function(e){a||o(l(e))}}}var p=t.$$minErr("$sanitize"),f=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,g=/^<\/\s*([\w:-]+)[^>]*>/,h=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,m=/^</,v=/^<\//,y=/<!--(.*?)-->/g,b=/<!DOCTYPE([^>]*?)>/i,k=/<!\[CDATA\[(.*?)]]>/g,T=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,w=/([^\#-~| |!])/g,x=r("area,br,col,hr,img,wbr,input"),C=r("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),S=r("rp,rt"),E=t.extend({},S,C),R=t.extend({},C,r("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),N=t.extend({},S,r("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),A=r("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),O=r("script,style"),$=t.extend({},x,R,N,E,A),L=r("background,cite,href,longdesc,src,usemap,xlink:href"),M=r("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),D=r("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),j=t.extend({},L,D,M),q=document.createElement("pre"),_=/^(\s*)([\s\S]*?)(\s*)$/,I=function(){
return String.prototype.trim?function(e){return t.isString(e)?e.trim():e}:function(e){return t.isString(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();t.module("ngSanitize",[]).provider("$sanitize",a),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"]/,a=/^mailto:/;return function(r,i){function s(e){e&&f.push(o(e))}function l(e,n){f.push("<a "),t.isDefined(i)&&f.push('target="',i,'" '),f.push('href="',e.replace(/"/g,"&quot;"),'">'),s(n),f.push("</a>")}if(!r)return r;for(var c,d,u,p=r,f=[];c=p.match(n);)d=c[0],c[2]||c[4]||(d=(c[3]?"http://":"mailto:")+d),u=c.index,s(p.substr(0,u)),l(d,c[0].replace(a,"")),p=p.substring(u+c[0].length);return s(p),e(f.join(""))}}])}(window,window.angular)}({},function(){return this}()),angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)?(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(e,t){return{imgOnSelectAction:function(e,t,n){var a=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var o=n.displayElements.popoverContainer;o.empty();var r=angular.element('<div class="btn-group" style="padding-right: 6px;">'),i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');c.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),r.append(i),r.append(s),r.append(l),r.append(c),o.append(r),r=angular.element('<div class="btn-group" style="padding-right: 6px;">');var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');d.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),r.append(d),r.append(p),r.append(u),o.append(r),r=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(e){e.preventDefault(),t.remove(),a()}),r.append(f),o.append(r),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(n,a,o){n.preventDefault(),o.displayElements.popover.css("width","436px");var r=o.displayElements.popoverContainer;r.empty(),r.css("line-height","28px");var i=angular.element('<a href="'+a.attr("href")+'" target="_blank">'+a.attr("href")+"</a>");i.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),r.append(i);var s=angular.element('<div class="btn-group pull-right">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');l.on("click",function(n){n.preventDefault();var r=e.prompt(t.insertLink.dialogPrompt,a.attr("href"));r&&""!==r&&"http://"!==r&&(a.attr("href",r),o.updateTaBindtaTextElement()),o.hidePopover()}),s.append(l);var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');c.on("click",function(e){e.preventDefault(),a.replaceWith(a.contents()),o.updateTaBindtaTextElement(),o.hidePopover()}),s.append(c);var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+t.editLink.targetToggle.buttontext+"</button>");"_blank"===a.attr("target")&&d.addClass("active"),d.on("click",function(e){e.preventDefault(),a.attr("target","_blank"===a.attr("target")?"":"_blank"),d.toggleClass("active"),o.updateTaBindtaTextElement()}),s.append(d),r.append(s),o.showPopover(a)}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions",function(e,t,n,a,o){e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var r=function(e){return function(){return this.$editor().queryFormatBlockState(e)}},i=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:i,activeState:r(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:n.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var o=angular.element(a.getSelectionElement()),r=function(e){e=angular.element(e);var t=e;angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(o.find("ul"),r),angular.forEach(o.find("ol"),r),"li"===o[0].tagName.toLowerCase()){var i=o[0].parentNode.childNodes,s=[],l=[],c=!1;for(n=0;n<i.length;n++)i[n]===o[0]?c=!0:c?l.push(i[n]):s.push(i[n]);var d=angular.element(o[0].parentNode),u=angular.element("<p></p>");if(u.html(angular.element(o[0]).html()),0===s.length||0===l.length)0===l.length?d.after(u):d[0].parentNode.insertBefore(u[0],d[0]),0===s.length&&0===l.length?d.remove():angular.element(o[0]).remove();else{var p=angular.element("<"+d[0].tagName+"></"+d[0].tagName+">"),f=angular.element("<"+d[0].tagName+"></"+d[0].tagName+">");for(n=0;n<s.length;n++)p.append(angular.element(s[n]));for(n=0;n<l.length;n++)f.append(angular.element(l[n]));d.after(f),d.after(u),d.after(p),d.remove()}a.setSelectionToElementEnd(u[0])}var g=this.$editor(),h=function(e){e=angular.element(e),e[0]!==g.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),h)};angular.forEach(o,h),"li"!==o[0].tagName.toLowerCase()&&"ol"!==o[0].tagName.toLowerCase()&&"ul"!==o[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}}),e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;return e=t.prompt(n.insertImage.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("insertImage",e,!0):void 0},onElementSelect:{element:"img",action:o.imgOnSelectAction}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if(e=t.prompt(n.insertVideo.dialogPrompt,"https://"),e&&""!==e&&"https://"!==e){var a=e.match(/(\?|&)v=[^&]*/);if(a&&a.length>0){var o="https://www.youtube.com/embed/"+a[0].substring(3),r='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+a[0].substring(3)+'/hqdefault.jpg" ta-insert-video="'+o+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",r,!0)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:o.imgOnSelectAction}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return e=t.prompt(n.insertLink.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:o.aOnSelectAction}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerHTML||"",n=0;return""!==t.replace(/\s*<[^>]*?>\s*/g,"")&&(n=t.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=n,this.$editor().wordcount=n,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerText||e[0].textContent,n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]),!function(e,t){t["true"]=e,angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)?(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(e,t){return{imgOnSelectAction:function(e,t,n){var a=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var o=n.displayElements.popoverContainer;o.empty();var r=angular.element('<div class="btn-group" style="padding-right: 6px;">'),i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');c.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),r.append(i),r.append(s),r.append(l),r.append(c),o.append(r),r=angular.element('<div class="btn-group" style="padding-right: 6px;">');var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');d.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),r.append(d),r.append(p),r.append(u),o.append(r),r=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(e){e.preventDefault(),t.remove(),a()}),r.append(f),o.append(r),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(n,a,o){n.preventDefault(),o.displayElements.popover.css("width","436px");var r=o.displayElements.popoverContainer;r.empty(),r.css("line-height","28px");var i=angular.element('<a href="'+a.attr("href")+'" target="_blank">'+a.attr("href")+"</a>");i.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),r.append(i);var s=angular.element('<div class="btn-group pull-right">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');l.on("click",function(n){n.preventDefault();var r=e.prompt(t.insertLink.dialogPrompt,a.attr("href"));r&&""!==r&&"http://"!==r&&(a.attr("href",r),o.updateTaBindtaTextElement()),o.hidePopover()}),s.append(l);var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');c.on("click",function(e){e.preventDefault(),a.replaceWith(a.contents()),o.updateTaBindtaTextElement(),o.hidePopover()}),s.append(c);var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+t.editLink.targetToggle.buttontext+"</button>");"_blank"===a.attr("target")&&d.addClass("active"),d.on("click",function(e){e.preventDefault(),a.attr("target","_blank"===a.attr("target")?"":"_blank"),d.toggleClass("active"),o.updateTaBindtaTextElement()}),s.append(d),r.append(s),o.showPopover(a)}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions",function(e,t,n,a,o){e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var r=function(e){return function(){return this.$editor().queryFormatBlockState(e)}},i=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:i,activeState:r(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:n.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var o=angular.element(a.getSelectionElement()),r=function(e){e=angular.element(e);var t=e;angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(o.find("ul"),r),angular.forEach(o.find("ol"),r),"li"===o[0].tagName.toLowerCase()){var i=o[0].parentNode.childNodes,s=[],l=[],c=!1;for(n=0;n<i.length;n++)i[n]===o[0]?c=!0:c?l.push(i[n]):s.push(i[n]);var d=angular.element(o[0].parentNode),u=angular.element("<p></p>");if(u.html(angular.element(o[0]).html()),0===s.length||0===l.length)0===l.length?d.after(u):d[0].parentNode.insertBefore(u[0],d[0]),0===s.length&&0===l.length?d.remove():angular.element(o[0]).remove();else{var p=angular.element("<"+d[0].tagName+"></"+d[0].tagName+">"),f=angular.element("<"+d[0].tagName+"></"+d[0].tagName+">");for(n=0;n<s.length;n++)p.append(angular.element(s[n]));for(n=0;n<l.length;n++)f.append(angular.element(l[n]));d.after(f),d.after(u),d.after(p),d.remove()}a.setSelectionToElementEnd(u[0])}var g=this.$editor(),h=function(e){e=angular.element(e),e[0]!==g.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),h)};angular.forEach(o,h),"li"!==o[0].tagName.toLowerCase()&&"ol"!==o[0].tagName.toLowerCase()&&"ul"!==o[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}}),e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;return e=t.prompt(n.insertImage.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("insertImage",e,!0):void 0},onElementSelect:{element:"img",action:o.imgOnSelectAction}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if(e=t.prompt(n.insertVideo.dialogPrompt,"https://"),e&&""!==e&&"https://"!==e){var a=e.match(/(\?|&)v=[^&]*/);if(a&&a.length>0){var o="https://www.youtube.com/embed/"+a[0].substring(3),r='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+a[0].substring(3)+'/hqdefault.jpg" ta-insert-video="'+o+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",r,!0)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:o.imgOnSelectAction}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return e=t.prompt(n.insertLink.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:o.aOnSelectAction}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerHTML||"",n=0;return""!==t.replace(/\s*<[^>]*?>\s*/g,"")&&(n=t.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=n,this.$editor().wordcount=n,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerText||e[0].textContent,n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]),function(){"use strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(t,n){if(!t||""===t||v.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(n.display&&(""===n.display||!e(n.display))||!n.display&&!n.buttontext&&!n.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';v[t]=n}var n={ie:function(){for(var e,t=3,n=document.createElement("div"),a=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},a=!1;n.webkit&&(document.addEventListener("mousedown",function(e){var t=e||window.event,n=t.target;if(a&&null!==n){for(var o=!1,r=n;null!==r&&"html"!==r.tagName.toLowerCase()&&!o;)o="true"===r.contentEditable,r=r.parentNode;o||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),n.focus(),n.select&&n.select())}a=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" aria-hidden="true" unselectable="on" tabIndex="-1">'));
}));var o=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,r=/^(ul|li|ol)$/i,i=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var s,l,c,d,u,p;if(n.ie>8||void 0===n.ie){for(var f=document.styleSheets,g=0;g<f.length;g++)if((0===f[g].media.length||f[g].media.mediaText.match(/(all|screen)/gi))&&f[g].href&&f[g].href.match(/textangular\.(min\.|)css/gi)){s=f[g];break}s||(s=function(){var e=document.createElement("style");return n.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),l=function(e,t){return d(s,e,t)},d=function(e,t,n){var a,o;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),s.rules?o=s.rules[a]:s.cssRules&&(o=s.cssRules[a]),o},p=function(e,t){var n,a;for(n=0;n<t.length;n++)if(t[n].cssText===e.cssText){a=n;break}return a},c=function(e){u(s,e)},u=function(e,t){var n=e.cssRules||e.rules;if(n){var a=p(t,n);e.removeRule?e.removeRule(a):e.deleteRule(a)}}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===n.ie?"div":n.ie<=8?"P":"p":n.ie<=8?e.toUpperCase():e:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var a=angular.element("<div></div>");return a[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=a.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(a,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),a[0].innerHTML}}]).factory("taFixChrome",function(){var e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,a,o=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,r="",i=0;t=o.exec(e);)n=t[3]||t[4],n&&n.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/gi,""),a="<"+t[1].trim(),n.trim().length>0&&(a+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),a+=t[5].trim()+">",r+=e.substring(i,t.index)+a,i=t.index+t[0].length);return r+=e.substring(i),i>0?r.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e};return e}).factory("taSanitize",["$sanitize",function(e){function t(e,t){for(var n,a=0,o=0,r=/<[^>]*>/gi;n=r.exec(e);)if(o=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,o)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(o)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var a,r,i,s,l,d,u=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,p="",f="",g=0;r=u.exec(e);){s=r[3]||r[4];var h=new RegExp(c,"i");if(angular.isString(s)&&h.test(s)){l="";for(var m=new RegExp(c,"ig");i=m.exec(s);)for(a=0;a<o.length;a++)i[2*a+2]&&(l+="<"+o[a].tag+">");d=n(e.substring(g,r.index)),f+=p.length>0?t(d,p):d,s=s.replace(new RegExp(c,"ig"),""),f+="<"+r[1].trim(),s.length>0&&(f+=' style="'+s+'"'),f+=r[5]+">",g=r.index+r[0].length,p=l}}return f+=p.length>0?t(e.substring(g),p):e.substring(g)}function a(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",o=0;t=n.exec(e);){a+=e.substring(o,t.index),o=t.index+t[0].length;var r="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(r)?r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):r+=' style="text-align:'+(t[3]||t[4])+';"',r+=">",a+=r}return a+e.substring(o)}for(var o=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],r=[],i=0;i<o.length;i++){for(var s="("+o[i].property+":\\s*(",l=0;l<o[i].values.length;l++)l>0&&(s+="|"),s+=o[i].values[l];s+=");)",r.push(s)}var c="("+r.join("|")+")";return function(t,o,r){if(!r)try{t=n(t)}catch(i){}t=a(t);var s;try{s=e(t),r&&(s=t)}catch(i){s=o||""}var l,c=s.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),d=s.replace(/(&#(9|10);)*/gi,""),u=/<pre[^>]*>.*?<\/pre[^>]*>/gi,p=0,f=0;for(s="";null!==(l=u.exec(d))&&p<c.length;)s+=d.substring(f,l.index)+c[p],f=l.index+l[0].length,p++;return s+d.substring(f)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var a,o=e.defer(),r=o.promise,i=this.$editor();try{a=this.action(o,i.startAction()),r["finally"](function(){i.endAction.call(i)})}catch(s){t.error(s)}(a||void 0===a)&&o.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var a=function(t,n){var a,o,r=t.find("li");for(o=r.length-1;o>=0;o--)a=angular.element("<"+n+">"+r[o].innerHTML+"</"+n+">"),t.after(a);t.remove(),e.setSelectionToElementEnd(a[0])},i=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},s=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),i(n.find("li")[0])},l=function(e,n,a){for(var o="",r=0;r<e.length;r++)o+="<"+t("li")+">"+e[r].innerHTML+"</"+t("li")+">";var s=angular.element("<"+a+">"+o+"</"+a+">");n.after(s),n.remove(),i(s.find("li")[0])};return function(i,c){return i=t(i),function(d,u,p,f){var g,h,m,v,y,b,k,T=angular.element("<"+i+">");try{k=e.getSelectionElement()}catch(w){}var x=angular.element(k);if(void 0!==k){var C=k.tagName.toLowerCase();if("insertorderedlist"===d.toLowerCase()||"insertunorderedlist"===d.toLowerCase()){var S=t("insertorderedlist"===d.toLowerCase()?"ol":"ul");if(C===S)return a(x,i);if("li"===C&&x.parent()[0].tagName.toLowerCase()===S&&1===x.parent().children().length)return a(x.parent(),i);if("li"===C&&x.parent()[0].tagName.toLowerCase()!==S&&1===x.parent().children().length)return s(x.parent(),S);if(C.match(o)&&!x.hasClass("ta-bind")){if("ol"===C||"ul"===C)return s(x,S);var E=!1;return angular.forEach(x.children(),function(e){e.tagName.match(o)&&(E=!0)}),E?l(x.children(),x,S):l([angular.element("<div>"+k.innerHTML+"</div>")[0]],x,S)}if(C.match(o)){if(v=e.getOnlySelectedElements(),0===v.length)h=angular.element("<"+S+"><li>"+k.innerHTML+"</li></"+S+">"),x.html(""),x.append(h);else{if(1===v.length&&("ol"===v[0].tagName.toLowerCase()||"ul"===v[0].tagName.toLowerCase()))return v[0].tagName.toLowerCase()===S?a(angular.element(v[0]),i):s(angular.element(v[0]),S);m="";var R=[];for(g=0;g<v.length;g++)if(3!==v[g].nodeType){var N=angular.element(v[g]);if("li"===v[g].tagName.toLowerCase())continue;m+="ol"===v[g].tagName.toLowerCase()||"ul"===v[g].tagName.toLowerCase()?N[0].innerHTML:"span"!==v[g].tagName.toLowerCase()||"ol"!==v[g].childNodes[0].tagName.toLowerCase()&&"ul"!==v[g].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+N[0].innerHTML+"</"+t("li")+">":N[0].childNodes[0].innerHTML,R.unshift(N)}h=angular.element("<"+S+">"+m+"</"+S+">"),R.pop().replaceWith(h),angular.forEach(R,function(e){e.remove()})}return void e.setSelectionToElementEnd(h[0])}}else{if("formatblock"===d.toLowerCase()){for(b=p.toLowerCase().replace(/[<>]/gi,""),"default"===b.trim()&&(b=i,p="<"+i+">"),h="li"===C?x.parent():x;!h[0].tagName||!h[0].tagName.match(o)&&!h.parent().attr("contenteditable");)h=h.parent(),C=(h[0].tagName||"").toLowerCase();if(C===b){v=h.children();var A=!1;for(g=0;g<v.length;g++)A=A||v[g].tagName.match(o);A?(h.after(v),y=h.next(),h.remove(),h=y):(T.append(h[0].childNodes),h.after(T),h.remove(),h=T)}else if(h.parent()[0].tagName.toLowerCase()!==b||h.parent().hasClass("ta-bind"))if(C.match(r))h.wrap(p);else{for(v=e.getOnlySelectedElements(),0===v.length&&(v=[h[0]]),g=0;g<v.length;g++)if(3===v[g].nodeType||!v[g].tagName.match(o))for(;3===v[g].nodeType||!v[g].tagName||!v[g].tagName.match(o);)v[g]=v[g].parentNode;if(angular.element(v[0]).hasClass("ta-bind"))h=angular.element(p),h[0].innerHTML=v[0].innerHTML,v[0].innerHTML=h[0].outerHTML;else if("blockquote"===b){for(m="",g=0;g<v.length;g++)m+=v[g].outerHTML;for(h=angular.element(p),h[0].innerHTML=m,v[0].parentNode.insertBefore(h[0],v[0]),g=v.length-1;g>=0;g--)v[g].parentNode&&v[g].parentNode.removeChild(v[g])}else for(g=0;g<v.length;g++)h=angular.element(p),h[0].innerHTML=v[g].innerHTML,v[g].parentNode.insertBefore(h[0],v[g]),v[g].parentNode.removeChild(v[g])}else{var O=h.parent(),$=O.contents();for(g=0;g<$.length;g++)O.parent().hasClass("ta-bind")&&3===$[g].nodeType&&(T=angular.element("<"+i+">"),T[0].innerHTML=$[g].outerHTML,$[g]=T[0]),O.parent()[0].insertBefore($[g],O[0]);O.remove()}return void e.setSelectionToElementEnd(h[0])}if("createlink"===d.toLowerCase()){var L='<a href="'+p+'" target="'+(f.a.target?f.a.target:"")+'">',M="</a>",D=e.getSelection();if(D.collapsed)e.insertHtml(L+p+M,c);else if(rangy.getSelection().getRangeAt(0).canSurroundContents()){var j=angular.element(L+M)[0];rangy.getSelection().getRangeAt(0).surroundContents(j)}return}if("inserthtml"===d.toLowerCase())return void e.insertHtml(p,c)}}try{n[0].execCommand(d,u,p)}catch(w){}}}}]).service("taSelection",["$window","$document","taDOM",function(e,t,n){var a=t[0],r=e.rangy,s=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},l={getSelection:function(){var e=r.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:s(e.startContainer,e.startOffset),end:s(e.endContainer,e.endOffset),collapsed:e.collapsed};return t=3===t.nodeType?t.parentNode:t,t.parentNode===n.start.element||t.parentNode===n.end.element?n.container=t.parentNode:n.container=t,n},getOnlySelectedElements:function(){var e=r.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return l.getSelection().container},setSelection:function(e,t,n){var a=r.createRange();a.setStart(e,t),a.setEnd(e,n),r.getSelection().setSingleRange(a)},setSelectionBeforeElement:function(e){var t=r.createRange();t.selectNode(e),t.collapse(!0),r.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=r.createRange();t.selectNode(e),t.collapse(!1),r.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=r.createRange();t.selectNodeContents(e),t.collapse(!0),r.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=r.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),r.getSelection().setSingleRange(t)},insertHtml:function(e,t){var s,c,d,u,p,f,g,h=angular.element("<div>"+e+"</div>"),m=r.getSelection().getRangeAt(0),v=a.createDocumentFragment(),y=h[0].childNodes,b=!0;if(y.length>0){for(u=[],d=0;d<y.length;d++)"p"===y[d].nodeName.toLowerCase()&&""===y[d].innerHTML.trim()||3===y[d].nodeType&&""===y[d].nodeValue.trim()||(b=b&&!o.test(y[d].nodeName),u.push(y[d]));for(var k=0;k<u.length;k++)f=v.appendChild(u[k]);!b&&m.collapsed&&/^(|<br(|\/)>)$/i.test(m.startContainer.innerHTML)&&m.selectNode(m.startContainer)}else b=!0,f=v=a.createTextNode(e);if(b)m.deleteContents();else if(m.collapsed&&m.startContainer!==t)if(m.startContainer.innerHTML&&m.startContainer.innerHTML.match(/^<[^>]*>$/i))s=m.startContainer,1===m.startOffset?(m.setStartAfter(s),m.setEndAfter(s)):(m.setStartBefore(s),m.setEndBefore(s));else{if(3===m.startContainer.nodeType&&m.startContainer.parentNode!==t)for(s=m.startContainer.parentNode,c=s.cloneNode(),n.splitNodes(s.childNodes,s,c,m.startContainer,m.startOffset);!i.test(s.nodeName);){angular.element(s).after(c),s=s.parentNode;var T=c;c=s.cloneNode(),n.splitNodes(s.childNodes,s,c,T)}else s=m.startContainer,c=s.cloneNode(),n.splitNodes(s.childNodes,s,c,void 0,void 0,m.startOffset);if(angular.element(s).after(c),m.setStartAfter(s),m.setEndAfter(s),/^(|<br(|\/)>)$/i.test(s.innerHTML.trim())&&(m.setStartBefore(s),m.setEndBefore(s),angular.element(s).remove()),/^(|<br(|\/)>)$/i.test(c.innerHTML.trim())&&angular.element(c).remove(),"li"===s.nodeName.toLowerCase()){for(g=a.createDocumentFragment(),p=0;p<v.childNodes.length;p++)h=angular.element("<li>"),n.transferChildNodes(v.childNodes[p],h[0]),n.transferNodeAttributes(v.childNodes[p],h[0]),g.appendChild(h[0]);v=g,f&&(f=v.childNodes[v.childNodes.length-1],f=f.childNodes[f.childNodes.length-1])}}else m.deleteContents();m.insertNode(v),f&&l.setSelectionToElementEnd(f)}};return l}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var a=[],o=t.children();return o.length&&angular.forEach(o,function(t){a=a.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&a.push(t),a},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,a,o,r,i){if(!o&&isNaN(i))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var s=document.createDocumentFragment(),l=document.createDocumentFragment(),c=0;t.length>0&&(isNaN(i)||i!==c)&&t[0]!==o;)s.appendChild(t[0]),c++;for(!isNaN(r)&&r>=0&&t[0]&&(s.appendChild(document.createTextNode(t[0].nodeValue.substring(0,r))),t[0].nodeValue=t[0].nodeValue.substring(r));t.length>0;)l.appendChild(t[0]);e.transferChildNodes(s,n),e.transferChildNodes(l,a)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=o}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=o}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var a,o=/(^[^<]|>)[^<]/i.exec(n);return o?a=o.index:(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),a=n.indexOf(">")),n=n.trim().substring(a,a+100),/^[^<>]+$/i.test(n)?!1:0===n.length||n===t||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n)?!0:/>\s*[^\s<]/i.test(n)||e.test(n)?!1:!0}}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(e,t,r,s,d,u,p,f,g,m,v,y,b,k){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(u,T,w,x){var C,S,E,R,N=x[0],A=x[1]||{},O=void 0!==T.attr("contenteditable")&&T.attr("contenteditable"),$=O||"textarea"===T[0].tagName.toLowerCase()||"input"===T[0].tagName.toLowerCase(),L=!1,M=!1,D=!1,j=w.taUnsafeSanitizer||m.disableSanitizer,q=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,_=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;void 0===w.taDefaultWrap&&(w.taDefaultWrap="p"),""===w.taDefaultWrap?(E="",R=void 0===n.ie?"<div><br></div>":n.ie>=11?"<p><br></p>":n.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(E=void 0===n.ie||n.ie>=11?"<"+w.taDefaultWrap+"><br></"+w.taDefaultWrap+">":n.ie<=8?"<"+w.taDefaultWrap.toUpperCase()+"></"+w.taDefaultWrap.toUpperCase()+">":"<"+w.taDefaultWrap+"></"+w.taDefaultWrap+">",R=void 0===n.ie||n.ie>=11?"<"+w.taDefaultWrap+"><br></"+w.taDefaultWrap+">":n.ie<=8?"<"+w.taDefaultWrap.toUpperCase()+">&nbsp;</"+w.taDefaultWrap.toUpperCase()+">":"<"+w.taDefaultWrap+">&nbsp;</"+w.taDefaultWrap+">"),A.$options||(A.$options={});var I=v(R),P=function(e){if(I(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+w.taDefaultWrap+">"+e+"</"+w.taDefaultWrap+">";else{var n,a=t[0].childNodes,r=!1;for(n=0;n<a.length&&!(r=a[n].nodeName.toLowerCase().match(o));n++);if(r)for(e="",n=0;n<a.length;n++)if(a[n].nodeName.toLowerCase().match(o))e+=a[n].outerHTML;else{var i=a[n].outerHTML||a[n].nodeValue;e+=""!==i.trim()?"<"+w.taDefaultWrap+">"+i+"</"+w.taDefaultWrap+">":i}else e="<"+w.taDefaultWrap+">"+e+"</"+w.taDefaultWrap+">"}return e};w.taPaste&&(S=y(w.taPaste)),T.addClass("ta-bind");var B;u["$undoManager"+(w.id||"")]=N.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),B&&t.cancel(B),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var H,F=u["$undoTaBind"+(w.id||"")]=function(){if(!L&&O){var e=N.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(ae(e),K(e,!1),H&&t.cancel(H),H=t(function(){T[0].focus(),p.setSelectionToElementEnd(T[0])},1))}},z=u["$redoTaBind"+(w.id||"")]=function(){if(!L&&O){var e=N.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(ae(e),K(e,!1),H&&t.cancel(H),H=t(function(){T[0].focus(),p.setSelectionToElementEnd(T[0])},1))}},W=function(){if(O)return T[0].innerHTML;if($)return T.val();throw"textAngular Error: attempting to update non-editable taBind"},K=function(e,t,n){D=n||!1,("undefined"==typeof t||null===t)&&(t=O),("undefined"==typeof e||null===e)&&(e=W()),I(e)?(""!==N.$viewValue&&N.$setViewValue(""),t&&""!==N.$undoManager.current()&&N.$undoManager.push("")):(ne(),N.$viewValue!==e&&(N.$setViewValue(e),t&&N.$undoManager.push(e))),N.$render()};u["updateTaBind"+(w.id||"")]=function(){L||K(void 0,void 0,!0)};var U=function(t){return N.$oldViewValue=e(d(t),N.$oldViewValue,j)};if(T.attr("required")&&(N.$validators.required=function(e,t){return!I(e||t)}),N.$parsers.push(U),N.$parsers.unshift(P),N.$formatters.push(U),N.$formatters.unshift(P),N.$formatters.unshift(function(e){return N.$undoManager.push(e||"")}),$)if(u.events={},O){var V=!1,G=function(n){if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){var a=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);a=a?a[1]:n,a=a.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var o=angular.element("<div>"+a+"</div>"),r=angular.element("<div></div>"),i={element:null,lastIndent:[],lastLi:null,isUl:!1};i.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var s=function(e){i.isUl=e,i.element=angular.element(e?"<ul>":"<ol>"),i.lastIndent=[],i.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},i.lastLevelMatch=null},l=0;l<=o[0].childNodes.length;l++)if(o[0].childNodes[l]&&"#text"!==o[0].childNodes[l].nodeName&&"p"===o[0].childNodes[l].tagName.toLowerCase()){var c=angular.element(o[0].childNodes[l]),d=(c.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(d){if(c[0].childNodes.length<2||c[0].childNodes[1].childNodes.length<1)continue;var f="bullet"===d[1].toLowerCase()||"number"!==d[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(c[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(c[0].childNodes[1].childNodes[0].innerHTML)),g=(c.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),h=parseFloat(g?g[1]:0),m=(c.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(m&&m[2]&&(h=parseInt(m[2])),m&&(!i.lastLevelMatch||m[1]!==i.lastLevelMatch[1])||!d[3]||"first"===d[3].toLowerCase()||null===i.lastIndent.peek()||i.isUl!==f&&i.lastIndent.peek()===h)s(f),r.append(i.element);else if(null!=i.lastIndent.peek()&&i.lastIndent.peek()<h)i.element=angular.element(f?"<ul>":"<ol>"),i.lastLi.append(i.element);else if(null!=i.lastIndent.peek()&&i.lastIndent.peek()>h){for(;null!=i.lastIndent.peek()&&i.lastIndent.peek()>h;)if("li"!==i.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(i.element.parent()[0].tagName.toLowerCase()))break;i.element=i.element.parent(),i.lastIndent.pop()}else i.element=i.element.parent();i.isUl="ul"===i.element[0].tagName.toLowerCase(),f!==i.isUl&&(s(f),r.append(i.element))}i.lastLevelMatch=m,h!==i.lastIndent.peek()&&i.lastIndent.push(h),i.lastLi=angular.element("<li>"),i.element.append(i.lastLi),i.lastLi.html(c.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),c.remove()}else s(!1),r.append(c)}var v=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(r.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&v(e)}),angular.forEach(r.find("font"),v),n=r.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/gi,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){var y=angular.element("<div>"+n+"</div>");y.find("textarea").remove();for(var k=b.getByAttribute(y,"ta-bind"),w=0;w<k.length;w++){for(var x=k[w][0].parentNode.parentNode,C=0;C<k[w][0].childNodes.length;C++)x.parentNode.insertBefore(k[w][0].childNodes[C],x);x.parentNode.removeChild(x)}n=y.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n=n.replace(/<(|\/)span[^>]*?>/gi,""));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*)?>/i.test(n)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(n)===!1&&(n=n.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")),S&&(n=S(u,{$html:n})||n),n=e(n,"",j),p.insertHtml(n,T[0]),t(function(){N.$setViewValue(W()),V=!1,T.removeClass("processing-paste")},0)}else V=!1,T.removeClass("processing-paste")};T.on("paste",u.events.paste=function(e,n){if(n&&angular.extend(e,n),L||V)return e.stopPropagation(),e.preventDefault(),!1;V=!0,T.addClass("processing-paste");var a,o=(e.originalEvent||e).clipboardData;if(o&&o.getData&&o.types.length>0){for(var i="",l=0;l<o.types.length;l++)i+=" "+o.types[l];return/text\/html/i.test(i)?a=o.getData("text/html"):/text\/plain/i.test(i)&&(a=o.getData("text/plain")),G(a),e.stopPropagation(),e.preventDefault(),!1}var c=r.rangy.saveSelection(),d=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');s.find("body").append(d),d[0].focus(),t(function(){r.rangy.restoreSelection(c),G(d[0].innerHTML),T[0].focus(),d.remove()},0)}),T.on("cut",u.events.cut=function(e){L?e.preventDefault():t(function(){N.$setViewValue(W())},0)}),T.on("keydown",u.events.keydown=function(e,t){if(t&&angular.extend(e,t),e.ctrlKey===!1&&e.metaKey===!1&&9===e.keyCode&&(e.preventDefault(),e.specialKey="TabKey",e.shiftKey&&(e.specialKey="ShiftTabKey"),k.sendKeyCommand(u,e)),!L)if(e.altKey||!e.metaKey&&!e.ctrlKey){if(13===e.keyCode&&!e.shiftKey){var n,a=p.getSelectionElement();if(!a.tagName.match(i))return;var o=angular.element(E);if(/^<br(|\/)>$/i.test(a.innerHTML.trim())&&"blockquote"===a.parentNode.tagName.toLowerCase()&&!a.nextSibling){n=angular.element(a);var r=n.parent();r.after(o),n.remove(),0===r.children().length&&r.remove(),p.setSelectionToElementStart(o[0]),e.preventDefault()}else/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(a.innerHTML.trim())&&"blockquote"===a.tagName.toLowerCase()&&(n=angular.element(a),n.after(o),n.remove(),p.setSelectionToElementStart(o[0]),e.preventDefault())}}else 90!==e.keyCode||e.shiftKey?(90===e.keyCode&&e.shiftKey||89===e.keyCode&&!e.shiftKey)&&(z(),e.preventDefault()):(F(),e.preventDefault())});var J;if(T.on("keyup",u.events.keyup=function(e,n){if(n&&angular.extend(e,n),9===e.keyCode){var a=p.getSelection();return void(a.start.element===T[0]&&T.children().length&&p.setSelectionToElementStart(T.children()[0]))}if(B&&t.cancel(B),!L&&!q.test(e.keyCode)){if(""!==E&&13===e.keyCode&&!e.shiftKey){for(var o=p.getSelectionElement();!o.tagName.match(i)&&o!==T[0];)o=o.parentNode;if(o.tagName.toLowerCase()!==w.taDefaultWrap&&"li"!==o.tagName.toLowerCase()&&(""===o.innerHTML.trim()||"<br>"===o.innerHTML.trim())){var s=angular.element(E);angular.element(o).replaceWith(s),p.setSelectionToElementStart(s[0])}}var l=W();if(""!==E&&""===l.trim())ae(E),p.setSelectionToElementStart(T.children()[0]);else if("<"!==l.substring(0,1)&&""!==w.taDefaultWrap){var c=r.rangy.saveSelection();l=W(),l="<"+w.taDefaultWrap+">"+l+"</"+w.taDefaultWrap+">",ae(l),r.rangy.restoreSelection(c)}var d=C!==e.keyCode&&_.test(e.keyCode);J&&t.cancel(J),J=t(function(){K(l,d,!0)},A.$options.debounce||400),d||(B=t(function(){N.$undoManager.push(l)},250)),C=e.keyCode}}),T.on("blur",u.events.blur=function(){M=!1,L?(D=!0,N.$render()):K(void 0,void 0,!0)}),w.placeholder&&(n.ie>8||void 0===n.ie)){var Y;if(!w.id)throw"textAngular Error: An unique ID is required for placeholders to work";Y=l("#"+w.id+".placeholder-text:before",'content: "'+w.placeholder+'"'),u.$on("$destroy",function(){c(Y)})}T.on("focus",u.events.focus=function(){M=!0,T.removeClass("placeholder-text"),ne()}),T.on("mouseup",u.events.mouseup=function(){var e=p.getSelection();e.start.element===T[0]&&T.children().length&&p.setSelectionToElementStart(T.children()[0])}),T.on("mousedown",u.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{T.on("change blur",u.events.change=u.events.blur=function(){L||N.$setViewValue(W())}),T.on("keydown",u.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,o=T.val();if(e.shiftKey){var r=o.lastIndexOf("\n",n),i=o.lastIndexOf("	",n);-1!==i&&i>=r&&(T.val(o.substring(0,i)+o.substring(i+1)),this.selectionStart=this.selectionEnd=n-1)}else T.val(o.substring(0,n)+"	"+o.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var Q=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},X=function(e,t){var n="",a=e.childNodes;t++,n+=Q("	",t-1)+e.outerHTML.substring(0,e.outerHTML.indexOf("<li"));for(var o=0;o<a.length;o++)a[o].outerHTML&&(n+="ul"===a[o].nodeName.toLowerCase()||"ol"===a[o].nodeName.toLowerCase()?"\n"+X(a[o],t):"\n"+Q("	",t)+a[o].outerHTML);return n+="\n"+Q("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};N.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;if(t.length>0){e="";for(var n=0;n<t.length;n++)t[n].outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===t[n].nodeName.toLowerCase()||"ol"===t[n].nodeName.toLowerCase()?""+X(t[n],0):""+t[n].outerHTML)}return e})}var Z,ee=function(e){return u.$emit("ta-element-select",this),e.preventDefault(),!1},te=function(e,n){if(n&&angular.extend(e,n),!h&&!L){h=!0;var a;a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,u.$emit("ta-drop-event",this,e,a),t(function(){h=!1,K(void 0,void 0,!0)},100)}},ne=u["reApplyOnSelectorHandlers"+(w.id||"")]=function(){L||angular.forEach(f,function(e){T.find(e).off("click",ee).on("click",ee)})},ae=function(e){T[0].innerHTML=e},oe=!1;N.$render=function(){if(!oe){oe=!0;var e=N.$viewValue||"";D||(O&&M&&(T.removeClass("placeholder-text"),Z&&t.cancel(Z),Z=t(function(){M||(T[0].focus(),p.setSelectionToElementEnd(T.children()[T.children().length-1])),Z=void 0},1)),O?(ae(w.placeholder?""===e?E:e:""===e?E:e),L?T.off("drop",te):(ne(),T.on("drop",te))):"textarea"!==T[0].tagName.toLowerCase()&&"input"!==T[0].tagName.toLowerCase()?ae(g(e)):T.val(e)),O&&w.placeholder&&(""===e?M?T.removeClass("placeholder-text"):T.addClass("placeholder-text"):T.removeClass("placeholder-text")),oe=D=!1}},w.taReadonly&&(L=u.$eval(w.taReadonly),L?(T.addClass("ta-readonly"),("textarea"===T[0].tagName.toLowerCase()||"input"===T[0].tagName.toLowerCase())&&T.attr("disabled","disabled"),void 0!==T.attr("contenteditable")&&T.attr("contenteditable")&&T.removeAttr("contenteditable")):(T.removeClass("ta-readonly"),"textarea"===T[0].tagName.toLowerCase()||"input"===T[0].tagName.toLowerCase()?T.removeAttr("disabled"):O&&T.attr("contenteditable","true")),u.$watch(w.taReadonly,function(e,t){t!==e&&(e?(T.addClass("ta-readonly"),("textarea"===T[0].tagName.toLowerCase()||"input"===T[0].tagName.toLowerCase())&&T.attr("disabled","disabled"),void 0!==T.attr("contenteditable")&&T.attr("contenteditable")&&T.removeAttr("contenteditable"),angular.forEach(f,function(e){T.find(e).on("click",ee)}),T.off("drop",te)):(T.removeClass("ta-readonly"),"textarea"===T[0].tagName.toLowerCase()||"input"===T[0].tagName.toLowerCase()?T.removeAttr("disabled"):O&&T.attr("contenteditable","true"),angular.forEach(f,function(e){T.find(e).off("click",ee)}),T.on("drop",te)),L=e)})),O&&!L&&(angular.forEach(f,function(e){T.find(e).on("click",ee)}),T.on("drop",te),T.on("blur",function(){n.webkit&&(a=!0)}))}}}]);var h=!1,m=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]),v={};m.constant("taRegisterTool",t),m.value("taTools",v),m.config([function(){angular.forEach(v,function(e,t){delete v[t]})}]),m.run([function(){if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly."}]),m.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(e,t,n,a,o,r,i,s,l,c,d,u){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(p,f,g,h){var m,v,y,b,k,T,w,x,C,S,E,R=g.serial?g.serial:Math.floor(1e16*Math.random());p._name=g.name?g.name:"textAngularEditor"+R;var N=function(e,n,a){t(function(){var t=function(){e.off(n,t),a.apply(this,arguments)};e.on(n,t)},100)};if(C=o(g.taDefaultWrap),angular.extend(p,angular.copy(n),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?p["$undoTaBindtaTextElement"+R]():"redo"===e.toLowerCase()?p["$redoTaBindtaTextElement"+R]():(C(e,!1,t,p.defaultTagAttributes),n&&p["reApplyOnSelectorHandlerstaTextElement"+R](),p.displayElements.text[0].focus())},showHtml:p.$eval(g.taShowHtml)||!1}),g.taFocussedClass&&(p.classes.focussed=g.taFocussedClass),g.taTextEditorClass&&(p.classes.textEditor=g.taTextEditorClass),g.taHtmlEditorClass&&(p.classes.htmlEditor=g.taHtmlEditorClass),g.taDefaultTagAttributes)try{angular.extend(p.defaultTagAttributes,angular.fromJson(g.taDefaultTagAttributes))}catch(A){c.error(A)}g.taTextEditorSetup&&(p.setup.textEditorSetup=p.$parent.$eval(g.taTextEditorSetup)),g.taHtmlEditorSetup&&(p.setup.htmlEditorSetup=p.$parent.$eval(g.taHtmlEditorSetup)),
g.taFileDrop?p.fileDropHandler=p.$parent.$eval(g.taFileDrop):p.fileDropHandler=p.defaultFileDropHandler,w=f[0].innerHTML,f[0].innerHTML="",p.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},p.displayElements.popover.append(p.displayElements.popoverArrow),p.displayElements.popover.append(p.displayElements.popoverContainer),p.displayElements.scrollWindow.append(p.displayElements.popover),p.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),p.showPopover=function(e){p.displayElements.popover.css("display","block"),p.reflowPopover(e),l.addClass(p.displayElements.popover,"in"),N(s.find("body"),"click keyup",function(){p.hidePopover()})},p.reflowPopover=function(e){p.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(p.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+p.displayElements.scrollWindow[0].scrollTop+"px"),p.displayElements.popover.removeClass("top").addClass("bottom")):(p.displayElements.popover.css("top",e[0].offsetTop-54+p.displayElements.scrollWindow[0].scrollTop+"px"),p.displayElements.popover.removeClass("bottom").addClass("top"));var t=p.displayElements.text[0].offsetWidth-p.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-p.displayElements.popover[0].offsetWidth/2;p.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),p.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},p.hidePopover=function(){var e=function(){p.displayElements.popover.css("display",""),p.displayElements.popoverContainer.attr("style",""),p.displayElements.popoverContainer.attr("class","popover-content")};d.when(l.removeClass(p.displayElements.popover,"in",e)).then(e)},p.displayElements.resize.overlay.append(p.displayElements.resize.background),angular.forEach(p.displayElements.resize.anchors,function(e){p.displayElements.resize.overlay.append(e)}),p.displayElements.resize.overlay.append(p.displayElements.resize.info),p.displayElements.scrollWindow.append(p.displayElements.resize.overlay),p.reflowResizeOverlay=function(e){e=angular.element(e)[0],p.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),p.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},p.showResizeOverlay=function(e){var t=s.find("body");S=function(n){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===a.width||isNaN(a.width))&&(a.width=e[0].offsetWidth),(void 0===a.height||isNaN(a.height))&&(a.height=e[0].offsetHeight),p.hidePopover();var o=a.height/a.width,r=function(t){var n={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))},r=void 0!==g.taResizeForceAspectRatio,i=g.taResizeMaintainAspectRatio,s=r||i&&!t.shiftKey;if(s){var l=n.y/n.x;n.x=o>l?n.x:n.y/o,n.y=o>l?n.x*o:n.y}var c=angular.element(e);c.css("height",Math.round(Math.max(0,n.y))),c.css("width",Math.round(Math.max(0,n.x))),p.reflowResizeOverlay(e)};t.on("mousemove",r),N(t,"mouseup",function(n){n.preventDefault(),n.stopPropagation(),t.off("mousemove",r),p.showPopover(e)}),n.stopPropagation(),n.preventDefault()},p.displayElements.resize.anchors[3].off("mousedown"),p.displayElements.resize.anchors[3].on("mousedown",S),p.reflowResizeOverlay(e),N(t,"click",function(){p.hideResizeOverlay()})},p.hideResizeOverlay=function(){p.displayElements.resize.anchors[3].off("mousedown",S),p.displayElements.resize.overlay.css("display","")},p.setup.htmlEditorSetup(p.displayElements.html),p.setup.textEditorSetup(p.displayElements.text),p.displayElements.html.attr({id:"taHtmlElement"+R,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":f.attr("ng-model-options")}),p.displayElements.text.attr({id:"taTextElement"+R,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":f.attr("ng-model-options")}),p.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),g.taDefaultWrap&&p.displayElements.text.attr("ta-default-wrap",g.taDefaultWrap),g.taUnsafeSanitizer&&(p.displayElements.text.attr("ta-unsafe-sanitizer",g.taUnsafeSanitizer),p.displayElements.html.attr("ta-unsafe-sanitizer",g.taUnsafeSanitizer)),p.displayElements.scrollWindow.append(p.displayElements.text),f.append(p.displayElements.scrollWindow),f.append(p.displayElements.html),p.displayElements.forminput.attr("name",p._name),f.append(p.displayElements.forminput),g.tabindex&&(f.removeAttr("tabindex"),p.displayElements.text.attr("tabindex",g.tabindex),p.displayElements.html.attr("tabindex",g.tabindex)),g.placeholder&&(p.displayElements.text.attr("placeholder",g.placeholder),p.displayElements.html.attr("placeholder",g.placeholder)),g.taDisabled&&(p.displayElements.text.attr("ta-readonly","disabled"),p.displayElements.html.attr("ta-readonly","disabled"),p.disabled=p.$parent.$eval(g.taDisabled),p.$parent.$watch(g.taDisabled,function(e){p.disabled=e,p.disabled?f.addClass(p.classes.disabled):f.removeClass(p.classes.disabled)})),g.taPaste&&(p._pasteHandler=function(e){return u(g.taPaste)(p.$parent,{$html:e})},p.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(p.displayElements.scrollWindow)(p),e(p.displayElements.html)(p),p.updateTaBindtaTextElement=p["updateTaBindtaTextElement"+R],p.updateTaBindtaHtmlElement=p["updateTaBindtaHtmlElement"+R],f.addClass("ta-root"),p.displayElements.scrollWindow.addClass("ta-text ta-editor "+p.classes.textEditor),p.displayElements.html.addClass("ta-html ta-editor "+p.classes.htmlEditor),p._actionRunning=!1;var O=!1;if(p.startAction=function(){return p._actionRunning=!0,O=i.rangy.saveSelection(),function(){O&&i.rangy.restoreSelection(O)}},p.endAction=function(){p._actionRunning=!1,O&&(p.showHtml?p.displayElements.html[0].focus():p.displayElements.text[0].focus(),i.rangy.removeMarkers(O)),O=!1,p.updateSelectedStyles(),p.showHtml||p["updateTaBindtaTextElement"+R]()},k=function(){p.focussed=!0,f.addClass(p.classes.focussed),x.focus(),f.triggerHandler("focus")},p.displayElements.html.on("focus",k),p.displayElements.text.on("focus",k),T=function(e){return p._actionRunning||s[0].activeElement===p.displayElements.html[0]||s[0].activeElement===p.displayElements.text[0]||(f.removeClass(p.classes.focussed),x.unfocus(),t(function(){p._bUpdateSelectedStyles=!1,f.triggerHandler("blur"),p.focussed=!1},0)),e.preventDefault(),!1},p.displayElements.html.on("blur",T),p.displayElements.text.on("blur",T),p.displayElements.text.on("paste",function(e){f.triggerHandler("paste",e)}),p.queryFormatBlockState=function(e){return!p.showHtml&&e.toLowerCase()===s[0].queryCommandValue("formatBlock").toLowerCase()},p.queryCommandState=function(e){return p.showHtml?"":s[0].queryCommandState(e)},p.switchView=function(){p.showHtml=!p.showHtml,l.enabled(!1,p.displayElements.html),l.enabled(!1,p.displayElements.text),p.showHtml?t(function(){return l.enabled(!0,p.displayElements.html),l.enabled(!0,p.displayElements.text),p.displayElements.html[0].focus()},100):t(function(){return l.enabled(!0,p.displayElements.html),l.enabled(!0,p.displayElements.text),p.displayElements.text[0].focus()},100)},g.ngModel){var $=!0;h.$render=function(){if($){$=!1;var e=p.$parent.$eval(g.ngModel);void 0!==e&&null!==e||!w||""===w||h.$setViewValue(w)}p.displayElements.forminput.val(h.$viewValue),p.html=h.$viewValue||""},f.attr("required")&&(h.$validators.required=function(e,t){var n=e||t;return!(!n||""===n.trim())})}else p.displayElements.forminput.val(w),p.html=w;if(p.$watch("html",function(e,t){e!==t&&(g.ngModel&&h.$viewValue!==e&&h.$setViewValue(e),p.displayElements.forminput.val(e))}),g.taTargetToolbars)x=r.registerEditor(p._name,p,g.taTargetToolbars.split(","));else{var L=angular.element('<div text-angular-toolbar name="textAngularToolbar'+R+'">');g.taToolbar&&L.attr("ta-toolbar",g.taToolbar),g.taToolbarClass&&L.attr("ta-toolbar-class",g.taToolbarClass),g.taToolbarGroupClass&&L.attr("ta-toolbar-group-class",g.taToolbarGroupClass),g.taToolbarButtonClass&&L.attr("ta-toolbar-button-class",g.taToolbarButtonClass),g.taToolbarActiveButtonClass&&L.attr("ta-toolbar-active-button-class",g.taToolbarActiveButtonClass),g.taFocussedClass&&L.attr("ta-focussed-class",g.taFocussedClass),f.prepend(L),e(L)(p.$parent),x=r.registerEditor(p._name,p,["textAngularToolbar"+R])}p.$on("$destroy",function(){r.unregisterEditor(p._name)}),p.$on("ta-element-select",function(e,t){x.triggerElementSelect(e,t)&&p["reApplyOnSelectorHandlerstaTextElement"+R]()}),p.$on("ta-drop-event",function(e,n,a,o){p.displayElements.text[0].focus(),o&&o.files&&o.files.length>0?(angular.forEach(o.files,function(e){try{d.when(p.fileDropHandler(e,p.wrapSelection)||p.fileDropHandler!==p.defaultFileDropHandler&&d.when(p.defaultFileDropHandler(e,p.wrapSelection))).then(function(){p["updateTaBindtaTextElement"+R]()})}catch(t){c.error(t)}}),a.preventDefault(),a.stopPropagation()):t(function(){p["updateTaBindtaTextElement"+R]()},0)}),p._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){p._bUpdateSelectedStyles=!1,p.focussed=!1}),p.updateSelectedStyles=function(){var e;E&&t.cancel(E),void 0!==(e=a.getSelectionElement())&&e.parentNode!==p.displayElements.text[0]?x.updateSelectedStyles(angular.element(e)):x.updateSelectedStyles(),p._bUpdateSelectedStyles&&(E=t(p.updateSelectedStyles,200))},m=function(){return p.focussed?void(p._bUpdateSelectedStyles||(p._bUpdateSelectedStyles=!0,p.$apply(function(){p.updateSelectedStyles()}))):void(p._bUpdateSelectedStyles=!1)},p.displayElements.html.on("keydown",m),p.displayElements.text.on("keydown",m),v=function(){p._bUpdateSelectedStyles=!1},p.displayElements.html.on("keyup",v),p.displayElements.text.on("keyup",v),y=function(e,t){t&&angular.extend(e,t),p.$apply(function(){return x.sendKeyCommand(e)?(p._bUpdateSelectedStyles||p.updateSelectedStyles(),e.preventDefault(),!1):void 0})},p.displayElements.html.on("keypress",y),p.displayElements.text.on("keypress",y),b=function(){p._bUpdateSelectedStyles=!1,p.$apply(function(){p.updateSelectedStyles()})},p.displayElements.html.on("mouseup",b),p.displayElements.text.on("mouseup",b)}}}]),m.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,n){var a={},o={};return{registerEditor:function(n,r,i){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!r)throw"textAngular Error: An editor requires a scope";if(o[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';var s=[];return angular.forEach(i,function(e){a[e]&&s.push(a[e])}),o[n]={scope:r,toolbars:i,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&s.push(e)},editorFunctions:{disable:function(){angular.forEach(s,function(e){e.disabled=!0})},enable:function(){angular.forEach(s,function(e){e.disabled=!1})},focus:function(){angular.forEach(s,function(e){e._parent=r,e.disabled=!1,e.focussed=!0,r.focussed=!0})},unfocus:function(){angular.forEach(s,function(e){e.disabled=!0,e.focussed=!1}),r.focussed=!1},updateSelectedStyles:function(e){angular.forEach(s,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=r,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var a=!1;return(n.ctrlKey||n.metaKey||n.specialKey)&&angular.forEach(t,function(t,o){if(t.commandKeyCode&&(t.commandKeyCode===n.which||t.commandKeyCode===n.specialKey))for(var i=0;i<s.length;i++)if(void 0!==s[i].tools[o]){e.call(s[i].tools[o],r),a=!0;break}}),a},triggerElementSelect:function(e,n){var a=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},o=[],i={},l=!1;n=angular.element(n);var c=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(c=c||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),(!e.onElementSelect.onlyWithAttrs||a(n,e.onElementSelect.onlyWithAttrs))&&(i[t]=e))}),c?(angular.forEach(i,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&o.push({name:t,tool:e})}),o.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(i,function(e,t){o.push({name:t,tool:e})}),o.length>0)for(var d=0;d<o.length;d++){for(var u=o[d].tool,p=o[d].name,f=0;f<s.length;f++)if(void 0!==s[f].tools[p]){u.onElementSelect.action.call(s[f].tools[p],e,n,r),l=!0;break}if(l)break}return l}}},o[n].editorFunctions},retrieveEditor:function(e){return o[e]},unregisterEditor:function(e){delete o[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(a[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';a[e.name]=e,angular.forEach(o,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return a[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete a[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)})},updateToolDisplay:function(e,t){var n=this;angular.forEach(a,function(a,o){n.updateToolbarToolDisplay(o,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(a,function(n,a){t.resetToolbarToolDisplay(a,e)})},updateToolbarToolDisplay:function(e,t,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(a,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var a,o=0;o<t.toolbar[n].length;o++){if(t.toolbar[n][o]===e){a={group:n,index:o};break}if(void 0!==a)break}void 0!==a&&(t.toolbar[a.group].slice(a.index,1),t._$element.children().eq(a.group).children().eq(a.index).remove())}})},addTool:function(e,t,o,r){n(e,t),angular.forEach(a,function(n){n.addTool(e,t,o,r)})},addToolToToolbar:function(e,t,o,r,i){n(e,t),a[o].addTool(e,t,r,i)},refreshEditor:function(e){if(!o[e])throw'textAngular Error: No Editor with name "'+e+'" exists';o[e].scope.updateTaBindtaTextElement(),o[e].scope.$$phase||o[e].scope.$digest()},sendKeyCommand:function(e,t){angular.forEach(o,function(n){return n.editorFunctions.sendKeyCommand(t)?(e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1):void 0})}}}]),m.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,a,o,r){return{scope:{name:"@"},restrict:"EA",link:function(i,s,l){if(!i.name||""===i.name)throw"textAngular Error: A toolbar requires a name";angular.extend(i,angular.copy(n)),l.taToolbar&&(i.toolbar=i.$parent.$eval(l.taToolbar)),l.taToolbarClass&&(i.classes.toolbar=l.taToolbarClass),l.taToolbarGroupClass&&(i.classes.toolbarGroup=l.taToolbarGroupClass),l.taToolbarButtonClass&&(i.classes.toolbarButton=l.taToolbarButtonClass),l.taToolbarActiveButtonClass&&(i.classes.toolbarButtonActive=l.taToolbarActiveButtonClass),l.taFocussedClass&&(i.classes.focussed=l.taFocussedClass),i.disabled=!0,i.focussed=!1,i._$element=s,s[0].innerHTML="",s.addClass("ta-toolbar "+i.classes.toolbar),i.$watch("focussed",function(){i.focussed?s.addClass(i.classes.focussed):s.removeClass(i.classes.focussed)});var c=function(t,n){var a;if(a=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t["class"]?a.addClass(t["class"]):a.addClass(i.classes.toolbarButton),a.attr("name",n.name),a.attr("ta-button","ta-button"),a.attr("ng-disabled","isDisabled()"),a.attr("tabindex","-1"),a.attr("ng-click","executeAction()"),a.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&a.attr("title",t.tooltiptext),t&&!t.display&&!n._display&&(a[0].innerHTML="",t.buttontext&&(a[0].innerHTML=t.buttontext),t.iconclass)){var o=angular.element("<i>"),r=a[0].innerHTML;o.addClass(t.iconclass),a[0].innerHTML="",a.append(o),r&&""!==r&&a.append("&nbsp;"+r)}return n._lastToolDefinition=angular.copy(t),e(a)(n)};i.tools={},i._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var d={$window:r,$editor:function(){return i._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?i.classes.toolbarButtonActive:""},executeAction:o};angular.forEach(i.toolbar,function(e){var t=angular.element("<div>");t.addClass(i.classes.toolbarGroup),angular.forEach(e,function(e){i.tools[e]=angular.extend(i.$new(!0),a[e],d,{name:e}),i.tools[e].$element=c(a[e],i.tools[e]),t.append(i.tools[e].$element)}),s.append(t)}),i.updateToolDisplay=function(e,t,n){var a=i.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var o=c(t,a);a.$element.replaceWith(o),a.$element=o}},i.addTool=function(e,t,n,o){i.tools[e]=angular.extend(i.$new(!0),a[e],d,{name:e}),i.tools[e].$element=c(a[e],i.tools[e]);var r;void 0===n&&(n=i.toolbar.length-1),r=angular.element(s.children()[n]),void 0===o?(r.append(i.tools[e].$element),i.toolbar[n][i.toolbar[n].length-1]=e):(r.children().eq(o).after(i.tools[e].$element),i.toolbar[n][o]=e)},t.registerToolbar(i),i.$on("$destroy",function(){t.unregisterToolbar(i.name)})}}}])}()}({},function(){return this}());for(var kepsAsyncDependencies=["/lib/intl-tel-input/lib/libphonenumber/build/utils.js","/lib/intl-tel-input/build/js/intlTelInput.min.js"],findScripts=document.scripts,ngKepsLocation,i=0;i<findScripts.length;i++)findScripts[i].src.indexOf("ngkeps")>-1&&(ngKepsLocation=findScripts[i].src.slice(0,findScripts[i].src.indexOf("ngkeps")+6));var addKepsDependency=function(e){var t=document.createElement("script");t.setAttribute("src",e),document.body.appendChild(t)};document.addEventListener("DOMContentLoaded",function(e){for(var t=0;t<kepsAsyncDependencies.length;t++)addKepsDependency(ngKepsLocation+kepsAsyncDependencies[t])});